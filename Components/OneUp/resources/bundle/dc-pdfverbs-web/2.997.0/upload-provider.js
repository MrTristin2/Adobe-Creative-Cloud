(window["webpackJsonp-pdfverbs-web"]=window["webpackJsonp-pdfverbs-web"]||[]).push([[77],{eII6:function(e,t,r){"use strict";r.r(t);var s=r("prSB"),a=r.n(s),n=r("g4DW"),o=r.n(n),i=r("jQsN"),c=r.n(i),l=r("butC"),u=r.n(l),d=r("2bPg"),p=r.n(d),g=r("+lnk"),f=r("qDLo"),v=r("pukD"),m={asset:"content.asset",getDownloadUri:"asset_uri_download_v1.json",getMetadata:"asset_metadata_basic_v1.json",getRendition:"image"},P=r("RZ3+"),b=r("DMWh"),h=r("TKce"),_=r("3v9k"),w=g.logging.getLogger("uploadProviderLogger"),I={to:50,from:5},y=["CON","PRN","AUX","NUL","COM0","COM1","COM2","COM3","COM4","COM5","COM6","COM7","COM8","COM9","LPT0","LPT1","LPT2","LPT3","LPT4","LPT5","LPT6","LPT7","LPT8","LPT9"],U=function UploadProvider(){var e=this;p()(this,UploadProvider),this.manualCancel=!1,this.ready=u()(c.a.mark((function _callee(){var t;return c.a.wrap((function _callee$(r){for(;;)switch(r.prev=r.next){case 0:return r.next=2,g.providers.dcapi();case 2:return t=r.sent,e.dcapi=t.getDcapi(),r.next=6,g.providers["lifecycle-progress"]();case 6:return e.lifecycleProgress=r.sent,r.abrupt("return",Promise.resolve(e));case 8:case"end":return r.stop()}}),_callee)}))),this.getDownloadUri=function(){var t=u()(c.a.mark((function _callee2(t){var r,s,a,n=arguments;return c.a.wrap((function _callee2$(o){for(;;)switch(o.prev=o.next){case 0:return r=!(n.length>1&&void 0!==n[1])||n[1],s=e.lifecycleProgress.getJobById(t),a=s.dcapiStatusResult.asset_result.uri,o.abrupt("return",e.dcapi.call(P.b,{accept:m.getDownloadUri,headers:{"x-request-id":e.dcapi.getUuid("gdu")},uri_parameters:{asset_uri:a,make_direct_storage_uri:r}}));case 4:case"end":return o.stop()}}),_callee2)})));return function(e){return t.apply(this,arguments)}}(),this.manualAbort=function(t){e.manualCancel=!0,t.abort()},this.setUserTagsInStorage=function(){try{window.localStorage.setItem(h.d,"true")}catch(t){var e=window.adobe_dc_sdk.util.dcExtensionStorage;e&&e.setItems(o()({},h.d,"true"))}Object(_.h)()},this.setAuthTokenInStorage=u()(c.a.mark((function _callee3(){var e,t;return c.a.wrap((function _callee3$(r){for(;;)switch(r.prev=r.next){case 0:return r.prev=0,e=window.localStorage.getItem("pdfnow.auth"),r.next=4,g.providers["shared-storage"]();case 4:return t=r.sent,r.next=7,t.setItem("pdfnow.auth",e);case 7:r.next=12;break;case 9:r.prev=9,r.t0=r.catch(0),w.warn("Unable to set value to remote storage: ",r.t0);case 12:case"end":return r.stop()}}),_callee3,null,[[0,9]])}))),this.sanitizeFileName=function(e){var t=e,r=function getExtension(e){if(e){var t=e.split(".");if(t.length>1)return t.pop()}return""}(t);if(0===t.length||"."===t||".."===t)t="---";else{var s=function withoutExtension(e){if(e){var t=e.lastIndexOf(".");if(t>=0&&t<e.length-1)return e.substring(0,t)}return e}(t);r.length>1&&(r=".".concat(r)),y.includes(s)&&(t="---".concat(r))}if(t.length>255){var a=255-r.length;t=a>0?t.substring(0,a)+r:t.substring(0,255)}return e!==(t=(t=(t=(t=(t=(t=t.replace(/ $/,"-")).replace(/\.$/,"-")).replace(/^ /,"-")).replace(/^\./,"-")).replace(/[\x00-\x1F]/g,"-")).replace(/[\\/:"*?<>|]/g,"-"))&&w.info("Filename had illegal characters, was renamed"),t},this.upload=function(){var t=u()(c.a.mark((function _callee4(t){var r,s,n,o,i,l,u,d,p,h,_,y,U,O,L,x,R,T,j,C,k,S,q,J,M,D,E=arguments;return c.a.wrap((function _callee4$(c){for(;;)switch(c.prev=c.next){case 0:return r=E.length>1&&void 0!==E[1]?E[1]:{},s=r,g.auth2.isSignedIn||e.setUserTagsInStorage(),g.auth2.isSignedIn||e.setAuthTokenInStorage(),n=t.name,s&&s.persistence&&"permanent"===s.persistence||(n=e.sanitizeFileName(n)),o={asset_uri:null,inputFile:t,name:n},i={ignore_content_type:!0,name:n},s&&s.persistence&&"permanent"===s.persistence&&(i.parent_uri=s.parent_uri,i.persistence=s.persistence,i.on_dup_name=s.on_dup_name),u=(l=s||{}).initialStage,d=void 0===u?v.a.IN_PROGRESS:u,p=l.uploadRange,y=(h=void 0===p?I:p).to,U=h.from,O=a()({name:n,size:t.size,autoPilotProgress:!0,targetProgress:50,progress:U,stage:d,status:f.a.UPLOAD_START,title:n,type:"conversion"},s),L=s.parentJobId,x=void 0===L?"":L,_=r.isRetry?r.previousJob:x?e.lifecycleProgress.addChildJob(x,O):e.lifecycleProgress.addJob(O),R=_.jobId,r.isRetry||(e.lifecycleProgress.updateJob({jobId:R,stage:d,status:f.a.UPLOADING,progress:5}),e.lifecycleProgress.sendHostEvent(b.o,_)),(T=new FormData).append("parameters",JSON.stringify({options:i})),T.append("file",t,n),j=r.assetUploadPromiseObject||{},C=r.assetUploadPromise||new Promise((function(e,t){j.resolve=e,j.reject=t})),e.lifecycleProgress.updateJob({assetUploadPromise:C,jobId:R}),c.next=24,g.providers["block-upload"]();case 24:return k=c.sent,c.next=27,k.useUploadLargeFile(o.inputFile);case 27:return S=c.sent,q=r.requestId||(S&&k?R:e.dcapi.getUuid("up")),J=S&&k?k.uploadLargeFile(e.dcapi,o,a()(a()({},i),{},{requestId:q})):e.dcapi.call(P.e,{accept:m.asset,content:T,headers:{"x-request-id":q},request_content_open:!0}),M=J.then((function(e){return o.asset_uri=e.asset_uri||e.content.uri,o.asset_id=o.asset_uri.split("/").pop(),o})).catch((function(t){if(!e.manualCancel&&t&&"upload-cancelled"!==t.message)return w.error(t.message||t.statusText),Promise.reject(t)})),(D=J.request||void 0)&&_.enableUploadProgressEvents&&D.upload.addEventListener("progress",(function(){})),C.request=J.request,e.lifecycleProgress.updateJob({activeRequest:D,assetUploadPromise:C,jobId:R,assetUploadRequestId:q,isBlockUploadRequestId:S}),C.job=e.lifecycleProgress.getJobById(R),S||J.request.send(T),M.then((function(t){if(t){var s=e.lifecycleProgress.updateJob({jobId:R,assetForOperation:o,status:f.a.UPLOAD_COMPLETE,progress:y});e.lifecycleProgress.sendHostEvent(b.n,s),r.isRetry&&w.info("Retried upload succeeded: request_id=".concat(q))}return j.resolve(t),t})).catch((function(s){if(!e.manualCancel)return s&&"Timeout or network error"===s.message&&!r.isRetry?(w.warn("Upload failed, retrying once: request_id=".concat(q)),void e.upload(t,a()(a()({},r),{},{isRetry:!0,requestId:q,previousJob:_,assetUploadPromise:C,assetUploadPromiseObject:j}))):(e.lifecycleProgress.updateJob({jobId:R,progress:0,status:f.a.ERROR}),e.lifecycleProgress.stopAutoPilot(R),w.error(s&&s.message||"upload-error"),j.reject(s),Promise.reject(s));j.resolve(void 0)})),c.abrupt("return",C.job);case 39:case"end":return c.stop()}}),_callee4)})));return function(e){return t.apply(this,arguments)}}()};U.getInstance=g.providerUtil.getSingletonFunction(U);t.default=U}}]);
