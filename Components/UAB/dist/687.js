/*! For license information please see 687.js.LICENSE.txt */
"use strict";(this.webpackChunkAssetBrowser=this.webpackChunkAssetBrowser||[]).push([[687],{26687:(e,t,s)=>{s.r(t),s.d(t,{AdobeAssetFilter:()=>ps,AdobeAssetGlobalSearchFilter:()=>bo,AdobeAssetGlobalSearchOrder:()=>bs,AdobeAssetOrder:()=>gs,AdobeAssetSearchFilter:()=>_s,AdobeAssetUpdater:()=>bi,AssetListStatus:()=>Hs,AssetSyncStatus:()=>mi,AssetSyncSuspensionReason:()=>fi,AssetType:()=>_i,AssetVersion:()=>di,AssetVersionFilter:()=>Po,AssetVersionOrder:()=>_o,CHANGE:()=>oe,CloudSyncStatus:()=>Ki,CollaboratorOrder:()=>yo,CollaboratorUpdater:()=>wr,CollaboratorsByAssetIDOrder:()=>Ao,CommitStatus:()=>gi,Env:()=>Hr,ITEM_LIST_STATE_CHANGED:()=>ro,InvitedCollaboratorOrder:()=>Io,ItemBase:()=>Nt,LIST_CHANGED:()=>ti,LogLevel:()=>ao,MESSAGE_LOGGED:()=>oo,NetworkStatus:()=>Xi,OrderDirection:()=>ni,OrderField:()=>ai,OrgRepositoryOrder:()=>fo,OrgRepositoryUpdater:()=>Pr,Permission:()=>Ve,RecentAdobeAssetFilter:()=>Ji,RecentAdobeAssetOrder:()=>bs,SAMError:()=>o,SAMGenericError:()=>n,SAMHttpResponseError:()=>a,SAMRepositoryError:()=>l,STATE_CHANGED:()=>ei,SWYAdobeAssetFilter:()=>So,SWYAdobeAssetOrder:()=>Bt,SearchAdobeAssetOrder:()=>bs,SpaceFilter:()=>Eo,SpaceOrder:()=>fr,SpaceSearchAssetFilter:()=>Wi,SpaceUpdater:()=>Yi,Team:()=>Ar,TeamFilter:()=>Ro,TeamOrder:()=>Tr,createSharedAssetModel:()=>uo,getURLFromLinks:()=>F,initializeSharedAssetModel:()=>ho,parseAsyncResponse:()=>De});const i=new Map([[404,{code:"NOT_FOUND",message:e=>`Resource not found: ${e}`}],[403,{code:"ACCESS_DENIED",message:e=>`Access to resource denied: ${e}`}],[304,{code:"NOT_MODIFIED",message:()=>"Resource has not changed."}],[409,{code:"CONFLICT",message:()=>"Resource has a naming conflict."}]]);var r;!function(e){e.LIMIT_CHANGELOGRETENTION="http://ns.adobe.com/adobecloud/problem/limit/changelogretention",e.OPERATION_FAILED="adobecloud/problem/operation_failed",e.SUBSCRIPTION_COUNT="http://ns.adobe.com/adobecloud/problem/limit/subscriptioncount"}(r||(r={}));class o extends Error{constructor(e,t){super(`[${e}] ${t}`),this.code=e,this.title=t,Object.setPrototypeOf(this,new.target.prototype)}get name(){return"SAMError"}get response(){}get underlyingError(){}}class n extends o{constructor(e,t,s){let i="";if(null!=s)try{i=` -> ${String(s)}`}catch(e){}super(e,`${t}${i}`),this._underlyingError=s}get name(){return"SAMGenericError"}get underlyingError(){return this._underlyingError}static wrapErrorIfNeeded(e,t,s){return s instanceof o?s:new n(e,t,s)}}class a extends o{constructor(e,t,s,i){super(e,t),this._response=s,this._href=null!=i?i:s.url}get name(){return"SAMHttpResponseError"}get status(){return c(this._response.status)}get response(){return this._response}get href(){return this._href}static createWithResponse(e,t){var s,r;const{status:o}=e,n=i.get(c(o));let l=null!=t?t:e.url;return new a(null!==(s=null==n?void 0:n.code)&&void 0!==s?s:"UNEXPECTED_RESPONSE",null!==(r=null==n?void 0:n.message(null!=t?t:l))&&void 0!==r?r:`Unexpected response status: ${o}`,e,l)}static createWithResponseAndTitle(e,t){var s;const r=i.get(c(e.status));return new a(null!==(s=null==r?void 0:r.code)&&void 0!==s?s:"UNEXPECTED_RESPONSE",t,e,e.url)}}function c(e){for("string"==typeof e&&(e=parseInt(e)),e=Math.floor(e);e>999;)e=Math.floor(e/10);return e}class l extends o{constructor(e,t,s){var r;const o=c(e),n=e?i.get(o):void 0;super(null!==(r=null==n?void 0:n.code)&&void 0!==r?r:"UNEXPECTED_RESPONSE",null!=s?s:`Unexpected response status: ${e}`),this._type=t,this._status=o}get status(){return this._status}get name(){return"SAMRepositoryError"}get type(){return this._type}}class d extends o{constructor(e){super("ASSERTION_ERROR",e)}}function h(e,t,s,i){var r,o=arguments.length,n=o<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,s):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(e,t,s,i);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(n=(o<3?r(n):o>3?r(t,s,n):r(t,s))||n);return o>3&&n&&Object.defineProperty(t,s,n),n}function u(e,t){return function(s,i){t(s,i,e)}}function p(e,t){for(var s=0,i=e.length-1;i>=0;i--){var r=e[i];"."===r?e.splice(i,1):".."===r?(e.splice(i,1),s++):s&&(e.splice(i,1),s--)}if(t)for(;s--;s)e.unshift("..");return e}var _=/^(\/?|)([\s\S]*?)((?:\.{1,2}|[^\/]+?|)(\.[^.\/]*|))(?:[\/]*)$/,m=function(e){return _.exec(e).slice(1)};function f(){for(var e="",t=!1,s=arguments.length-1;s>=-1&&!t;s--){var i=s>=0?arguments[s]:"/";if("string"!=typeof i)throw new TypeError("Arguments to path.resolve must be strings");i&&(e=i+"/"+e,t="/"===i.charAt(0))}return(t?"/":"")+(e=p(A(e.split("/"),(function(e){return!!e})),!t).join("/"))||"."}function g(e){var t=y(e),s="/"===b(e,-1);return(e=p(A(e.split("/"),(function(e){return!!e})),!t).join("/"))||t||(e="."),e&&s&&(e+="/"),(t?"/":"")+e}function y(e){return"/"===e.charAt(0)}var v=function(e){var t=m(e),s=t[0],i=t[1];return s||i?(i&&(i=i.substr(0,i.length-1)),s+i):"."},I=function(e,t){function s(e){for(var t=0;t<e.length&&""===e[t];t++);for(var s=e.length-1;s>=0&&""===e[s];s--);return t>s?[]:e.slice(t,s-t+1)}e=f(e).substr(1),t=f(t).substr(1);for(var i=s(e.split("/")),r=s(t.split("/")),o=Math.min(i.length,r.length),n=o,a=0;a<o;a++)if(i[a]!==r[a]){n=a;break}var c=[];for(a=n;a<i.length;a++)c.push("..");return(c=c.concat(r.slice(n))).join("/")},w=function(){var e=Array.prototype.slice.call(arguments,0);return g(A(e,(function(e,t){if("string"!=typeof e)throw new TypeError("Arguments to path.join must be strings");return e})).join("/"))};function A(e,t){if(e.filter)return e.filter(t);for(var s=[],i=0;i<e.length;i++)t(e[i],i,e)&&s.push(e[i]);return s}var b=function(e,t,s){return e.substr(t,s)};const S=Symbol("@key parameterMap");var E=(e,t,s)=>{const i=e[S]=e[S]||new Map;if(i.has(t))throw new o("INVALID_PARAMETER","@key cannot be applied to more than one parameter");i.set(t,s)};function T(e){return(t,s,i)=>{const r=i.value;if(!r)throw new o("INVALID_PARAMETER","@cache decorator can only be applied to a method");i.value=async function(...t){var i;const n=null===(i=this[S])||void 0===i?void 0:i.get(s);if(void 0===n)throw new o("INVALID_PARAMETER","@cache decorator requires one of the parameters to be labelled with @key");const a=t[n];return this._core.environment.cache.getItem(a,(()=>r.apply(this,t)),e)}}}function C(e,t,s){return t?T()(e,t,s):T(e)}var R=(e,t,s)=>{const i=Symbol(`@memoize ${t}`),r=s.get?"get":"value",o=s[r];s[r]=function(...e){return Object.prototype.hasOwnProperty.call(this,i)||(this[i]=o.call(this,...e)),this[i]}};function P(e="change"){return function(t,s,i){if(i.get){const t=i.get;i.get=function(){return this._core.environment.mobx.reportObserved(this,e),t.call(this)}}else{if(!i.value)throw new SyntaxError("@observable decorator can only be used with `getters` or `methods`.");{const t=i.value,s=function(...s){return this._core.environment.mobx.reportObserved(this,e),t.apply(this,s)};i.value=s}}}}function O(e,t,s){return t?P()(e,t,s):P(e)}var D,L="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{},x={exports:{}};D=x,function(e,t){D.exports?D.exports=t():e.UriTemplate=t()}(L,(function(){var e={"+":!0,"#":!0,".":!0,"/":!0,";":!0,"?":!0,"&":!0},t={"*":!0};function s(e){return encodeURI(e).replace(/%25[0-9][0-9]/g,(function(e){return"%"+e.substring(3)}))}function i(e){return e=e.replace(/%../g,""),encodeURIComponent(e)===e}function r(r){var o="";e[r.charAt(0)]&&(o=r.charAt(0),r=r.substring(1));var n="",a="",c=!0,l=!1,d=!1;"+"==o?c=!1:"."==o?(a=".",n="."):"/"==o?(a="/",n="/"):"#"==o?(a="#",c=!1):";"==o?(a=";",n=";",l=!0,d=!0):"?"==o?(a="?",n="&",l=!0):"&"==o&&(a="&",n="&",l=!0);for(var h=[],u=r.split(","),p=[],_={},m=0;m<u.length;m++){var f=u[m],g=null;if(-1!=f.indexOf(":")){var y=f.split(":");f=y[0],g=parseInt(y[1])}for(var v={};t[f.charAt(f.length-1)];)v[f.charAt(f.length-1)]=!0,f=f.substring(0,f.length-1);var I={truncate:g,name:f,suffices:v};p.push(I),_[f]=I,h.push(f)}return{varNames:h,prefix:a,substitution:function(e){for(var t="",i=0,r=0;r<p.length;r++){var o=p[r],h=e(o.name);if(null==h||Array.isArray(h)&&0==h.length||"object"==typeof h&&0==Object.keys(h).length)i++;else if(t+=r==i?a:n||",",Array.isArray(h)){l&&(t+=o.name+"=");for(var u=0;u<h.length;u++)u>0&&(t+=o.suffices["*"]&&n||",",o.suffices["*"]&&l&&(t+=o.name+"=")),t+=c?encodeURIComponent(h[u]).replace(/!/g,"%21"):s(h[u])}else if("object"==typeof h){l&&!o.suffices["*"]&&(t+=o.name+"=");var _=!0;for(var m in h)_||(t+=o.suffices["*"]&&n||","),_=!1,t+=c?encodeURIComponent(m).replace(/!/g,"%21"):s(m),t+=o.suffices["*"]?"=":",",t+=c?encodeURIComponent(h[m]).replace(/!/g,"%21"):s(h[m])}else l&&(t+=o.name,d&&""==h||(t+="=")),null!=o.truncate&&(h=h.substring(0,o.truncate)),t+=c?encodeURIComponent(h).replace(/!/g,"%21"):s(h)}return t},unSubstitution:function(e,t,s){if(a&&(e=e.substring(a.length)),1==p.length&&p[0].suffices["*"]){for(var r=(b=p[0]).name,o=b.suffices["*"]?e.split(n||","):[e],d=c&&-1!=e.indexOf("="),h=1;h<o.length;h++)e=o[h],d&&-1==e.indexOf("=")&&(o[h-1]+=(n||",")+e,o.splice(h,1),h--);for(h=0;h<o.length;h++)e=o[h],c&&-1!=e.indexOf("=")&&(d=!0),1==(y=e.split(",")).length?o[h]=y[0]:o[h]=y;if(l||d){for(var u=t[r]||{},m=0;m<o.length;m++){var f=e;if(!l||f){if("string"==typeof o[m]){var g=(e=o[m]).split("=",1)[0];if(e=e.substring(g.length+1),c){if(s&&!i(e))return;e=decodeURIComponent(e)}f=e}else{if(g=(e=o[m][0]).split("=",1)[0],e=e.substring(g.length+1),c){if(s&&!i(e))return;e=decodeURIComponent(e)}o[m][0]=e,f=o[m]}if(c){if(s&&!i(g))return;g=decodeURIComponent(g)}void 0!==u[g]?Array.isArray(u[g])?u[g].push(f):u[g]=[u[g],f]:u[g]=f}}1==Object.keys(u).length&&void 0!==u[r]?t[r]=u[r]:t[r]=u}else{if(c)for(m=0;m<o.length;m++){var y=o[m];if(Array.isArray(y))for(var v=0;v<y.length;v++){if(s&&!i(y[v]))return;y[v]=decodeURIComponent(y[v])}else{if(s&&!i(y))return;o[m]=decodeURIComponent(y)}}void 0!==t[r]?Array.isArray(t[r])?t[r]=t[r].concat(o):t[r]=[t[r]].concat(o):1!=o.length||b.suffices["*"]?t[r]=o:t[r]=o[0]}}else{o=1==p.length?[e]:e.split(n||",");var I={};for(h=0;h<o.length;h++){for(var w=0;w<p.length-1&&w<h&&!p[w].suffices["*"];w++);if(w!=h){for(var A=p.length-1;A>0&&p.length-A<o.length-h&&!p[A].suffices["*"];A--);p.length-A!=o.length-h?I[h]=w:I[h]=A}else I[h]=h}for(h=0;h<o.length;h++)if((e=o[h])||!l){if(y=e.split(","),d=!1,l){r=(e=y[0]).split("=",1)[0],e=e.substring(r.length+1),y[0]=e;var b=_[r]||p[0]}else r=(b=p[I[h]]).name;for(m=0;m<y.length;m++)if(c){if(s&&!i(y[m]))return;y[m]=decodeURIComponent(y[m])}(l||b.suffices["*"])&&void 0!==t[r]?Array.isArray(t[r])?t[r]=t[r].concat(y):t[r]=[t[r]].concat(y):1!=y.length||b.suffices["*"]?t[r]=y:t[r]=y[0]}}return 1}}}function o(e){if(!(this instanceof o))return new o(e);for(var t=e.split("{"),s=[t.shift()],i=[],n=[],a=[],c=[];t.length>0;){var l=t.shift(),d=l.split("}")[0],h=l.substring(d.length+1),u=r(d);n.push(u.substitution),a.push(u.unSubstitution),i.push(u.prefix),s.push(h),c=c.concat(u.varNames)}this.fill=function(e){if(e&&"function"!=typeof e){var t=e;e=function(e){return t[e]}}for(var i=s[0],r=0;r<n.length;r++)i+=(0,n[r])(e),i+=s[r+1];return i},this.fromUri=function(e,t){t=t||{};for(var r={},o=0;o<s.length;o++){var n=s[o];if(e.substring(0,n.length)!==n)return;if(e=e.substring(n.length),o>=s.length-1){if(""==e)break;return}var c=i[o];if(!c||e.substring(0,c.length)===c){for(var l=s[o+1],d=o;;){if(d==s.length-2){var h=e.substring(e.length-l.length);if(h!==l)return;var u=e.substring(0,e.length-l.length);e=h}else if(l){var p=e.indexOf(l);u=e.substring(0,p),e=e.substring(p)}else if(i[d+1])-1===(p=e.indexOf(i[d+1]))&&(p=e.length),u=e.substring(0,p),e=e.substring(p);else{if(s.length>d+2){d++,l=s[d+1];continue}u=e,e=""}break}if(!a[o](u,r,t.strict))return}}return r},this.varNames=c,this.template=e}return o.prototype={toString:function(){return this.template},fillFromObject:function(e){return this.fill(e)},test:function(e,t){return!!this.fromUri(e,t)}},o}));var N=x.exports;const k="application/json",M="application/json-patch+json";var j;function U(e,t){let s=e&&e[t];if(!s||Array.isArray(s)&&0===s.length)throw new o("INVALID_DATA",`Missing template link for relationship type: ${t}.`);return Array.isArray(s)&&(s=s[0]),s.href}function F(e,t,s={}){const i=U(e,t),r=N(i);return r&&r.fill(s)}function B(e){const t=e&&e.get("Retry-After");if(t)try{const e=parseInt(t,10);if(e)return Math.max(0,e);const s=Date.parse(t);if(s){const e=Date.now();return Math.max(0,s-e)/1e3+Math.floor(30*Math.random())}}catch(e){}return 0}!function(e){e.PRIMARY="http://ns.adobe.com/adobecloud/rel/primary",e.ID="http://ns.adobe.com/adobecloud/rel/id",e.PATH="http://ns.adobe.com/adobecloud/rel/path",e.RENDITION="http://ns.adobe.com/adobecloud/rel/rendition",e.MANIFEST="http://ns.adobe.com/adobecloud/rel/manifest",e.COMPONENT="http://ns.adobe.com/adobecloud/rel/component",e.PAGE="http://ns.adobe.com/adobecloud/rel/page",e.DISCARD="http://ns.adobe.com/adobecloud/rel/discard",e.RESTORE="http://ns.adobe.com/adobecloud/rel/restore",e.DIRECTORY="http://ns.adobe.com/adobecloud/rel/directory",e.DIRECTORY_BASE="http://ns.adobe.com/adobecloud/rel/directory/base",e.AC_EFFECTIVE="http://ns.adobe.com/adobecloud/rel/ac/effective",e.AC_POLICY="http://ns.adobe.com/adobecloud/rel/ac/policy",e.AC_CHECK="http://ns.adobe.com/adobecloud/rel/ac/check",e.CREATE="http://ns.adobe.com/adobecloud/rel/create",e.REPOSITORY="http://ns.adobe.com/adobecloud/rel/repository",e.RESOLVE_ID="http://ns.adobe.com/adobecloud/rel/resolve/id",e.RESOLVE_PATH="http://ns.adobe.com/adobecloud/rel/resolve/path",e.OPS="http://ns.adobe.com/adobecloud/rel/ops",e.BLOCK_INITIALIZE="http://ns.adobe.com/adobecloud/rel/block/init",e.BLOCK_TRANSFER="http://ns.adobe.com/adobecloud/rel/block/transfer",e.BLOCK_FINALIZE="http://ns.adobe.com/adobecloud/rel/block/finalize",e.REPO_METADATA="http://ns.adobe.com/adobecloud/rel/metadata/repository",e.APP_METADATA="http://ns.adobe.com/adobecloud/rel/metadata/application",e.EMBEDDED_METADATA="http://ns.adobe.com/adobecloud/rel/metadata/embedded",e.ANNOTATIONS="http://ns.adobe.com/adobecloud/rel/annotations",e.DOWNLOAD="http://ns.adobe.com/adobecloud/rel/download",e.DESCRIBED_BY="describedBy",e.VERSION="version-history",e.SUBSCRIPTION_CREATE="subscription/create",e.NOTIFICATIONS_LONGPOLL="notifications/longpoll",e.ONS_CHANGELOG="ons/changelog",e.REPOSITORIES_PAGE="http://ns.adobe.com/repositories/rel/page",e.TEAMS_CREATE="http://ns.adobe.com/teams/rel/create",e.TEAMS_DISCARD="http://ns.adobe.com/teams/rel/discard",e.TEAMS_RESTORE="http://ns.adobe.com/teams/rel/restore",e.TEAMS_RENAME="http://ns.adobe.com/teams/rel/rename",e.TEAMS_PROPERTIES="http://ns.adobe.com/teams/rel/properties",e.TEAMS_PAGE="http://ns.adobe.com/teams/rel/page",e.TEAMS_PRIMARY="http://ns.adobe.com/teams/rel/primary",e.TEAM_PROVISION="http://ns.adobe.com/teams/rel/provision",e.PROJECTS_CONTEXT="http://ns.adobe.com/ccprojects/rel/context",e.PROJECTS_BOOKMARKS_BATCH="http://ns.adobe.com/ccprojects/rel/bookmarks/batch",e.PROJECTS_PRIMARY="http://ns.adobe.com/ccprojects/rel/primary",e.PROJECTS_CREATE="http://ns.adobe.com/ccprojects/rel/create",e.PROJECTS_PAGE="http://ns.adobe.com/ccprojects/rel/page",e.PROJECTS_LIBRARIES_PAGE="http://ns.adobe.com/ccprojects/rel/libraries/page",e.PROJECTS_LIBRARIES_CREATE="http://ns.adobe.com/ccprojects/rel/libraries/create",e.PROJECTS_LIBRARIES_BATCH="http://ns.adobe.com/ccprojects/rel/libraries/batch",e.GENERIC_PAGE="page",e.GENERIC_NEXT="next",e.ATS_MOVE="http://ns.adobe.com/ats/rel/move"}(j||(j={}));var $=(e,t,s)=>{const i=Symbol(`@retry ${t}`),r=s.value;s.value=async function(e=0){const o=this[i];o&&(clearTimeout(o),this[i]=void 0);try{await r.call(this)}catch(r){const o=r.response?1e3*B(r.response.headers):0,n=Math.max(this._core.environment.getRetryInterval(e),o);this._core.environment.log(`Retrying ${t} in ${n}ms`),this[i]=setTimeout((()=>s.value.call(this,e+1)),n)}}},V=(e,t,s)=>{const i=Symbol(`@synchronized ${t}`),r=s.value;if(!r)throw new o("INVALID_PARAMETER","@synchronized decorator can only be applied to a method");s.value=async function(...e){var s;const o=null===(s=this[S])||void 0===s?void 0:s.get(t),n=void 0===o?"default":e[o],a=this[i]||(this[i]=new Map);let c,l;do{if(c=a.get(n),c)try{await c}catch(e){}}while(c);a.set(n,new Promise((e=>l=e)));try{return await r.apply(this,e)}finally{a.delete(n),l&&l()}}};function H(){}function W(){W.init.call(this)}function G(e){return void 0===e._maxListeners?W.defaultMaxListeners:e._maxListeners}function Y(e,t,s){if(t)e.call(s);else for(var i=e.length,r=ee(e,i),o=0;o<i;++o)r[o].call(s)}function q(e,t,s,i){if(t)e.call(s,i);else for(var r=e.length,o=ee(e,r),n=0;n<r;++n)o[n].call(s,i)}function J(e,t,s,i,r){if(t)e.call(s,i,r);else for(var o=e.length,n=ee(e,o),a=0;a<o;++a)n[a].call(s,i,r)}function z(e,t,s,i,r,o){if(t)e.call(s,i,r,o);else for(var n=e.length,a=ee(e,n),c=0;c<n;++c)a[c].call(s,i,r,o)}function K(e,t,s,i){if(t)e.apply(s,i);else for(var r=e.length,o=ee(e,r),n=0;n<r;++n)o[n].apply(s,i)}function X(e,t,s,i){var r,o,n,a;if("function"!=typeof s)throw new TypeError('"listener" argument must be a function');if((o=e._events)?(o.newListener&&(e.emit("newListener",t,s.listener?s.listener:s),o=e._events),n=o[t]):(o=e._events=new H,e._eventsCount=0),n){if("function"==typeof n?n=o[t]=i?[s,n]:[n,s]:i?n.unshift(s):n.push(s),!n.warned&&(r=G(e))&&r>0&&n.length>r){n.warned=!0;var c=new Error("Possible EventEmitter memory leak detected. "+n.length+" "+t+" listeners added. Use emitter.setMaxListeners() to increase limit");c.name="MaxListenersExceededWarning",c.emitter=e,c.type=t,c.count=n.length,a=c,"function"==typeof console.warn?console.warn(a):console.log(a)}}else n=o[t]=s,++e._eventsCount;return e}function Q(e,t,s){var i=!1;function r(){e.removeListener(t,r),i||(i=!0,s.apply(e,arguments))}return r.listener=s,r}function Z(e){var t=this._events;if(t){var s=t[e];if("function"==typeof s)return 1;if(s)return s.length}return 0}function ee(e,t){for(var s=new Array(t);t--;)s[t]=e[t];return s}H.prototype=Object.create(null),W.EventEmitter=W,W.usingDomains=!1,W.prototype.domain=void 0,W.prototype._events=void 0,W.prototype._maxListeners=void 0,W.defaultMaxListeners=10,W.init=function(){this.domain=null,W.usingDomains&&(void 0).active,this._events&&this._events!==Object.getPrototypeOf(this)._events||(this._events=new H,this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},W.prototype.setMaxListeners=function(e){if("number"!=typeof e||e<0||isNaN(e))throw new TypeError('"n" argument must be a positive number');return this._maxListeners=e,this},W.prototype.getMaxListeners=function(){return G(this)},W.prototype.emit=function(e){var t,s,i,r,o,n,a,c="error"===e;if(n=this._events)c=c&&null==n.error;else if(!c)return!1;if(a=this.domain,c){if(t=arguments[1],!a){if(t instanceof Error)throw t;var l=new Error('Uncaught, unspecified "error" event. ('+t+")");throw l.context=t,l}return t||(t=new Error('Uncaught, unspecified "error" event')),t.domainEmitter=this,t.domain=a,t.domainThrown=!1,a.emit("error",t),!1}if(!(s=n[e]))return!1;var d="function"==typeof s;switch(i=arguments.length){case 1:Y(s,d,this);break;case 2:q(s,d,this,arguments[1]);break;case 3:J(s,d,this,arguments[1],arguments[2]);break;case 4:z(s,d,this,arguments[1],arguments[2],arguments[3]);break;default:for(r=new Array(i-1),o=1;o<i;o++)r[o-1]=arguments[o];K(s,d,this,r)}return!0},W.prototype.addListener=function(e,t){return X(this,e,t,!1)},W.prototype.on=W.prototype.addListener,W.prototype.prependListener=function(e,t){return X(this,e,t,!0)},W.prototype.once=function(e,t){if("function"!=typeof t)throw new TypeError('"listener" argument must be a function');return this.on(e,Q(this,e,t)),this},W.prototype.prependOnceListener=function(e,t){if("function"!=typeof t)throw new TypeError('"listener" argument must be a function');return this.prependListener(e,Q(this,e,t)),this},W.prototype.removeListener=function(e,t){var s,i,r,o,n;if("function"!=typeof t)throw new TypeError('"listener" argument must be a function');if(!(i=this._events))return this;if(!(s=i[e]))return this;if(s===t||s.listener&&s.listener===t)0==--this._eventsCount?this._events=new H:(delete i[e],i.removeListener&&this.emit("removeListener",e,s.listener||t));else if("function"!=typeof s){for(r=-1,o=s.length;o-- >0;)if(s[o]===t||s[o].listener&&s[o].listener===t){n=s[o].listener,r=o;break}if(r<0)return this;if(1===s.length){if(s[0]=void 0,0==--this._eventsCount)return this._events=new H,this;delete i[e]}else!function(e,t){for(var s=t,i=s+1,r=e.length;i<r;s+=1,i+=1)e[s]=e[i];e.pop()}(s,r);i.removeListener&&this.emit("removeListener",e,n||t)}return this},W.prototype.off=function(e,t){return this.removeListener(e,t)},W.prototype.removeAllListeners=function(e){var t,s;if(!(s=this._events))return this;if(!s.removeListener)return 0===arguments.length?(this._events=new H,this._eventsCount=0):s[e]&&(0==--this._eventsCount?this._events=new H:delete s[e]),this;if(0===arguments.length){for(var i,r=Object.keys(s),o=0;o<r.length;++o)"removeListener"!==(i=r[o])&&this.removeAllListeners(i);return this.removeAllListeners("removeListener"),this._events=new H,this._eventsCount=0,this}if("function"==typeof(t=s[e]))this.removeListener(e,t);else if(t)do{this.removeListener(e,t[t.length-1])}while(t[0]);return this},W.prototype.listeners=function(e){var t,s,i=this._events;return s=i&&(t=i[e])?"function"==typeof t?[t.listener||t]:function(e){for(var t=new Array(e.length),s=0;s<t.length;++s)t[s]=e[s].listener||e[s];return t}(t):[],s},W.listenerCount=function(e,t){return"function"==typeof e.listenerCount?e.listenerCount(t):Z.call(e,t)},W.prototype.listenerCount=Z,W.prototype.eventNames=function(){return this._eventsCount>0?Reflect.ownKeys(this._events):[]};class te extends W{dispatch(e){return super.emit(e.type,e,this)}once(e,t){const s=super.once(e,t);return this._onEventListenerAdded(),s}on(e,t){if(this.listeners(e).includes(t))return this;const s=super.on(e,t);return this._onEventListenerAdded(),s}off(e,t){return super.off(e,t)}_onEventListenerAdded(){}}class se{constructor(e){this._type=e}get type(){return this._type}}class ie{constructor(e){this._ref=e}get[Symbol.toStringTag](){return"WeakRef"}deref(){return this._ref}}var re="undefined"!=typeof WeakRef?WeakRef:ie;const oe="change",ne=new class extends se{constructor(){super(oe)}};function ae(e){e.updateLastKnownClientMutation()}function ce(e,t){t.updateLastKnownClientMutation()}class le{constructor(e,t,s,i,r="fetch"){this._core=e,this._delegate=t,this.updateContext=s,this.mostRecentValidMutation=i,this.type=r}get hasChanges(){return Boolean(this._addedItems||this._changedItems||this._discardedItems)}get addedItems(){return this._addedItems&&Array.from(this._addedItems.values())}get changedItems(){return this._changedItems&&Array.from(this._changedItems.keys())}get discardedItems(){return this._discardedItems&&Array.from(this._discardedItems)}checkIfItemAllowsMutations(e){const{lastKnownClientMutation:t}=e,{mostRecentValidMutation:s}=this;return!t||!s||t<s}ensureItemIsAdded(e){var t;const{id:s}=e;if((null===(t=this._addedItems)||void 0===t?void 0:t.get(s))===e)return;const i=this._delegate;(i.getLocalItemById(s)!==e||i.isItemDiscarded(e))&&this.queueAddedItem(e)}queueAddedItem(e){var t;let s=this._addedItems;s||(s=new Map,this._addedItems=s),s.set(e.id,e),null===(t=this._changedItems)||void 0===t||t.delete(e)}queueChangedItem(e,t=ne){var s;if(null===(s=this._addedItems)||void 0===s?void 0:s.has(e.id))return;let i=this._changedItems;i||(i=new Map,this._changedItems=i);let r=i.get(e);r||(r=[],i.set(e,r)),r.push(t)}queueDiscardedItem(e){let t=this._discardedItems;t||(t=new Set,this._discardedItems=t),t.add(e)}getItemById(e){var t;return(null===(t=this._addedItems)||void 0===t?void 0:t.get(e))||this._delegate.getLocalItemById(e)}commit(){var e,t;this._delegate.commitUpdateSession(this);let s=this._changedItems;if(s)for(const[e,t]of s.entries())for(const s of t)e.dispatch(s);"mutation"===this.type&&(null===(e=this._addedItems)||void 0===e||e.forEach(ae),null===(t=this._discardedItems)||void 0===t||t.forEach(ae),null==s||s.forEach(ce))}}const de="itemsChanged";class he extends se{constructor(e,t,s,i){super(de),this.addedItems=e,this.changedItems=t,this.discardedItems=s,this.updateContext=i}}function ue(e,t){return e.priority===t.priority?0:"list"===e.priority?-1:1}class pe extends te{constructor(e,t){super(),this._core=e,this.type=t,this._objectsById=new Map,this._discardedObjects=new WeakSet,this._delegates=[],this._hasUnsortedDelegates=!1,this.getLocalItemById=e=>{const t=this._objectsById.get(e);return null==t?void 0:t.deref()},this.removeLocalItems=e=>{Array.isArray(e)?e.forEach((e=>{this._objectsById.delete(e)})):this._objectsById.delete(e)},this.isItemDiscarded=e=>this._discardedObjects.has(e),this._updateSessionDelegate={getLocalItemById:this.getLocalItemById,isItemDiscarded:this.isItemDiscarded,commitUpdateSession:e=>{if(!e.hasChanges)return;const t=this._objectsById,s=this._discardedObjects,{discardedItems:i}=e;if(i)for(const e of i)s.add(e);const{addedItems:r}=e;if(r)for(const e of r)t.set(e.id,new re(e)),s.delete(e);const o=new he(e.addedItems,e.changedItems,e.discardedItems,e.updateContext),n=this._delegates;this._hasUnsortedDelegates&&(n.sort(ue),this._hasUnsortedDelegates=!1);let a=!1;for(const e of n){const t=e.delegate.deref();t?t.onItemsUpdated(o,this):a=!0}a&&(this._delegates=n.filter((e=>e.delegate.deref()))),this.dispatch(o)}}}createUpdateSession(e,t){return new le(this._core,this._updateSessionDelegate,e,t)}createMutationSession(){return new le(this._core,this._updateSessionDelegate,void 0,void 0,"mutation")}addDelegate(e,t){this._delegates.push({priority:t,delegate:new re(e)}),this._hasUnsortedDelegates=!0}forEach(e){const t=this._objectsById;for(const[s,i]of t){const r=i.deref();r?e(r):t.delete(s)}}map(e){const t=[];return this.forEach((s=>{t.push(e(s))})),t}}var _e=/^utf-?8|ascii|utf-?16-?le|ucs-?2|base-?64|latin-?1$/i,me=/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,fe=/\s|\uFEFF|\xA0/,ge=/\r?\n[\x20\x09]+/g,ye=/[;,"]/,ve=/[;,"]|\s/,Ie=/^[!#$%&'*+\-\.^_`|~\da-zA-Z]+$/;function we(e){return e.replace(me,"")}function Ae(e){return fe.test(e)}function be(e,t){for(;Ae(e[t]);)t++;return t}function Se(e){return ve.test(e)||!Ie.test(e)}class Ee{constructor(e){this.refs=[],e&&this.parse(e)}rel(e){for(var t=[],s=e.toLowerCase(),i=0;i<this.refs.length;i++)this.refs[i].rel.toLowerCase()===s&&t.push(this.refs[i]);return t}get(e,t){e=e.toLowerCase();for(var s=[],i=0;i<this.refs.length;i++)this.refs[i][e]===t&&s.push(this.refs[i]);return s}set(e){return this.refs.push(e),this}setUnique(e){return this.refs.some((t=>{return s=t,i=e,Object.keys(s).length===Object.keys(i).length&&Object.keys(s).every((e=>e in i&&s[e]===i[e]));var s,i}))||this.refs.push(e),this}has(e,t){e=e.toLowerCase();for(var s=0;s<this.refs.length;s++)if(this.refs[s][e]===t)return!0;return!1}parse(e,t){for(var s=1,i=(e=we(e=(t=t||0)?e.slice(t):e).replace(ge,"")).length,r=(t=0,null);t<i;)if(1===s){if(Ae(e[t])){t++;continue}if("<"!==e[t])throw new Error('Unexpected character "'+e[t]+'" at offset '+t);if(null!=r&&(null!=r.rel?this.refs.push(...Ee.expandRelations(r)):this.refs.push(r)),-1===(a=e.indexOf(">",t)))throw new Error("Expected end of URI delimiter at offset "+t);r={uri:e.slice(t+1,a)},t=a,s=2,t++}else if(2===s){if(Ae(e[t])){t++;continue}if(";"===e[t])s=4,t++;else{if(","!==e[t])throw new Error('Unexpected character "'+e[t]+'" at offset '+t);s=1,t++}}else{if(4!==s)throw new Error('Unknown parser state "'+s+'"');if(";"===e[t]||Ae(e[t])){t++;continue}if(-1===(a=e.indexOf("=",t)))throw new Error("Expected attribute delimiter at offset "+t);var o=we(e.slice(t,a)).toLowerCase(),n="";if('"'===e[t=be(e,t=a+1)])for(t++;t<i;){if('"'===e[t]){t++;break}"\\"===e[t]&&t++,n+=e[t],t++}else{for(var a=t+1;!ye.test(e[a])&&a<i;)a++;n=e.slice(t,a),t=a}switch(r[o]&&Ee.isSingleOccurenceAttr(o)||("*"===o[o.length-1]?r[o]=Ee.parseExtendedValue(n):(n="type"===o?n.toLowerCase():n,null!=r[o]?Array.isArray(r[o])?r[o].push(n):r[o]=[r[o],n]:r[o]=n)),e[t]){case",":s=1;break;case";":s=4}t++}return null!=r&&(null!=r.rel?this.refs.push(...Ee.expandRelations(r)):this.refs.push(r)),r=null,this}toString(){for(var e=[],t="",s=null,i=0;i<this.refs.length;i++)s=this.refs[i],t=Object.keys(this.refs[i]).reduce((function(e,t){return"uri"===t?e:e+"; "+Ee.formatAttribute(t,s[t])}),"<"+s.uri+">"),e.push(t);return e.join(", ")}}Ee.isCompatibleEncoding=function(e){return _e.test(e)},Ee.parse=function(e,t){return(new Ee).parse(e,t)},Ee.isSingleOccurenceAttr=function(e){return"rel"===e||"type"===e||"media"===e||"title"===e||"title*"===e},Ee.isTokenAttr=function(e){return"rel"===e||"type"===e||"anchor"===e},Ee.escapeQuotes=function(e){return e.replace(/"/g,'\\"')},Ee.expandRelations=function(e){return e.rel.split(" ").map((function(t){var s=Object.assign({},e);return s.rel=t,s}))},Ee.parseExtendedValue=function(e){var t=/([^']+)?(?:'([^']*)')?(.+)/.exec(e);return{language:t[2].toLowerCase(),encoding:Ee.isCompatibleEncoding(t[1])?null:t[1].toLowerCase(),value:Ee.isCompatibleEncoding(t[1])?decodeURIComponent(t[3]):t[3]}},Ee.formatExtendedAttribute=function(e,t){var s=(t.encoding||"utf-8").toUpperCase();return e+"="+s+"'"+(t.language||"en")+"'"+(Buffer.isBuffer(t.value)&&Ee.isCompatibleEncoding(s)?t.value.toString(s):Buffer.isBuffer(t.value)?t.value.toString("hex").replace(/[0-9a-f]{2}/gi,"%$1"):encodeURIComponent(t.value))},Ee.formatAttribute=function(e,t){return Array.isArray(t)?t.map((t=>Ee.formatAttribute(e,t))).join("; "):"*"===e[e.length-1]||"string"!=typeof t?Ee.formatExtendedAttribute(e,t):(Ee.isTokenAttr(e)?t=Se(t)?'"'+Ee.escapeQuotes(t)+'"':Ee.escapeQuotes(t):Se(t)&&(t='"'+(t=(t=encodeURIComponent(t)).replace(/%20/g," ").replace(/%2C/g,",").replace(/%3B/g,";"))+'"'),e+"="+t)};var Te=Ee;class Ce{constructor(e,t,s,i,r){this.url=e,this.headers=t,this.status=s,this.statusText=i,this._text=r}get ok(){const{status:e}=this;return e>=200&&e<=299}get redirected(){return!1}get type(){return"basic"}async json(){try{return JSON.parse(this._text)}catch(e){throw new n("INVALID_DATA",`Failed to parse JSON response from '${this.url}' async request.`,e)}}async text(){return this._text}get trailer(){throw new o("NOT_IMPLEMENTED","AsyncResponse.trailer not implemented.")}clone(){const e=new Headers;return this.headers.forEach(((t,s)=>e.set(s,t))),new Ce(this.url,e,this.status,this.statusText,this._text)}get bodyUsed(){throw new o("NOT_IMPLEMENTED","AsyncResponse.bodyUsed not implemented.")}get body(){throw new o("NOT_IMPLEMENTED","AsyncResponse.body not implemented.")}async arrayBuffer(){throw new o("NOT_IMPLEMENTED","AsyncResponse.arrayBuffer not implemented.")}async blob(){throw new o("NOT_IMPLEMENTED","AsyncResponse.blob not implemented.")}async formData(){throw new o("NOT_IMPLEMENTED","AsyncResponse.formData not implemented.")}}const Re=function(){let e=33,t=["^(["];for(let s=34;s<=127;++s)127!==s&&-1==='()<@,;:"/[]={}'.indexOf(String.fromCharCode(s))||(t.push("\\"+e.toString(8)),e<s-1&&t.push("-\\"+(s-1).toString(8)),e=s+1);return t.push("]+):(.*)$"),new RegExp(t.join(""))}(),Pe=/^[^\s]+\s+(\d+)\s*(.*)$/;class Oe{constructor(e){this._text=e,this._index=0}readLine(){const{_index:e,_text:t}=this,s=t.indexOf("\n",e);if(-1===s)return;this._index=s+"\n".length;let i=t.slice(e,s);return i.endsWith("\r")&&(i=i.slice(0,-1)),i}get remainderText(){return this._text.slice(this._index)}}function De(e,t){if(!t)throw new o("INVALID_DATA","Invalid async response body.");const s=new Oe(t);let i,r;const n=s.readLine();if(n){const e=n.match(Pe);if(!e)throw new o("INVALID_DATA","Invalid status line for async response.");if(i=parseInt(e[1],10),!i)throw new o("INVALID_DATA","Could not find status code for async response.");r=e[2]}else i=200,r="";const a=[];let c;for(;;){const e=s.readLine();if(!e)break;const t=e.match(Re);t?(c=t[1],a.push([c,t[2]])):c&&a.push([c,e])}return new Ce(e,new Headers(a),i,r,s.remainderText)}const Le=[200];class xe{constructor(e){this._core=e,this._sharedResponses=new Map}async _fetch(e,t={},s=Le){let i=await this._core.environment.fetch(e,t);return 202===i.status&&(i=await this._pollAsyncResponse(i)),"any"!==s&&this._checkResponseStatus(i,e,s),i}_checkResponseStatus(e,t,s){if(!s.includes(e.status))throw a.createWithResponse(e,t)}async _pollAsyncResponse(e){let t=e.headers.get("location");if(!t){const s=await e.json();if(!s)throw new o("INVALID_DATA","Failed to parse content for 202 async response.");if(t=s.href,!t)throw new o("INVALID_DATA","Missing href property for 202 async response.")}const s=this._getRetryAfterTimeout(e.headers);return this._fetchAsyncResponse(e.url,t,s)}async _fetchAsyncResponse(e,t,s){s&&await new Promise((e=>setTimeout(e,s)));const i=await this._core.environment.fetch(t),r=await i.text();if(this._shouldRetryFetchAsyncResponse(i,r)){const s=this._getRetryAfterTimeout(i.headers);return this._fetchAsyncResponse(e,t,s)}return De(e,r)}_shouldRetryFetchAsyncResponse(e,t){return 202===e.status}_getRetryAfterTimeout(e){return 1e3*B(e)||this._core.environment.getValue("ASYNC_DEFAULT_DELAY")}async _doGet(e,t={}){return this._fetch(e,{method:"GET",headers:t})}async _doHead(e,t={}){return this._fetch(e,{method:"HEAD",headers:t})}async _doPost(e,t={},s,i=[201]){return this._fetch(e,{method:"POST",headers:t,body:s},i)}async _doPatch(e,t={},s,i=[200]){return this._fetch(e,{method:"PATCH",headers:t,body:s},i)}async _doPut(e,t={},s,i=[201]){return this._fetch(e,{method:"PUT",headers:t,body:s},i)}async _doDelete(e,t={},s=[200]){return this._fetch(e,{method:"DELETE",headers:t},s)}async _getResponse(e,t={}){return(await this._doGet(e,t)).json()}async _getSharedResponse(e,t={}){let s=this._sharedResponses.get(e);return s||(s=this._getResponse(e,t),this._sharedResponses.set(e,s),s.finally((()=>this._sharedResponses.delete(e)))),s}async _getPagedResponse(e,t={}){var s,i;const r=await this._getResponse(e,t);if((null===(s=null==r?void 0:r._page)||void 0===s?void 0:s.next)&&(null===(i=null==r?void 0:r._links)||void 0===i?void 0:i[j.PAGE])){const e=N(r._links[j.PAGE].href).fill(Object.assign(Object.assign({},r._page),{start:r._page.next,resource:j.PRIMARY}));return{result:r,next:()=>this._getPagedResponse(e,t)}}return{result:r}}_getAllPages(e,t={}){let s;const i=async e=>{const t=await e(),r=t&&t.result&&t.result.children;return r?(s?s.children=s.children.concat(r):s=t.result,t.next?i(t.next):s):s};return i((()=>this._getPagedResponse(e,t)))}_getLinksFromHeaders(e){const t=e&&e.get("Link");if(!t)throw new o("UNEXPECTED_RESPONSE","HEAD request did not return link header");const s=Te.parse(t);return s&&s.refs.reduce(((e,t)=>{var{rel:s,uri:i}=t,r=function(e,t){var s={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.indexOf(i)<0&&(s[i]=e[i]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var r=0;for(i=Object.getOwnPropertySymbols(e);r<i.length;r++)t.indexOf(i[r])<0&&Object.prototype.propertyIsEnumerable.call(e,i[r])&&(s[i[r]]=e[i[r]])}return s}(t,["rel","uri"]);return s&&(e[s]=e[s]||[],e[s].push(Object.assign({href:i},r))),e}),{})}_getETagFromHeaders(e){return e.get("ETag")}}var Ne;!function(e){e.STORAGE_ASSIGNEE_TYPE="storage:assignee$$type",e.VISIBLITY="app_metadata$$shell:visibility",e.CREATIVE_CLOUD_TOPLEVEL_COLLECTION_NAME="creative_cloud_toplevel_collection_name",e.FIELD_EXISTS="op_field_exists",e.INCLUDES="includes",e.TYPE="type",e.ARTIFACT_FIELD="app_metadata$$review:sourceAsset$$dc:format",e.STORAGE_ASSIGNEE_ID="storage:assignee$$id",e.SHARED_VIA_INVITE="shared_via_invite"}(Ne||(Ne={}));const ke={name:"asset_name",created:"create_date",modified:"modify_date",shared:"shared_date"},Me={scope:["creative_cloud"]};class je extends xe{_getEndpointHref(e){return`https://${this._core.environment.endpoints.USS_HOST}${e}`}async getQueryResponse(e){e=Object.assign(Object.assign({},Me),e);const t=this._getEndpointHref("/universal-search/v2/search"),{PRODUCT_ID:s,PRODUCT_LOCATION:i}=this._core.environment.getValue("HOST_PRODUCT_DATA");return(await this._doPost(t,{"Content-Type":"application/vnd.adobe.search-request+json","X-Product":s,"X-Product-Location":i},JSON.stringify(e),[200])).json()}async searchSpace(e,t,s,i){var r,o,n,a;const c={scope:["creative_cloud"],hints:[{acp_platform_v2:!0,creative_cloud_rendition_v2:!0}],cc_teams_user_storage:!0,fetch_fields:{includes:["app_metadata","collaboration_metadata"]},asset_id_opacity:!0,sort_orderby:null!==(r=null==i?void 0:i.sort_orderby)&&void 0!==r?r:"modify_date",sort_order:null!==(o=null==i?void 0:i.sort_order)&&void 0!==o?o:"desc",limit:null!==(n=null==i?void 0:i.limit)&&void 0!==n?n:50,start_index:null!==(a=null==i?void 0:i.start_index)&&void 0!==a?a:0,[Ne.TYPE]:(null==i?void 0:i.type)||[],container:{asset_id:[e]}};return t?c.op_field_exists=[Ne.ARTIFACT_FIELD]:c.op_none_of=[{op_field_exists:[Ne.ARTIFACT_FIELD]},{[Ne.VISIBLITY]:["hiddenSelf","hiddenRecursive"]}],s&&c.fetch_fields.includes.push("_embedded"),this.getQueryResponse(c)}}class Ue extends xe{constructor(){super(...arguments),this._batchRequestLimit=50}get batchRequestLimit(){return this._batchRequestLimit}_getUrl(e){return`https://${this._core.environment.endpoints.INVITATIONS_HOST}${e}`}async getCollaborators(e){return await this._getSharedResponse(this._getUrl(`/api/v4/share/${encodeURIComponent(e)}?extraFeatures=direct_acl`))}async addCollaborators(e,t){await this._doPost(this._getUrl(`/api/v4/share/${encodeURIComponent(e)}`),{},JSON.stringify(t),[200])}async modifyCollaborators(e,t){await this._doPatch(this._getUrl(`/api/v4/share/${encodeURIComponent(e)}`),{},JSON.stringify(t),[200])}async getCollaboratorListForUrns(e){const t={operation:"bulkGetShares",parameters:{urns:e,queryParams:{extraFeatures:"direct_acl,legacy_role"}}},s=await this._doPost(this._getUrl("/ops/v4/shares"),{"Content-Type":"application/json"},JSON.stringify(t),[200]),i=await s.json();if(!i.result||!Array.isArray(i.result))throw new o("UNEXPECTED_RESPONSE","Failed to parse response for Invitation Service bulk API.");return i}async confirmAccess(e){await this._doPost(this._getUrl(`/api/v4/invitations/urn/${encodeURIComponent(e)}`),{},void 0,[200])}_shouldRetryFetchAsyncResponse(e,t){return 200===e.status&&"completed"!==JSON.parse(t).jobStatus}async declineAccess(e){await this._doDelete(this._getUrl(`/api/v4/invitations/urn/${encodeURIComponent(e)}`),{},[200])}}const Fe=["collaboration_metadata"],Be=["shell:visibility","convertedTo"];function $e(){return[...Be.map((e=>"app_metadata$$"+e)),...Fe]}var Ve,He;function We(e){const t=e[j.PRIMARY]||e["*"]||[],s=e[j.AC_POLICY]||e["*"]||[],i=e[j.DIRECTORY]||e["*"]||[];let r=Ve.None;return t.forEach((e=>{switch(e){case"ack":r|=Ve.Ack;break;case"read":r|=Ve.Read;break;case"write":r|=Ve.Write,i.includes("write")&&(r|=Ve.Rename);break;case"delete":i.includes("write")&&(r|=Ve.Delete,r|=Ve.Move)}})),s.includes("write")&&(r|=Ve.Share),r}!function(e){e[e.None=0]="None",e[e.Ack=1]="Ack",e[e.Read=2]="Read",e[e.Write=4]="Write",e[e.Delete=8]="Delete",e[e.Share=16]="Share",e[e.Rename=32]="Rename",e[e.Move=64]="Move",e[e.All=126]="All"}(Ve||(Ve={})),function(e){e.add="add",e.remove="remove",e.replace="replace"}(He||(He={}));const Ge={orderDirection:"descending",orderBy:"storage:deviceModifyDate",start:"",limit:0},Ye={orderDirection:"descending",orderBy:"created",start:"",limit:0};function qe(e){const t={};return e.start&&(t.start=e.start),e.limit&&(t.limit=e.limit),t}function Je(e){return("ascending"===e.orderDirection?"+":"-")+e.orderBy}class ze extends xe{constructor(e,t,s,i){super(e._core),this._rapi=e,this._assetId=t,this._links=s,this._etag=i}get assetID(){return this._assetId}get links(){return this._links}get etag(){return this._etag}async getChildAssets(e){const t=function(e,t){const s=Object.assign(Object.assign({},Ge),t),i=qe(s);return i.orderBy=Je(s),i.type=s.type,i.embed=JSON.stringify(s.embed),F(e,j.PAGE,i)}(this._links,e);return(await this._doGet(t,{"Cache-Control":"no-cache, no-store, max-age=0"})).json()}async getRepoMetadata(){const e=F(this._links,j.REPO_METADATA),t=await this._doGet(e),s=await t.json();try{this._links=this._getLinksFromHeaders(t.headers),s._links=this._links,this._etag=s["repo:etag"];const e=await this._rapi.getAssetResolveByIdHref(this._assetId);await this._core.environment.cache.setItem(e,{links:this._links,etag:this._etag})}catch(e){}return s}async getEmbeddedMetadata(){const e=F(this._links,j.EMBEDDED_METADATA);try{return await this._getResponse(e,{Accept:k})}catch(e){if("NOT_FOUND"===e.code)return{};throw e}}async getAppMetadata(){const e=F(this._links,j.APP_METADATA);try{return await this._getResponse(e)}catch(e){if("NOT_FOUND"===e.code)return{};throw e}}async getEffectivePermissions(){const e=F(this._links,j.AC_EFFECTIVE);return We(await this._getResponse(e))}async getManifest(e){const t=F(this._links,j.MANIFEST),s={};e&&(s["if-none-match"]=e);const i=await this._doGet(t,s);return{manifest:await i.json(),etag:i.headers.get("ETag")}}async getVersions(e){const t=function(e,t){const s=function(e){const t=Object.assign(Object.assign({},Ye),e),s=qe(t);return s.orderBy=Je(t),s.resource=j.VERSION,s}(t);return F(e,j.PAGE,s)}(this._links,e);return(await this._doGet(t)).json()}async restoreVersionManifest(e){const t=await this._doGet(e,{}),s=await t.json(),i=F(this.links,j.MANIFEST);await this._doPut(i,{"Content-Type":"application/vnd.adobe.dcx-manifest+json","If-Match":"*"},JSON.stringify(s),[204])}async patchVersion(e){const t=F(this.links,j.VERSION);return await this._doPatch(t,{"Content-Type":M},JSON.stringify(e),[204])}async createFolder(e){const t=F(this._links,j.CREATE,{path:e,intermediates:"true",respondWith:"http://ns.adobe.com/adobecloud/rel/metadata/repository"});let s=await this._doPost(t,{"Content-Type":"application/vnd.adobecloud.directory+json"},void 0,[200,201]);return 201===s.status?await s.json():void 0}async importFile(e,t,s){const i=F(this._links,j.CREATE,{path:t,respondWith:"http://ns.adobe.com/adobecloud/rel/metadata/repository"});let r=await this._doPost(i,{"Content-Type":null!=s?s:e.type},e,[200,201]);return 201===r.status?await r.json():void 0}async getContent(){const e=F(this._links,j.PRIMARY);let t=await this._doGet(e,{});return{content:await t.blob(),etag:this._getETagFromHeaders(t.headers)}}async commitFileChanges(e,t){const s=F(this._links,j.PRIMARY),i={"Content-type":e.type};t&&(i["If-Match"]=t);let r=await this._doPut(s,i,e,[200,201,204]);return{MetaData:201===r.status?await r.json():void 0,eTag:this._getETagFromHeaders(r.headers)}}async restore(e){const t=F(this._links,j.RESTORE,e?{name:e}:{});await this._doPost(t,{},void 0,[204])}async discard(){const e=F(this._links,j.DISCARD);await this._doPost(e,{},void 0,[204])}async delete(e,t){const s=await this._rapi.getRootLink(j.OPS);await this._doPost(s,{"Content-Type":"application/vnd.adobe.asset-operation+json"},JSON.stringify(t),[204])}async runOperation(e){return this._rapi.runOperation(e)}}class Ke extends xe{_getAndCacheDocument(e){return this._getAllPages(e)}async _getAndCacheResponse(e){return await this._getResponse(e)}getRootDocument(){return this._getAndCacheDocument(`https://${this._core.environment.endpoints.ACP_CS_HOST}`)}async getRootLink(e,t={}){return F((await this.getRootDocument())._links,e,t)}async getIndex(){const e=await this.getRootDocument(),{children:t}=e,s=F(t.find((e=>"Index.json"===e["repo:name"]))._links,j.PRIMARY);return await this._getAndCacheResponse(s)}async _getAndCacheLinksFromHref(e){const t=await this._doHead(e);return{links:this._getLinksFromHeaders(t.headers),etag:this._getETagFromHeaders(t.headers)}}async getAssetResolveByIdHref(e){return await this.getRootLink(j.RESOLVE_ID,{id:e})}async resolveById(e){const t=await this.getAssetResolveByIdHref(e),{links:s,etag:i}=await this._getAndCacheLinksFromHref(t);return new ze(this,e,s,i||"")}async resolveByPath(e,t){const s=await this.getRootLink(j.RESOLVE_PATH,{repositoryId:e,path:t,mode:"id"}),i=await this._doHead(s),r=i.headers.get("X-Resource-Id"),n=this._getLinksFromHeaders(i.headers),a=this._getETagFromHeaders(i.headers);if(!r)throw new o("INVALID_DATA",`Missing 'X-Resource-Id' header while resolving Asset path' ${e}:${t}'.`);const c=await this.getRootLink(j.RESOLVE_ID,{id:r});return await this._core.environment.cache.setItem(c,{links:n,etag:a},this._core.environment.getValue("CACHE_DEFAULT_TTL")),new ze(this,r,n,a||"")}async getHomeDirectoryMetadata(){const e=await this.getIndex();if(!e.children.length)throw new o("INVALID_OPERATION","Home repository not found");return e.children[0]._embedded[j.REPO_METADATA]}async runOperation(e){var t;const s=await this.getRootLink(j.OPS),i=await this._doPost(s,{"Content-Type":"application/vnd.adobe.asset-operation+json"},JSON.stringify(e),"any");let n;try{n=await i.json()}catch(e){}if(n&&!Array.isArray(n)&&200!==i.status){const s=Array.isArray(e)?e[0]:e;return[Object.assign(Object.assign({},s),{error:new l(i.status,r.OPERATION_FAILED,null!==(t=n.message)&&void 0!==t?t:"Operation failed")})]}if(this._checkResponseStatus(i,s,[200]),!n)throw new o("UNEXPECTED_RESPONSE","Failed to parse response for repo bulk API.");return(Array.isArray(n)?n:[n]).map((e=>{const{error:t}=e;return Object.assign(Object.assign({},e),{error:t?new l(t.status,t.type,t.title):void 0})}))}async runOperationsForContext(e,t,s,i,r){var o;const n=await this.runOperation(e),a={failedResults:[],newModels:[]},c=s.createMutationSession(),l=[];for(const e of n){const s=e.id&&t.get(e.id);if(!s)continue;const{asset:n,error:d}=e;if(d){if(r){const e=null===(o=r.find((e=>e.match(d))))||void 0===o?void 0:o.action;if(e){l.push(e(s,d).then((e=>{e&&a.failedResults.push(e)})));continue}}a.failedResults.push({model:s,error:d})}else try{const e=i(c,s,n);e&&a.newModels.push(e)}catch(e){const t=e;if(!t||"UNEXPECTED_RESPONSE"!==t.code)throw e;a.failedResults.push({model:s,error:t})}}return c.commit(),await Promise.all(l),a}}h([C,u(0,E)],Ke.prototype,"_getAndCacheDocument",null),h([C,u(0,E)],Ke.prototype,"_getAndCacheResponse",null),h([C,u(0,E)],Ke.prototype,"_getAndCacheLinksFromHref",null);const Xe=new WeakMap,Qe=new WeakMap;function Ze(e){const t=Xe.get(e);return console.assert(null!=t,"'this' is expected an Event object, but got",e),t}function et(e){null==e.passiveListener?e.event.cancelable&&(e.canceled=!0,"function"==typeof e.event.preventDefault&&e.event.preventDefault()):"undefined"!=typeof console&&"function"==typeof console.error&&console.error("Unable to preventDefault inside passive event listener invocation.",e.passiveListener)}function tt(e,t){Xe.set(this,{eventTarget:e,event:t,eventPhase:2,currentTarget:e,canceled:!1,stopped:!1,immediateStopped:!1,passiveListener:null,timeStamp:t.timeStamp||Date.now()}),Object.defineProperty(this,"isTrusted",{value:!1,enumerable:!0});const s=Object.keys(t);for(let e=0;e<s.length;++e){const t=s[e];t in this||Object.defineProperty(this,t,st(t))}}function st(e){return{get(){return Ze(this).event[e]},set(t){Ze(this).event[e]=t},configurable:!0,enumerable:!0}}function it(e){return{value(){const t=Ze(this).event;return t[e].apply(t,arguments)},configurable:!0,enumerable:!0}}function rt(e){if(null==e||e===Object.prototype)return tt;let t=Qe.get(e);return null==t&&(t=function(e,t){const s=Object.keys(t);if(0===s.length)return e;function i(t,s){e.call(this,t,s)}i.prototype=Object.create(e.prototype,{constructor:{value:i,configurable:!0,writable:!0}});for(let r=0;r<s.length;++r){const o=s[r];if(!(o in e.prototype)){const e="function"==typeof Object.getOwnPropertyDescriptor(t,o).value;Object.defineProperty(i.prototype,o,e?it(o):st(o))}}return i}(rt(Object.getPrototypeOf(e)),e),Qe.set(e,t)),t}function ot(e){return Ze(e).immediateStopped}function nt(e,t){Ze(e).passiveListener=t}tt.prototype={get type(){return Ze(this).event.type},get target(){return Ze(this).eventTarget},get currentTarget(){return Ze(this).currentTarget},composedPath(){const e=Ze(this).currentTarget;return null==e?[]:[e]},get NONE(){return 0},get CAPTURING_PHASE(){return 1},get AT_TARGET(){return 2},get BUBBLING_PHASE(){return 3},get eventPhase(){return Ze(this).eventPhase},stopPropagation(){const e=Ze(this);e.stopped=!0,"function"==typeof e.event.stopPropagation&&e.event.stopPropagation()},stopImmediatePropagation(){const e=Ze(this);e.stopped=!0,e.immediateStopped=!0,"function"==typeof e.event.stopImmediatePropagation&&e.event.stopImmediatePropagation()},get bubbles(){return Boolean(Ze(this).event.bubbles)},get cancelable(){return Boolean(Ze(this).event.cancelable)},preventDefault(){et(Ze(this))},get defaultPrevented(){return Ze(this).canceled},get composed(){return Boolean(Ze(this).event.composed)},get timeStamp(){return Ze(this).timeStamp},get srcElement(){return Ze(this).eventTarget},get cancelBubble(){return Ze(this).stopped},set cancelBubble(e){if(!e)return;const t=Ze(this);t.stopped=!0,"boolean"==typeof t.event.cancelBubble&&(t.event.cancelBubble=!0)},get returnValue(){return!Ze(this).canceled},set returnValue(e){e||et(Ze(this))},initEvent(){}},Object.defineProperty(tt.prototype,"constructor",{value:tt,configurable:!0,writable:!0}),"undefined"!=typeof window&&void 0!==window.Event&&(Object.setPrototypeOf(tt.prototype,window.Event.prototype),Qe.set(window.Event.prototype,tt));const at=new WeakMap;function ct(e){return null!==e&&"object"==typeof e}function lt(e){const t=at.get(e);if(null==t)throw new TypeError("'this' is expected an EventTarget object, but got another value.");return t}function dt(e,t){Object.defineProperty(e,`on${t}`,function(e){return{get(){let t=lt(this).get(e);for(;null!=t;){if(3===t.listenerType)return t.listener;t=t.next}return null},set(t){"function"==typeof t||ct(t)||(t=null);const s=lt(this);let i=null,r=s.get(e);for(;null!=r;)3===r.listenerType?null!==i?i.next=r.next:null!==r.next?s.set(e,r.next):s.delete(e):i=r,r=r.next;if(null!==t){const r={listener:t,listenerType:3,passive:!1,once:!1,next:null};null===i?s.set(e,r):i.next=r}},configurable:!0,enumerable:!0}}(t))}function ht(e){function t(){ut.call(this)}t.prototype=Object.create(ut.prototype,{constructor:{value:t,configurable:!0,writable:!0}});for(let s=0;s<e.length;++s)dt(t.prototype,e[s]);return t}function ut(){if(!(this instanceof ut)){if(1===arguments.length&&Array.isArray(arguments[0]))return ht(arguments[0]);if(arguments.length>0){const e=new Array(arguments.length);for(let t=0;t<arguments.length;++t)e[t]=arguments[t];return ht(e)}throw new TypeError("Cannot call a class as a function")}at.set(this,new Map)}ut.prototype={addEventListener(e,t,s){if(null==t)return;if("function"!=typeof t&&!ct(t))throw new TypeError("'listener' should be a function or an object.");const i=lt(this),r=ct(s),o=(r?Boolean(s.capture):Boolean(s))?1:2,n={listener:t,listenerType:o,passive:r&&Boolean(s.passive),once:r&&Boolean(s.once),next:null};let a=i.get(e);if(void 0===a)return void i.set(e,n);let c=null;for(;null!=a;){if(a.listener===t&&a.listenerType===o)return;c=a,a=a.next}c.next=n},removeEventListener(e,t,s){if(null==t)return;const i=lt(this),r=(ct(s)?Boolean(s.capture):Boolean(s))?1:2;let o=null,n=i.get(e);for(;null!=n;){if(n.listener===t&&n.listenerType===r)return void(null!==o?o.next=n.next:null!==n.next?i.set(e,n.next):i.delete(e));o=n,n=n.next}},dispatchEvent(e){if(null==e||"string"!=typeof e.type)throw new TypeError('"event.type" should be a string.');const t=lt(this),s=e.type;let i=t.get(s);if(null==i)return!0;const r=function(e,t){return new(rt(Object.getPrototypeOf(t)))(e,t)}(this,e);let o=null;for(;null!=i;){if(i.once?null!==o?o.next=i.next:null!==i.next?t.set(s,i.next):t.delete(s):o=i,nt(r,i.passive?i.listener:null),"function"==typeof i.listener)try{i.listener.call(this,r)}catch(e){"undefined"!=typeof console&&"function"==typeof console.error&&console.error(e)}else 3!==i.listenerType&&"function"==typeof i.listener.handleEvent&&i.listener.handleEvent(r);if(ot(r))break;i=i.next}return nt(r,null),function(e,t){Ze(e).eventPhase=0}(r),function(e,t){Ze(e).currentTarget=null}(r),!r.defaultPrevented}},Object.defineProperty(ut.prototype,"constructor",{value:ut,configurable:!0,writable:!0}),"undefined"!=typeof window&&void 0!==window.EventTarget&&Object.setPrototypeOf(ut.prototype,window.EventTarget.prototype);class pt extends ut{constructor(){throw super(),new TypeError("AbortSignal cannot be constructed directly")}get aborted(){const e=_t.get(this);if("boolean"!=typeof e)throw new TypeError("Expected 'this' to be an 'AbortSignal' object, but got "+(null===this?"null":typeof this));return e}}dt(pt.prototype,"abort");const _t=new WeakMap;Object.defineProperties(pt.prototype,{aborted:{enumerable:!0}}),"function"==typeof Symbol&&"symbol"==typeof Symbol.toStringTag&&Object.defineProperty(pt.prototype,Symbol.toStringTag,{configurable:!0,value:"AbortSignal"});class mt{constructor(){ft.set(this,function(){const e=Object.create(pt.prototype);return ut.call(e),_t.set(e,!1),e}())}get signal(){return gt(this)}abort(){var e;e=gt(this),!1===_t.get(e)&&(_t.set(e,!0),e.dispatchEvent({type:"abort"}))}}const ft=new WeakMap;function gt(e){const t=ft.get(e);if(null==t)throw new TypeError("Expected 'this' to be an 'AbortController' object, but got "+(null===e?"null":typeof e));return t}Object.defineProperties(mt.prototype,{signal:{enumerable:!0},abort:{enumerable:!0}}),"function"==typeof Symbol&&"symbol"==typeof Symbol.toStringTag&&Object.defineProperty(mt.prototype,Symbol.toStringTag,{configurable:!0,value:"AbortController"});const yt="undefined"!=typeof self?self:"undefined"!=typeof window?window:"undefined"!=typeof global?global:void 0;function vt(e,t){return e===t}function It(e,t,s=It){if(e===t)return!0;if(typeof e!=typeof t||e.constructor!==t.constructor)return!1;if(e instanceof Date)return e.toISOString()===t.toISOString();if(Array.isArray(e)){const i=e.length;if(i!==t.length)return!1;for(let r=0;r<i;++r)if(!s(e[r],t[r]))return!1;return!0}if(e instanceof Set){if(e.size!==t.size)return!1;for(const s of e.keys())if(!t.has(s))return!1;return!0}if(e instanceof Map){if(e.size!==t.size)return!1;for(const i of e.keys()){if(!t.has(i))return!1;if(!s(e.get(i),t.get(i)))return!1}return!0}if("object"==typeof e){const i=Object.keys(e),r=Object.keys(t),o=i.length;if(o!==r.length)return!1;i.sort(),r.sort();for(let n=0;n<o;++n){const o=i[n];if(o!==r[n])return!1;if(!s(e[o],t[o]))return!1}return!0}return!1}yt&&(void 0===yt.AbortController&&(yt.AbortController=mt),void 0===yt.AbortSignal&&(yt.AbortSignal=pt));const wt="X-User-Token",At={includeResources:[{reltype:"api:metadata/repository"},{reltype:"api:metadata/application"},{reltype:"api:ac/policy"}]},bt=2592e5;class St extends W{constructor(e,t){if(super(),this._onsInterface=e,this._assets=new Map,this._watchedAssets=new Map,this._initializedFromCache=!1,t){const{id:e,href:s,assets:i}=t;this._subscriptionId=e,this._subscriptionHref=s,this._watchedAssets=new Map(Object.entries(i)),this._initializedFromCache=this._watchedAssets.size>0}}get _core(){return this._onsInterface._core}get subscriptionId(){return this._subscriptionId}get subscriptionHref(){return this._subscriptionHref}_log(e){this._core.environment.log(e)}get lastError(){return this._lastError}get assets(){return this._assets}get watchedAssets(){return this._watchedAssets}abort(){return!!this._retryTimeout&&(clearTimeout(this._retryTimeout),this._retryTimeout=void 0,this._log(`subscription ${this.subscriptionId} retry got aborted`),!0)}set assets(e){this._assets=new Map(e),this._update()}async _update(e=0){var t;this.abort();const s=this._assets;if(It(s,this._watchedAssets))this._lastError?(this._lastError=void 0,this.emit("change")):this._initializedFromCache&&this.emit("change",{fromCache:!0});else{this._log(`Setting ${s.size} asset ids for ${this.subscriptionId||"<pending subscription id>"}`);try{0===s.size?(this._log(`deleting subscription ${this.subscriptionId} requested assets no longer exist`),await this._deleteSubscriptionFromServer()):this._subscriptionHref?(this._log(`updating subscription on the server ${this.subscriptionId}`),await this._updateSubscriptionOnServer(s)):(this._log("creating subscription"),await this._createSubscriptionOnServer(s)),this._watchedAssets=s,this._lastError=void 0,this.emit("change")}catch(s){if(this._log(`Error updating subscription: ${s}`),this._lastError=s,this.emit("change"),e<3){let i=1e3*B(null===(t=s.response)||void 0===t?void 0:t.headers);i=Math.max(10,i),this._retryTimeout=setTimeout((()=>{this._retryTimeout=void 0,this._update(e+1)}),i)}}}}async _parseSubscriptionResponse(e,t){const s=await t();if(s.status<200||s.status>=300){let t=`operation ${e} with http response.status: ${s.status}`;if(403===s.status){const e=await s.json();e.type===r.SUBSCRIPTION_COUNT&&(t=`Maximum number of subscriptions per user per device exceeded (${e.max})`)}throw this._log(t),a.createWithResponseAndTitle(s,t)}const i=await s.json();if(!(i.id&&i._links&&i._links.self&&i._links.self.href)){const e="No subscription ID or href was returned in subscribe response.";throw this._log(e),new a("INVALID_DATA",e,s)}this._subscriptionId=i.id,this._subscriptionHref=i._links.self.href}async _createSubscriptionOnServer(e){const t=await this._onsInterface._getLink(j.SUBSCRIPTION_CREATE),s=Array.from(e.keys()),i=await this._core.environment.getDeviceId(),r=JSON.stringify({objects:s.map((t=>Object.assign(Object.assign({id:t},At),e.get(t)))),device:{id:i},expiresAt:Date.now()+bt});return this._log(`Creating subscription for ${e.size} assets: ${s.join(", ")}`),this._parseSubscriptionResponse("create",(()=>this._core.environment.fetch(t,{method:"POST",body:r,authHeader:wt,headers:{"Content-Type":"application/vnd.adobecloud.subscription+json"}})))}async _updateSubscriptionOnServer(e){const t=this._watchedAssets,s=e,i=[];s.forEach(((e,s)=>{if(!t.has(s)){const t={op:"add",path:"/objects/-",value:Object.assign(Object.assign({id:s},At),e)};i.push(t)}})),t.forEach(((e,t)=>{if(!s.has(t)){const e={op:"remove",path:`/objects/id=${t}`};i.push(e)}}));const r=JSON.stringify(i);this._log(`Updating subscription ${this._subscriptionId}: ${r}`);try{await this._parseSubscriptionResponse("update",(()=>this._core.environment.fetch(this._subscriptionHref,{method:"PATCH",body:r,authHeader:wt,headers:{"Content-Type":M}})))}catch(t){if("NOT_FOUND"===t.code)return this._log(`The subscription we tried to update no longer exists (${this._subscriptionId}) - creating a new subscription instead`),this._createSubscriptionOnServer(e);throw t}}async _deleteSubscriptionFromServer(){this._log(`Deleting subscription ${this._subscriptionId}`);try{await this._core.environment.fetch(this._subscriptionHref,{method:"DELETE",authHeader:wt})}catch(e){this._log(`Unable to delete subscription: ${this._subscriptionHref}. Error: ${e}`)}this._subscriptionId=void 0,this._subscriptionHref=void 0}async _fetchChangeLogPage(e){var t,s,i,o;const n={subscriptionId:this._subscriptionId},c=this._nextChangeLogLinks?F(this._nextChangeLogLinks,j.GENERIC_NEXT,n):await this._onsInterface._getLink(j.ONS_CHANGELOG,n),l=await this._core.environment.fetch(c);if(200!==l.status){let e=`Unexpected response fetching change log: ${l.status}`;throw 403===l.status&&(await l.json()).type===r.LIMIT_CHANGELOGRETENTION&&(e='Changelog retention period expired, discarding "next" link and fetching changelog again.',this._nextChangeLogLinks=void 0),this._log(e),a.createWithResponseAndTitle(l,e)}const d=await l.json(),h=(null!==(t=d["ons:changedSubscriptions"])&&void 0!==t?t:[]).find((e=>e["ons:subscriptionId"]===this._subscriptionId));return(null!==(s=null==h?void 0:h["ons:changes"])&&void 0!==s?s:[]).forEach((t=>{const s=t["repo:assetId"];s&&e.add(s)})),this._nextChangeLogLinks=null==d?void 0:d._links,null===(o=null===(i=this._nextChangeLogLinks)||void 0===i?void 0:i.next)||void 0===o?void 0:o.nextPage}async fetchAndNotifyChanges(e=0){this._log(`Fetching ChangeLog for subscription ${this._subscriptionId}...`),this._retryChangeLogTimeout&&clearTimeout(this._retryChangeLogTimeout);const t=t=>{var s;const i=1e3*B(null===(s=t.response)||void 0===s?void 0:s.headers),r=Math.max(i,this._core.environment.getRetryInterval(e));this._log(`Retrying change log fetch in ${r}ms`),this._retryChangeLogTimeout=setTimeout((()=>this.fetchAndNotifyChanges(e+1)),r)},s=new Set;try{let e=!0;for(;e;)e=await this._fetchChangeLogPage(s)}catch(e){this._log(`Error fetching change log: ${e}`),t(e)}s.size&&(this._log(`Changed Assets: ${[...s].join(", ")}`),this._onsInterface.emit("change",s))}async validate(){if(!this._subscriptionHref)return this._assets.size>0?(this._log("assets exist for subscription but no _subscriptionHref was found, trying to _update() again..."),this._update()):void this._log("subscription has no assets and no _subscriptionHref set");let e;try{e=await this._core.environment.fetch(this._subscriptionHref,{authHeader:wt}),this._log(`Subscription ${this._subscriptionId} exists on the server`)}catch(e){return this._log(`Error checking ${this._subscriptionId}, it does not exist on the server`),void this._log(e)}return[200,201,204].includes(e.status)?void 0:(this._log("ONS subscription has been invalidated. Creating new subscription..."),this._subscriptionHref=void 0,this._subscriptionId=void 0,this._watchedAssets=new Map,this._update())}}h([V],St.prototype,"_update",null),h([V],St.prototype,"fetchAndNotifyChanges",null);const Et=Symbol("NotFound");class Tt{constructor(e,t){this._name=e,this._core=t}static isSupported(){if("undefined"==typeof window||!window.indexedDB)return!1;try{const e=window.indexedDB.open("sam_indexeddb_test",1);return e.onsuccess=()=>e.result.close(),!0}catch(e){return!1}}async _transaction(e,t){const s=await this._connect();if(s)return new Promise((i=>{try{const r=s.transaction(this._name,e),o=r.objectStore(this._name),n=t(o);r.onerror=e=>{this._core.environment.error(`transaction error: ${e}`),i(void 0)},r.oncomplete=()=>{i(n)}}catch(e){this._core.environment.error(`transaction exception: ${e}`),i(void 0)}}))}async getItem(e){return this._transaction("readonly",(async t=>new Promise((s=>{const i=t.get(e);i.onsuccess=()=>{s(i.result?{value:i.result.value,expiry:i.result.expiry}:void 0)}}))))}async setItem(e,t,s){return this._transaction("readwrite",(i=>{i.put({id:e,expiry:s,value:t})}))}async deleteItem(e){return this._transaction("readwrite",(t=>{t.delete(e)}))}async _connect(){if(this._database)return this._database;const e=this._core.environment.getValue("INDEXED_DB_VERSION"),t=window.indexedDB.open(this._name,e);return new Promise((s=>{t.onerror=e=>{this._core.environment.error(`CONNECTION_FAILED Unable to connect to IndexedDB: ${this._name}, error: ${e}`),s(void 0)},t.onupgradeneeded=()=>{const e=t.result;e.objectStoreNames.contains(this._name)&&e.deleteObjectStore(this._name),e.createObjectStore(this._name,{keyPath:"id"})},t.onsuccess=()=>{const i=this._database=t.result;i.onversionchange=t=>{this._core.environment.error(`IndexedDb version changed detected ${this._name}.${e}, ${t}`),i.close(),i.onversionchange=null,this._database=void 0},s(i)}}))}}class Ct{constructor(e,t){this._name=e,this._core=t}static isSupported(){try{return"undefined"!=typeof window&&!!window.localStorage}catch(e){return!1}}_getKey(e){return`${this._name}#${e}`}async getItem(e){const t=window.localStorage.getItem(this._getKey(e));if(t)try{const{value:e,expiry:s}=JSON.parse(t);return{value:e,expiry:s?new Date(s):void 0}}catch(e){}}async setItem(e,t,s){const i=JSON.stringify({expiry:s,value:t});window.localStorage.setItem(this._getKey(e),i)}async deleteItem(e){window.localStorage.removeItem(this._getKey(e))}}class Rt{constructor(e,t,s){this._userId=e,this._core=t,this._localCache=new Map,this._name="SAM.js-"+this._userId,s?this._persistentCache=s:Tt.isSupported()?this._persistentCache=new Tt(this._name,t):Ct.isSupported()&&(this._persistentCache=new Ct(this._name,t))}get name(){return this._name}async getItem(e,t,s){let i=this._localCache.get(e);!i&&this._persistentCache&&(i=await this._persistentCache.getItem(e));const r=s&&i&&!s(i.value),n=(null==i?void 0:i.expiry)&&i.expiry<=new Date(Date.now());if((r||n)&&(await this.deleteItem(e),i=void 0),!i&&t){const i=await t();if(s&&!s(i))throw new o("UNEXPECTED_RESPONSE",`Value for cache key ${e} is invalid: ${JSON.stringify(i)}`);return await this.setItem(e,i),i}return i?i.value:Et}async setItem(e,t,s=this._core.environment.getValue("CACHE_DEFAULT_TTL")){const i=s?new Date(Date.now()+s):void 0;this._localCache.set(e,{value:t,expiry:i}),this._persistentCache&&await this._persistentCache.setItem(e,t,i)}async deleteItem(e){this._localCache.delete(e),this._persistentCache&&await this._persistentCache.deleteItem(e)}}h([V,u(0,E)],Rt.prototype,"getItem",null);const Pt=[j.SUBSCRIPTION_CREATE,j.NOTIFICATIONS_LONGPOLL,j.ONS_CHANGELOG],Ot="X-User-Token",Dt="ONS_SUBSCRIPTIONS";class Lt extends W{constructor(e){super(),this._core=e,this._isStarted=!1,this._subscriptions=[],this._maxAssetsPerSubscription=5,this._assetIds=new Set,this._onSubscriptionChange=()=>{this._updateCachedSubscriptions(),this._startLongPoll()},this._onVisibilityChange=()=>{var e;this._stopTimeout&&(clearTimeout(this._stopTimeout),this._stopTimeout=void 0),"visible"===(null===(e=this._document)||void 0===e?void 0:e.visibilityState)?this._start():this._stopTimeout=setTimeout((()=>this._stop()),this._core.environment.getValue("ONS_DOCUMENT_VISIBILITY_TIMEOUT"))},this._cache=e.environment.cache}async _getSubscriptionConfig(){var e,t;try{const s=await this._getRootDocument();return null!==(t=null===(e=null==s?void 0:s.config)||void 0===e?void 0:e.subscriptions)&&void 0!==t?t:{}}catch(e){return this._log(`Error fetching subscription config from ONS root document: ${e}`),{}}}async _updateCachedSubscriptions(){const e=[];this._subscriptions.forEach((t=>{const{subscriptionId:s,subscriptionHref:i,assets:r}=t;if(!s||!i)return;const o={id:s,href:i,assets:Object.fromEntries(r)};e.push(o)})),await this._cache.setItem(Dt,JSON.stringify({subscriptions:e}),bt)}async _ensureSubscriptions(){const e=await this._getSubscriptionConfig(),t=e.maxSubscriptionPerLongPoll||this._core.environment.getValue("ONS_DEFAULT_MAX_SUBSCRIPTIONS");if(this._maxAssetsPerSubscription=e.maxAssetsPerRequest||this._core.environment.getValue("ONS_DEFAULT_MAX_ASSETS_PER_SUBSCRIPTION"),t>this._subscriptions.length){const e=await this._cache.getItem(Dt);let s=[];if(e!==Et)try{s=JSON.parse(e).subscriptions}catch(e){this._log("error parsing cached subscriptions")}for(let e=this._subscriptions.length;e<t;++e){const t=new St(this,s[e]);this._subscriptions.push(t),t.on("change",this._onSubscriptionChange)}}else if(t<this._subscriptions.length){for(let e=t;e<this._subscriptions.length;++e){const t=this._subscriptions[e];t.assets=new Map,t.off("change",this._onSubscriptionChange)}this._subscriptions.length=t}}get _activeSubscriptionIds(){return Array.from(this._subscriptions).filter((e=>e.subscriptionId&&e.watchedAssets.size>0)).map((e=>`${e.subscriptionId}`)).sort()}async _startLongPoll(){const e=this._activeSubscriptionIds,t=0===e.length?void 0:await this._getLink(j.NOTIFICATIONS_LONGPOLL,{includeJournal:"false",subscriptionId:e}),s=this._pollURL!==t;this._pollURL=t,this.isActive&&s&&(this._stop(),this._start())}_log(e){this._core.environment.debug(`ONS: ${e}`)}get isActive(){return Boolean(this._abortController)}get assetIds(){return new Set(this._assetIds)}get watchedAssetIds(){const e=new Set;return this._subscriptions.forEach((t=>{t.watchedAssets.forEach(((t,s)=>e.add(s)))})),e}get _document(){if("undefined"!=typeof window)return window.document}start(){var e;this._isStarted||(null===(e=this._document)||void 0===e||e.addEventListener("visibilitychange",this._onVisibilityChange),this._isStarted=!0,this._document&&"visible"!==this._document.visibilityState||this._start())}stop(){var e;this._isStarted&&(null===(e=this._document)||void 0===e||e.removeEventListener("visibilitychange",this._onVisibilityChange),this._isStarted=!1,this._subscriptions.forEach((e=>e.abort())),this._stop())}_stop(){if(!this.isActive)return;this._stopTimeout&&(clearTimeout(this._stopTimeout),this._stopTimeout=void 0),this._log("Stopping...");const e=this._abortController;delete this._abortController,this._abortController=void 0,null==e||e.abort()}_start(){this.isActive?this._log("Already starting skipping..."):(this._log("Starting..."),this._abortController=new AbortController,this._poll())}_truncateAssetIdsByMaxSizeIfNeeded(e){const t=this._maxAssetsPerSubscription*this._subscriptions.length;return e.size>t&&(this._log(`Number of assets ${e.size} exceeds the maximum allowed by ONS. Limiting to ${t}`),e=new Set(Array.from(e).slice(0,t))),e}async watch(e){await this._ensureSubscriptions();const t=new Set;e.forEach((s=>{var i;const r=this._core.hostAssetContext.assetPool.getLocalItemById(s),o=null!==(i=null==r?void 0:r.ancestorIDs)&&void 0!==i?i:[],n=o[o.length-1];e.has(n)&&!(null==r?void 0:r.isFolder)||t.add(s)})),this._assetIds=this._truncateAssetIdsByMaxSizeIfNeeded(t);const s=new Set,i=Array.from(this._subscriptions.map((e=>{const t=new Map;return e.assets.forEach(((e,i)=>{this._assetIds.has(i)&&s.add(i)&&t.set(i,e)})),t})));let r=0;this._assetIds.forEach((e=>{if(s.has(e))return;for(;i[r].size>=this._maxAssetsPerSubscription;)r++;const t=this._core.hostAssetContext.assetPool.getLocalItemById(e);i[r].set(e,(null==t?void 0:t.isFolder)?{directoryLevel:"shallow"}:{})})),this._subscriptions.forEach(((e,t)=>e.assets=i[t]))}async _poll(e=0){const t=(t,s=0)=>{s=Math.max(this._core.environment.getRetryInterval(e),s);const i=this._abortController;if(!i)return;this._log(`Retrying long poll in ${s}ms`);const r=setTimeout((()=>this._poll(e+1)),s);i.signal.addEventListener("abort",(()=>{i!==this._abortController&&clearTimeout(r)}))},s=this._abortController;if(s)try{if(void 0===this._pollURL)return void this._log("Poll URL undefined...");const e=this._pollURL,i=await this._core.environment.fetch(e,{signal:s.signal,authHeader:Ot});if(this._log(`Requested long poll for ${e}`),[200,201,204].includes(i.status)){const t=await i.json();this._log(`Successfull long poll for ${e}`),t&&t.subscriptions&&t.subscriptions.length>0&&(this._log(`Subscriptions changed: ${t.subscriptions.join(", ")}`),t.subscriptions.forEach((e=>{const t=this._subscriptions.find((t=>t.subscriptionId===e));null==t||t.fetchAndNotifyChanges()})),this.emit("notified")),t&&t.checkSubscriptions&&t.checkSubscriptions.length>0&&(this._log(`Checking subscriptions for subscriptions to check ${t.checkSubscriptions.length}`),t.checkSubscriptions.forEach((e=>{const t=this._subscriptions.find((t=>t.subscriptionId===e));t&&t.validate()}))),this._pollURL=t&&t._links&&t._links.next&&t._links.next.href,this._poll()}else 404===i.status?(this._log(`404 Response long poll for ${e}, subscription missing or expired`),this._subscriptions.forEach((e=>{e.subscriptionId&&e.validate()})),t(0,this._core.environment.getValue("MAX_RETRY_INTERVAL"))):(this._log(`Unexpected response, trying again ${e}`),t(0,1e3*B(i.headers)))}catch(e){if(s.signal.aborted&&s!==this._abortController)return void this.emit("aborted");this._log("Error trying to create long poll request"),t()}else this._log("No abort controller...")}async _getAndCacheDocument(e){return(await this._core.environment.fetch(e,{headers:{Accept:"application/vnd.syncservice.v2.hal+json"},authHeader:Ot})).json()}_getRootDocument(){return this._getAndCacheDocument(`https://${this._core.environment.endpoints.SYNC_SERVICE_HOST}/api/v1`)}async _getLink(e,t={}){return F((await this._getRootDocument())._links,e,t)}}h([V],Lt.prototype,"_updateCachedSubscriptions",null),h([V],Lt.prototype,"_startLongPoll",null),h([C((e=>e._links&&Pt.every((t=>e._links[t])))),u(0,E)],Lt.prototype,"_getAndCacheDocument",null);class xt{constructor(e,t){this.task=e,this.onGotOwnership=t}registerNewTask(e){let t=this;for(;t;){const s=t.next;if(!s)return void(t.next=e);t=s}}}class Nt extends te{constructor(e,t){super(),this._core=e,this.id=t}get lastKnownClientMutation(){return this._lastKnownClientMutation}updateLastKnownClientMutation(){this._lastKnownClientMutation=Date.now()}async waitForMutationPropagationIfNeeded(e){const t=this._lastKnownClientMutation;if(t){const s=t+e-Date.now();s>0&&await new Promise((e=>setTimeout(e,s)))}}get exclusiveTask(){var e;return null===(e=this._exclusiveTaskChain)||void 0===e?void 0:e.task}_setExclusiveTaskChain(e){this._exclusiveTaskChain=e,this.dispatch(ne)}static runExclusiveTask(e,t,s){return new Promise((i=>{const r={name:e,items:t},o=()=>i(s(r).finally((()=>{for(const e of t){const t=e._exclusiveTaskChain.next;e._setExclusiveTaskChain(t),null==t||t.onGotOwnership()}})));let n=0;const a=()=>{0==--n&&setTimeout(o,0)};for(const e of t){const t=new xt(r,a);let s=e._exclusiveTaskChain;s?(++n,s.registerNewTask(t)):e._setExclusiveTaskChain(t)}0===n&&o()}))}}function kt(e,t){return e.localeCompare(t)}function Mt(e,t){return e===t?0:e<t?-1:1}function jt(e){return class extends class{constructor(e,t,s){this.direction=e,this.field=t,this.comparator=s}get hash(){return this.direction+":"+this.field}sortItems(e){e.sort(this.comparator)}}{constructor(t,s){let i=e[s];"descending"===t&&(i=function(e){return(t,s)=>-e(t,s)}(i)),super(t,s,i)}}}h([O],Nt.prototype,"exclusiveTask",null);const Ut={name:"asset_name",created:"create_date",modified:"modify_date",shared:"shared_date"},Ft={name:(e,t)=>kt(e.name,t.name),shared:(e,t)=>Mt(e.shared,t.shared),created:(e,t)=>Mt(e.created,t.created),modified:(e,t)=>Mt(e.modified,t.modified)};class Bt extends(jt(Ft)){}Bt.default=new Bt("descending","shared");class $t extends Nt{get collaborators(){return this._core.collaborationContext.getCollaborators(this.id)}removeCollaborator(e){return this._core.collaborationContext.removeCollaborator(this.id,e)}get invitedCollaborators(){return this._core.collaborationContext.getInvitedCollaborators(this.id)}removeInvitedCollaborator(e){return this._core.collaborationContext.removeInvitedCollaborator(this.id,e)}}h([R],$t.prototype,"collaborators",null),h([R],$t.prototype,"invitedCollaborators",null);class Vt extends W{constructor(e,t){super(),this._core=e,this._asset=t,this._isLoaded=!1}async load(){await this._loadData(),this._isLoaded=!0,this.emit("change")}unload(){this._data=void 0,this._isLoaded=!1,this.emit("change")}_setData(e){this._data=e,this.emit("change")}get isLoaded(){return this._isLoaded}get data(){return this._data}}h([O],Vt.prototype,"isLoaded",null),h([O],Vt.prototype,"data",null);class Ht extends Vt{async _loadData(){await this._asset._ensureLink(j.EMBEDDED_METADATA);const e=await this._asset._getAssetInterface();this._data=await e.getEmbeddedMetadata()}}class Wt extends Vt{async _loadData(){await this._asset._ensureLink(j.APP_METADATA);const e=await this._asset._getAssetInterface();this._data=await e.getAppMetadata()}}class Gt extends Vt{constructor(){super(...arguments),this._etag=""}get etag(){return this._etag}async _loadData(){try{const e=await this._asset._getAssetInterface(),{manifest:t,etag:s}=await e.getManifest(this._etag);this._data=t,this._etag=s||""}catch(e){if("NOT_MODIFIED"!==e.code)throw e}}}h([O],Gt.prototype,"etag",null);const Yt=/^(CON|PRN|AUX|NUL|COM[1-9]|LPT[1-9])$/i,qt=/[\\/:*?"|><]/;function Jt(e){return e.length>0&&e.length<=255&&!Yt.test(e)&&!qt.test(e)}const zt=/^(.*\/)?(.*?)(?:[\u00A0][^.]*)?(\.[^.]*)?$/;function Kt(e,t,s){function i(e,t){let s=e.replace(/[()]/g,"\\$&");return s=s.replace("%d","([0-9]+)"),s=s.replace("%@","(.*)?"),s+=t?"(\\.[^.]*)$":"(\\.[^.]*)?$",s}const r=e.lastIndexOf(".")>e.lastIndexOf("/");let o=i(t,r);const n=t.replace(/ [^ ]*$/,"");let a=i(n,r),c=e.match(o),l=!1;null===c&&(c=e.match(a),l=null!==c);let d="",h="";if(c){let e="",t="",i="";l?[,e,t]=c:[,e,i,t]=c,d=e,h=t,l&&0===s?s=1:l||parseInt(i)!==s||(s+=1)}else{const[,t,s,i]=e.match(zt);d=`${t||""}${s||""}`,h=i}let u="";return 0!==s?(u=t.replace("%@",`${d||""}`),u=u.replace("%d",s.toString())):u=n.replace("%@",`${d||""}`),{newName:`${u||""}${h||""}`,countUsed:s}}function Xt(e,t,s,i,r){var o;let n=(null===(o=r.get(t))||void 0===o?void 0:o.countUsed)||0,a=!1,c=[];do{const o=i?Kt(s,e.environment.getValue("ASSET_COPY_NAME_FORMAT"),n):n>0?Kt(s,e.environment.getValue("ASSET_CONFLICT_NAME_FORMAT"),n):{newName:s,countUsed:n};s=o.newName,n=o.countUsed,a=!1;for(const[e,t]of r)if(t.newName===s){a=!0,c.push(e);break}a?n++:r.set(t,o)}while(a);for(const e of c){const t=r.get(e);r.set(e,{newName:t.newName,countUsed:n})}return s}const Qt=/^(.*\..*)\^.*$/,Zt={"cloud-content-archive":"cloud-content","assets-archive":"assets",archive:"files"};function es(e,t){const s=e.split("/"),i="users"===s[1]?3:1,r=Zt[s[i]];if(r)return s[i]=r,s[s.length-1]=t||function(e){const t=e.match(Qt);return t?t[1]:e}(s[s.length-1]),s.join("/")}function ts(e,t){const s=t.repoPath.split("/").slice(0,-1);return s.push(e),s.join("/")}function ss(e){const{assetPool:t,asset:s,session:i,newPath:r}=e;s.isFolder&&t.forEach((e=>{if(e.repoPath.startsWith(s.repoPath+"/")){const t=e.repoPath.replace(s.repoPath,r);bi.updateLocalItem(i,e,{"repo:path":t})}}))}const is=["file","composite","directory","entity"],rs=["hiddenSelf","hiddenRecursive",""];class os extends class extends class{constructor(e){this._propertyUpdater=e.propertyUpdater,this._changeEvent=e.changeEvent||ne}updateLocalItem(e,t,s){e.checkIfItemAllowsMutations(t)&&(e.ensureItemIsAdded(t),this._propertyUpdater.update(t,s)&&e.queueChangedItem(t,this._changeEvent))}}{constructor(e){super(e),this._localItemType=e.localItemType,this._getRemoteId=e.getRemoteId}updateRemoteItem(e,t){const s=this._getRemoteId(t);if(!s)throw new o("INVALID_DATA","Missing id on the remote item structure.");let i=e.getItemById(s);return i||(i=new(0,this._localItemType)(e._core,s)),this.updateLocalItem(e,i,t),i}updateRemoteItems(e,t){if(!Array.isArray(t))throw new o("INVALID_DATA","Invalid data received, expected list of items.");return t.map((t=>this.updateRemoteItem(e,t)))}}{constructor(e){super(Object.assign({getRemoteId:t=>t[e.remoteIdProperty]},e))}}const ns=Symbol("NotFound"),as={string:{parse:String,isEqual:vt},number:{parse:Number,isEqual:vt},date:{parse:e=>new Date(String(e)),isEqual:(e,t)=>(null==e?void 0:e.toISOString())===(null==t?void 0:t.toISOString())},date_as_number:{parse:e=>new Date(Number(e)),isEqual:(e,t)=>(null==e?void 0:e.toISOString())===(null==t?void 0:t.toISOString())},boolean:{parse:e=>!0===e||"string"==typeof e&&"true"===e.toLowerCase()||"number"==typeof e&&Boolean(e),isEqual:vt},object:{parse:function(e){return JSON.parse(JSON.stringify(e))},isEqual:It}};function cs(e){const t=e.split(".");return e=>{let s=e;for(const e of t){if(!Object.prototype.hasOwnProperty.call(s,e))return ns;s=s[e]}return s}}function ls(e,t,s){if(!t)return s?as.object:as.string;if("string"==typeof t){if(!Object.prototype.hasOwnProperty.call(as,t))throw new o("INVALID_PARAMETER",`Unexpected type format ${t} for ${e} property updater.`);return as[t]}return t}function ds(e,t,s,i){return!(s&&!s.includes(i)&&(e._core.environment.error(`Invalid value ${i} passed for the ${t} property. Expected one of ${s.join(", ")}.`),1))}class hs{constructor(e){this._updaters=Object.keys(e).map((t=>function(e,t){const s=function(e,t){if("string"==typeof t)return{name:e,format:as.string,get:cs(t),isArray:!1};const{name:s,format:i,choices:r,get:o,isArray:n,mapByKey:a}=t,c=null!=s?s:e;return{name:c,format:ls(c,i,a),choices:r,mapByKey:a,isArray:null!=n&&n,get:null!=o?o:cs(null!=s?s:e)}}(e,t),{name:i,format:r,choices:o,get:n,isArray:a,mapByKey:c}=s;return(t,s)=>{const l=t;let d=n(s,t);if(d===ns)return!1;if(c){if(!Array.isArray(d))return t._core.environment.error(`Invalid value ${d} passed for the ${i} property. Expected an array.`),!1;const s=new Map;for(const e of d){if(!Object.prototype.hasOwnProperty.call(e,c)){t._core.environment.error(`Invalid item passed for the ${i} array property. Missing ${c} property on the item of the array.`);continue}const n=e[c],a=r.parse(e);ds(t,i,o,a)&&s.set(n,a)}if(It(l[e],s,r.isEqual))return!1;d=s}else if(a){if(!Array.isArray(d))return t._core.environment.error(`Invalid value ${d} passed for the ${i} property. Expected an array.`),!1;const s=[];for(const e of d){const n=r.parse(e);ds(t,i,o,n)&&s.push(n)}if(It(l[e],d,r.isEqual))return!1;d=s}else{if(d=r.parse(d),!ds(t,i,o,d))return!1;if(r.isEqual(l[e],d))return!1}return l[e]=d,!0}}(t,e[t])))}update(e,t){let s=!1;for(const i of this._updaters)i(e,t)&&(s=!0);return s}}class us{constructor(e){var t,s;this._mediaTypes=void 0,this._excludeMediaTypes=void 0,this._includeHiddenRecursive=!1,(null==e?void 0:e.mediaTypes)&&(this._mediaTypes=new Set(e.mediaTypes)),(null==e?void 0:e.excludeMediaTypes)&&(this._excludeMediaTypes=new Set(e.excludeMediaTypes)),(null===(t=null==e?void 0:e.mediaTypes)||void 0===t?void 0:t.length)&&(null===(s=null==e?void 0:e.excludeMediaTypes)||void 0===s?void 0:s.length)&&(this._mediaTypes=new Set([]),console.warn("Both mediaTypes and excludeMediaTypes should not be specified while creating AdobeAssetFilter, setting default value for mediaTypes")),this._includeHiddenRecursive=!!(null==e?void 0:e._includeHiddenRecursive)}get mediaTypes(){return this._mediaTypes}get excludeMediaTypes(){return this._excludeMediaTypes}matches(e){var t,s;return!("hiddenSelf"===e.shellVisibility||"hiddenRecursive"===e.shellVisibility&&!this._includeHiddenRecursive)&&(!(null===(t=this._excludeMediaTypes)||void 0===t?void 0:t.size)||!this._excludeMediaTypes.has(e.mediaType))&&(!(null===(s=this._mediaTypes)||void 0===s?void 0:s.size)||this._mediaTypes.has(e.mediaType))}get hash(){var e,t;let s="mediatypes="+((null===(e=this._mediaTypes)||void 0===e?void 0:e.size)?`${[...this._mediaTypes].sort().join(",")}`:"all-types");return s+=":excludemediatypes="+((null===(t=this._excludeMediaTypes)||void 0===t?void 0:t.size)?`${[...this._excludeMediaTypes].sort().join(",")}`:"none"),s}getRelationToFilter(e){var t,s,i,r,o,n,a,c,l,d,h,u;let p;function _(e,t){let s=!0,i=!1;for(const r of e)t.has(r)?i=!0:s=!1;return i?s?p.subset:p.intersaction:p.disjoint}!function(e){e[e.uninitialized=0]="uninitialized",e[e.subset=1]="subset",e[e.disjoint=2]="disjoint",e[e.intersaction=3]="intersaction"}(p||(p={}));let m=p.uninitialized,f=p.uninitialized,g=p.uninitialized,y=p.uninitialized;return(null===(t=this._mediaTypes)||void 0===t?void 0:t.size)&&(null===(s=e._mediaTypes)||void 0===s?void 0:s.size)&&(m=_(this._mediaTypes,e._mediaTypes)),(null===(i=this._mediaTypes)||void 0===i?void 0:i.size)&&(null===(r=e._excludeMediaTypes)||void 0===r?void 0:r.size)&&(f=_(this._mediaTypes,e._excludeMediaTypes)),(null===(o=this._excludeMediaTypes)||void 0===o?void 0:o.size)&&(null===(n=e._mediaTypes)||void 0===n?void 0:n.size)&&(g=_(e._mediaTypes,this._excludeMediaTypes)),(null===(a=this._excludeMediaTypes)||void 0===a?void 0:a.size)&&(null===(c=e._excludeMediaTypes)||void 0===c?void 0:c.size)&&(y=_(e._excludeMediaTypes,this._excludeMediaTypes)),g===p.subset||f===p.subset||m===p.disjoint?"disjoint":y===p.intersaction||g===p.intersaction||f===p.intersaction||m===p.intersaction?"unknown":(null===(l=this._mediaTypes)||void 0===l?void 0:l.size)||(null===(d=this._excludeMediaTypes)||void 0===d?void 0:d.size)||!(null===(h=e._mediaTypes)||void 0===h?void 0:h.size)&&!(null===(u=e._excludeMediaTypes)||void 0===u?void 0:u.size)?"subset":"unknown"}}class ps extends us{constructor(e){super({mediaTypes:null==e?void 0:e.mediaTypes,excludeMediaTypes:null==e?void 0:e.excludeMediaTypes}),this._asset=null==e?void 0:e.asset}get asset(){return this._asset}get hash(){var e;return[null===(e=this._asset)||void 0===e?void 0:e.id,super.hash].filter((e=>e)).join(":")}matches(e){var t;if(e.isSharedWithYouAsset)return!1;if(this.asset&&this.asset.repositoryID&&e.repositoryID&&this.asset.repositoryID!==e.repositoryID)return!1;const s=null===(t=this._asset)||void 0===t?void 0:t.repoPath;return(!s||s===e.repoPath.substring(0,e.repoPath.lastIndexOf("/")))&&super.matches(e)}getRelationToFilter(e){var t,s,i,r;const o=null===(t=this.asset)||void 0===t?void 0:t.repoPath,n=null===(s=e.asset)||void 0===s?void 0:s.repoPath;if(o&&n&&o!==n)return"disjoint";const a=null===(i=this.asset)||void 0===i?void 0:i.repositoryID,c=null===(r=e.asset)||void 0===r?void 0:r.repositoryID;if(a&&c&&a!==c)return"disjoint";const l=super.getRelationToFilter(e);return"disjoint"===l?"disjoint":"unknown"===l||!o&&n?"unknown":l}}class _s extends us{constructor(e){super({mediaTypes:null==e?void 0:e.mediaTypes,excludeMediaTypes:null==e?void 0:e.excludeMediaTypes}),this._deepSearch=null==e?void 0:e.deepSearch,this._query=null==e?void 0:e.query,this._asset=null==e?void 0:e.asset}get hash(){var e;return[null===(e=this._asset)||void 0===e?void 0:e.id,super.hash,void 0!==this.deepSearch?`deepSearch=${this._deepSearch}`:void 0,this.query?`query=${this._query}`:void 0].filter((e=>e)).join(":")}get deepSearch(){return this._deepSearch}get asset(){return this._asset}get query(){return this._query}matches(e){if(e.isSharedWithYouAsset)return!1;if(this.asset&&this.asset.repositoryID&&e.repositoryID&&this.asset.repositoryID!==e.repositoryID)return!1;if(this.asset&&this.asset.repoPath&&e.repoPath){const t=this.asset.repoPath;if(this.deepSearch){if(!e.repoPath.startsWith(w(t,"/")))return!1}else if(t!==e.repoPath.substring(0,e.repoPath.lastIndexOf("/")))return!1}return super.matches(e)}getRelationToFilter(e){var t,s,i,r;const o=null===(t=this.asset)||void 0===t?void 0:t.repositoryID,n=null===(s=e.asset)||void 0===s?void 0:s.repositoryID;return o&&n&&o!==n||this.deepSearch!==e.deepSearch||(null===(i=this.query)||void 0===i?void 0:i.toLowerCase())!==(null===(r=e.query)||void 0===r?void 0:r.toLowerCase())?"disjoint":super.getRelationToFilter(e)}}const ms={name:"repo:name",created:"storage:deviceCreateDate",modified:"storage:deviceModifyDate",shared:"storage:deviceModifyDate"},fs={name:(e,t)=>kt(e.name,t.name),created:(e,t)=>Mt(e.created,t.created),modified:(e,t)=>Mt(e.modified,t.modified),shared:(e,t)=>Mt(e.shared,t.shared)};class gs extends(jt(fs)){}function ys(e,t){return e===t?"subset":e&&t?e.hash===t.hash?"subset":"subset"===t.getRelationToFilter(e)?"unknown":t instanceof vs?function(e,t){const s=t.filterA,i=t.filterB,r=ys(e,s),o=ys(e,i);return"disjoint"===r||"disjoint"===o?"disjoint":"unknown"===r||"unknown"===o?"unknown":"subset"}(e,t):e.getRelationToFilter(t):e?"subset":"unknown"}gs.default=new gs("descending","modified");class vs{constructor(e,t){this._filterA=e,this._filterB=t}get filterA(){return this._filterA}get filterB(){return this._filterB}get hash(){return[this.filterA.hash,this.filterB.hash].sort().join(":")}matches(e){return this.filterA.matches(e)&&this.filterB.matches(e)}getRelationToFilter(e){if(e.hash===this.filterA.hash||e.hash===this.filterB.hash)return"subset";const t=ys(this.filterA,e),s=ys(this.filterB,e);return"disjoint"===t||"disjoint"===s?"disjoint":"unknown"===t||"unknown"===s?"unknown":"subset"}}class Is{constructor(e,t,s){this._assetPool=e,this._asset=t,this._includePermissions=s}supportsFilter(e){return void 0!==e}async loadPage(e){return await this._loadPage(e)}async _loadPage(e,t){var s,i,r;const{updateContext:o,order:n,limit:a,filter:c}=e;let l=[];if(c)if(c instanceof vs){const e=c.filterA,t=c.filterB;l=[...null!==(s=e.mediaTypes)&&void 0!==s?s:[],...null!==(i=t.mediaTypes)&&void 0!==i?i:[]]}else l=[...null!==(r=c.mediaTypes)&&void 0!==r?r:[]];const d=this._assetPool._core.environment.getValue("ASSETS_LIST_UPDATE_LATENCY"),h=Date.now()-d;let u,p;const _=[{resource:{reltype:j.APP_METADATA},selectors:Be.map((e=>'"'+e+'"'))}];this._includePermissions&&_.push({resource:{reltype:j.AC_EFFECTIVE}});const m=(await this._asset._getAssetInterface()).getChildAssets({orderBy:ms[n.field],orderDirection:n.direction,start:t,limit:a,type:l,embed:_}),f=this._asset._core.environment.getValue("USE_USS_TO_UPDATE_SBM");try{f&&(p=await this._asset._core.hostAssetContext.sbmInterface.getSharedByMeAssets(this._asset.id,{orderBy:Ut[n.field],orderDirection:n.direction,start:Number(t),limit:a,type:l}))}catch(e){}u=await m;const g=this._assetPool.createUpdateSession(o,h),y=bi.updateRemoteItems(g,u.children.map((e=>{var t;if(e["repo:ancestors"]||(e["repo:ancestors"]=[...null!==(t=this._asset.ancestorIDs)&&void 0!==t?t:[],this._asset.id]),p){let t;const s=p.result_sets[0].items.find((t=>t.asset_id===e["repo:assetId"]));return s&&(t=!!s.collab_metadata),Object.assign(Object.assign({},e),{isSharedByMe:t})}return e})));let v;g.commit();const I=u._page.next;return I&&(v=e=>this._loadPage(e,I)),{items:y,loadNextPage:v,mostRecentValidMutation:h}}}const ws={name:"asset_name",created:"create_date",modified:"modify_date"},As={name:(e,t)=>kt(e.name,t.name),created:(e,t)=>Mt(e.created,t.created),modified:(e,t)=>Mt(e.modified,t.modified)};class bs extends(jt(As)){}bs.default=new bs("descending","modified");class Ss{constructor(e,t,s,i){this._adobeAssetSearchInterface=s,this._asset=i,this._ussLoaderHelper=new Ti(e,t,this)}supportsFilter(e){return void 0!==e}async loadPage(e){return this._ussLoaderHelper.loadPage(e)}async _getUSSResults({start:e,limit:t,order:s,filter:i,mediaTypes:r,excludeMediaTypes:o}){let n,a=!1;if(i)if(i instanceof vs){const e=i.filterA,t=i.filterB;n=e.query||t.query,a=Boolean(e.deepSearch||t.deepSearch)}else n=i.query,a=Boolean(i.deepSearch);return this._adobeAssetSearchInterface.getFilteredAssets({orderBy:ws[s.field],orderDirection:s.direction,start:e,limit:t,mediaTypes:r,excludeMediaTypes:o,query:n,deepSearch:a,assetId:this._asset.cloudID})}_getItemData(e){return Object.assign(Object.assign({},e),{"repo:repositoryId":this._asset.repositoryID})}}var Es={exports:{}},Ts="undefined"!=typeof crypto&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto)||"undefined"!=typeof msCrypto&&"function"==typeof window.msCrypto.getRandomValues&&msCrypto.getRandomValues.bind(msCrypto);if(Ts){var Cs=new Uint8Array(16);Es.exports=function(){return Ts(Cs),Cs}}else{var Rs=new Array(16);Es.exports=function(){for(var e,t=0;t<16;t++)0==(3&t)&&(e=4294967296*Math.random()),Rs[t]=e>>>((3&t)<<3)&255;return Rs}}for(var Ps=[],Os=0;Os<256;++Os)Ps[Os]=(Os+256).toString(16).substr(1);var Ds,Ls,xs=function(e,t){var s=t||0,i=Ps;return[i[e[s++]],i[e[s++]],i[e[s++]],i[e[s++]],"-",i[e[s++]],i[e[s++]],"-",i[e[s++]],i[e[s++]],"-",i[e[s++]],i[e[s++]],"-",i[e[s++]],i[e[s++]],i[e[s++]],i[e[s++]],i[e[s++]],i[e[s++]]].join("")},Ns=Es.exports,ks=xs,Ms=0,js=0,Us=Es.exports,Fs=xs,Bs=function(e,t,s){var i=t&&s||0,r=t||[],o=(e=e||{}).node||Ds,n=void 0!==e.clockseq?e.clockseq:Ls;if(null==o||null==n){var a=Ns();null==o&&(o=Ds=[1|a[0],a[1],a[2],a[3],a[4],a[5]]),null==n&&(n=Ls=16383&(a[6]<<8|a[7]))}var c=void 0!==e.msecs?e.msecs:(new Date).getTime(),l=void 0!==e.nsecs?e.nsecs:js+1,d=c-Ms+(l-js)/1e4;if(d<0&&void 0===e.clockseq&&(n=n+1&16383),(d<0||c>Ms)&&void 0===e.nsecs&&(l=0),l>=1e4)throw new Error("uuid.v1(): Can't create more than 10M uuids/sec");Ms=c,js=l,Ls=n;var h=(1e4*(268435455&(c+=122192928e5))+l)%4294967296;r[i++]=h>>>24&255,r[i++]=h>>>16&255,r[i++]=h>>>8&255,r[i++]=255&h;var u=c/4294967296*1e4&268435455;r[i++]=u>>>8&255,r[i++]=255&u,r[i++]=u>>>24&15|16,r[i++]=u>>>16&255,r[i++]=n>>>8|128,r[i++]=255&n;for(var p=0;p<6;++p)r[i+p]=o[p];return t||ks(r)},$s=function(e,t,s){var i=t&&s||0;"string"==typeof e&&(t="binary"===e?new Array(16):null,e=null);var r=(e=e||{}).random||(e.rng||Us)();if(r[6]=15&r[6]|64,r[8]=63&r[8]|128,t)for(var o=0;o<16;++o)t[i+o]=r[o];return t||Fs(r)},Vs=$s;Vs.v1=Bs,Vs.v4=$s;var Hs,Ws=Vs;function Gs(){return"undefined"!=typeof crypto&&crypto.randomUUID?crypto.randomUUID():Ws.v4()}!function(e){e[e.NotStarted=1]="NotStarted",e[e.HadLoaderErrors=2]="HadLoaderErrors",e[e.Loading=3]="Loading",e[e.ReadyHasMorePages=4]="ReadyHasMorePages",e[e.ReadyFullyLoaded=5]="ReadyFullyLoaded"}(Hs||(Hs={}));const Ys="loaderStateChanged";class qs extends se{constructor(e=!1){super(Ys),this.hasUpdatedItems=e}}const Js=new qs(!1),zs=new qs(!0);class Ks{constructor(){this.startedGeneration=0,this.loadedGeneration=0}}class Xs extends te{constructor(e,t,s,i){super(),this._updateContext=e,this._loader=t,this._order=s,this._filter=i,this.status=Hs.NotStarted,this._pages=[],this._generation=0,this._nextPageIndex=0,this._loadAllPages=!1}get mostRecentValidMutation(){return this._mostRecentValidMutation}async load(e,t,s){this._loadAllPages=t,this._generation=e,this._nextPageCallback=void 0,this._nextPageIndex=0,this._pendingLoad=void 0,await this._loadPage(s)}async loadNextPage(e){await this._loadPage(e)}async loadAllPages(e){this._loadAllPages=!0,await this._loadPage(e)}collectAllItems(e){for(const t of this._pages)if(t&&t.items)for(const s of t.items)e.add(s)}_ensurePage(e){let t=this._pages[e];return t||(t=new Ks,this._pages[e]=t),t}async _loadPage(e){let t=this._pendingLoad;t||(t=this._loadPageImpl(e),this._pendingLoad=t),await t,this._pendingLoad===t&&(this._pendingLoad=void 0)}async _loadPageImpl(e){const t=this._nextPageCallback,s=this._nextPageIndex;if(s&&!t)return;const i=this._ensurePage(s),r=this._generation;if(i.startedGeneration>=r)return;const o=i.startedGeneration;let n,a;i.startedGeneration=r,this.error=null,this._updateStatus(Hs.Loading);try{const s=null!=e?e:i.limit,r={updateContext:this._updateContext,order:this._order,filter:this._filter,limit:s};t?(n=await t(r),this._nextPageCallback=void 0):(n=await this._loader.loadPage(r),this._mostRecentValidMutation=n.mostRecentValidMutation),i.limit=s}catch(e){a=e}if(!(i.loadedGeneration>=r)){if(a){if(i.startedGeneration!==r)return;i.startedGeneration=o}else if(n){const e=this._filter;i.items=e?n.items.filter(e.matches.bind(e)):n.items,this.total=n.total,i.loadedGeneration=r}this._updateStatusAndLinkToNextPage(r,s,n,a)&&await this._loadPageImpl(e)}}_updateStatusAndLinkToNextPage(e,t,s,i){if(this._generation!==e||this._nextPageIndex!==t)return s&&this.dispatch(zs),!1;if(!s)return this.error=i,this._updateStatus(Hs.HadLoaderErrors),!1;this._nextPageIndex=t+1,this._nextPageCallback=s.loadNextPage,s.loadNextPage||this._pages.splice(this._nextPageIndex),this._updateStatus(s.loadNextPage?Hs.ReadyHasMorePages:Hs.ReadyFullyLoaded);const r=this._nextPageIndex<this._pages.length;return this._loadAllPages||r}_updateStatus(e){const t=e===Hs.ReadyFullyLoaded||e===Hs.ReadyHasMorePages;(t||e!==this.status)&&(this.status=e,this.dispatch(t?zs:Js))}}const Qs=new Set;function Zs(e,t){Qs.has(e)||(console.warn("One time warning (%s): %s",e,t),Qs.add(e))}const ei="statusChanged",ti="listChanged",si=new class extends se{constructor(){super(ti)}},ii=new class extends se{constructor(){super(ei)}};let ri=0;class oi extends te{constructor(e,t,s,i,r,o){super(),this._itemPool=e,this.order=s,this.filter=i,this._loadOptions=o,this._status=Hs.NotStarted,this._items=[],this._generation=0,this._completedGeneration=0,this._loaderStates=[],this._lastFetchTime=0,this._needsRefresh=!1,this._itemUpdatesByGeneration=new Map,this._updateContext=Gs(),this._onUnhandledPromiseError=e=>{var t;this._updateListStatusFromItemLoaderStates(),(null===(t=this._errors)||void 0===t?void 0:t.length)||(this._errors=[]),this._errors.push(e),this._status=Hs.HadLoaderErrors,this.emit(ei)},this._handlePendingLoad=async()=>{const e=this._pendingLoad;if(e){const{loadAllPages:t,limit:s}=e;this._pendingLoad=void 0,this._debug("_handlePendingLoad() awaiting _runLoaders for loaderState.load"),await this._runLoaders((e=>e.load(this._generation,t,s)))}},this._onItemLoaderStateChanged=e=>{const{hasUpdatedItems:t}=e;this._cleanPreviousGenerationItemsIfNeeded(),t&&this._updateListItemsFromItemLoaderStates()},this._globalStateChangedEvent=new no(this),this._itemPoolDelegate={onItemsUpdated:e=>{if(e.updateContext===this._updateContext)return;let t=this._pendingNotifications;t||(t=[],this._pendingNotifications=t),t.push({generation:this._generation,event:e}),this._updateListItemsFromItemLoaderStates()}};for(const e of t){if(e.supportsFilter&&!e.supportsFilter(i))continue;const t=new Xs(this._updateContext,e,s,i);t.on(Ys,this._onItemLoaderStateChanged),this._loaderStates.push(t)}r&&this._copyInitialItemsFrom(r),e.addDelegate(this._itemPoolDelegate,"list")}_debug(e){this._core.environment.debug(`[ItemList ${this._itemPool.type} ${this._updateContext.slice(-4)}] ${e}`)}_updateLoadOptions(e={}){var t,s;this._loadOptions||(this._loadOptions={}),this._loadOptions.limit&&e.limit&&this._loadOptions.limit<e.limit&&(this._loadOptions.limit=e.limit),!this._loadOptions.loadAllPages&&e.loadAllPages&&(this._loadOptions.loadAllPages=e.loadAllPages),-1!==e.refreshTimeout&&(-1===this._loadOptions.refreshTimeout||(null!==(t=this._loadOptions.refreshTimeout)&&void 0!==t?t:0)>=(null!==(s=e.refreshTimeout)&&void 0!==s?s:0))&&(this._loadOptions.refreshTimeout=e.refreshTimeout),this._loadAsync(Object.assign(Object.assign({},this._loadOptions),{refreshTimeout:-1===e.refreshTimeout?-1:this._loadOptions.refreshTimeout})).catch(this._onUnhandledPromiseError)}get type(){return this._itemPool.type}get generation(){return this._generation}get completedGeneration(){return this._completedGeneration}get hasLoaders(){return this._loaderStates.length>0}get _core(){return this._itemPool._core}_copyInitialItemsFrom(e){const t=new Map,s=this.filter;for(const i of e.items)s&&!s.matches(i)||t.set(i,!0);this._generation=e.generation,this._completedGeneration=e.completedGeneration,this._itemUpdatesByGeneration.set(this._generation,t),e.status===Hs.ReadyFullyLoaded&&"subset"===ys(s,e.filter)&&(this._status=Hs.ReadyFullyLoaded),this._updateListItemsFromItemLoaderStates()}get status(){return this._loaderStates.length?this._status:Hs.ReadyFullyLoaded}get errors(){return this._errors}get items(){return this._items}get total(){return this._total}_cleanPreviousGenerationItemsIfNeeded(){let e;for(const t of this._loaderStates){const{status:s,mostRecentValidMutation:i}=t;if(s!==Hs.NotStarted&&t.status!==Hs.HadLoaderErrors){if(s===Hs.Loading||s===Hs.ReadyHasMorePages)return;i&&(e=e?Math.min(e,i):i)}}this._cleanPreviousGenerationItems(e)}_cleanPreviousGenerationItems(e){this._applyItemsChangedEvents();const t=this._generation;this._completedGeneration=t;const s=new Map;let i=!1,r=0;for(const[o,n]of this._itemUpdatesByGeneration)if(!(o>=t)&&(i=!0,this._itemUpdatesByGeneration.delete(o),r=Math.max(r,o),e))for(const[t,i]of n){const{lastKnownClientMutation:r}=t;(s.has(t)||r&&r>e)&&s.set(t,i)}s.size&&this._itemUpdatesByGeneration.set(r,s),i&&this._dispatchItemsChangedEvent()}refresh(){this._loadAsync(this._loadOptions).catch(this._onUnhandledPromiseError)}load(e){Zs("ItemList.load","ItemList.load() will be deprecated, use ItemList.refresh() instead. List load parameters are passed as the 3rd parameter to ItemSource.getList(), which now automatically starts loading."),e=Object.assign({refreshTimeout:0},e),this._updateLoadOptions(e)}async _loadAsync(e){var t,s;if(!this._loaderStates.length)return;const i=null!==(t=null==e?void 0:e.refreshTimeout)&&void 0!==t?t:0,r=null!==(s=null==e?void 0:e.loadAllPages)&&void 0!==s&&s,o=this._lastFetchTime;if(this._needsRefresh||!o||!i||-1!==i&&o+i<Date.now())return this._debug(`_loadAsync() calling _load(): _needsRefresh: ${this._needsRefresh}, lastFetchTime: ${o} refreshTimeout: ${i}`),void await this._load(r,null==e?void 0:e.limit);this._debug(`_loadAsync() not time to refresh: _needsRefresh: ${this._needsRefresh}, lastFetchTime: ${o} refreshTimeout: ${i}`);const n=this._previousLoadPromise;n&&(this._debug("_loadAsync() awaiting previousLoadPromise"),await n),r&&await this._ensureAllPagesAreLoaded(null==e?void 0:e.limit)}async _load(e,t){this._needsRefresh=!1;let s=this._pendingLoad;s?e&&(s.loadAllPages=!0):(this._status=Hs.Loading,this._lastFetchTime=Date.now(),this._generation=++ri,this._debug("_load() creating _pendingLoad"),this._pendingLoad=s={loadAllPages:e,limit:t,promise:Promise.resolve().then(this._handlePendingLoad)},this._dispatchStateChangedEvents()),this._debug("_load() awaiting _pendingLoad"),await s.promise}loadNextPage(e){this._loadNextPageAsync(e||this._loadOptions).catch(this._onUnhandledPromiseError)}async _loadNextPageAsync(e){this._loaderStates.length&&(this._pendingLoad?(this._debug("_loadNextPageAsync() awaiting _pendingLoad"),await this._pendingLoad.promise):(this._status=Hs.Loading,this._dispatchStateChangedEvents(),this._debug("_loadNextPageAsync() awaiting _runLoaders for loaderState.loadNextPage"),await this._runLoaders((t=>t.loadNextPage(null==e?void 0:e.limit)))))}async _runLoaders(e){this._lastFetchTime=Date.now();const t=Promise.all(this._loaderStates.map(e));this._previousLoadPromise=t;try{this._debug("_runLoaders() awaiting loaders"),await t}finally{this._debug("_runLoaders() loaders complete"),this._previousLoadPromise=void 0,this._updateListStatusFromItemLoaderStates(),this._dispatchStateChangedEvents()}}setNeedsRefresh(){if(this.status!==Hs.NotStarted&&this._loaderStates.length)return this.listenerCount(ti)?(this._needsRefresh=!0,void this.refresh()):void(this._needsRefresh=!0)}_onEventListenerAdded(){this._needsRefresh&&this.listenerCount(ti)&&this.refresh()}async _ensureAllPagesAreLoaded(e){this.status===Hs.ReadyHasMorePages&&await this._runLoaders((t=>t.loadAllPages(e)))}_dispatchStateChangedEvents(){this._debug(`_dispatchStateChangedEvents status: ${Hs[this.status]}`),this.dispatch(ii),this._core.dispatch(this._globalStateChangedEvent)}_updateListStatusFromItemLoaderStates(){var e;let t=this._pendingLoad?Hs.Loading:Hs.NotStarted;this._errors=void 0;for(const s of this._loaderStates)switch(s.status){case Hs.HadLoaderErrors:if(this._pendingLoad)break;return this._status=Hs.HadLoaderErrors,void(this._errors=[s.error]);case Hs.ReadyHasMorePages:t===Hs.Loading||(null===(e=this._loadOptions)||void 0===e?void 0:e.loadAllPages)||(t=Hs.ReadyHasMorePages);break;case Hs.Loading:t=Hs.Loading;break;case Hs.ReadyFullyLoaded:t!==Hs.ReadyHasMorePages&&t!==Hs.Loading&&(t=Hs.ReadyFullyLoaded)}this._status=t}_dispatchItemsChangedEvent(){this.dispatch(si)}_updateListItemsFromItemLoaderStates(){this._applyItemsChangedEvents();const e=new Set;let t;for(const s of this._loaderStates)s.collectAllItems(e),void 0!==s.total&&(t=Math.max(t||0,s.total));for(const t of this._itemUpdatesByGeneration.values())for(const[s,i]of t.entries())i?e.add(s):e.delete(s);const s=Array.from(e);this.order.sortItems(s),this._items=s,this._total=t,this._dispatchItemsChangedEvent()}_applyItemsChangedEvents(){const e=this._pendingNotifications;if(!e)return;this._pendingNotifications=void 0;const{filter:t}=this;for(const s of e){const{event:e,generation:i}=s;if(i<this._completedGeneration)continue;let r=this._itemUpdatesByGeneration.get(i);if(r||(r=new Map,this._itemUpdatesByGeneration.set(i,r)),e.addedItems)for(const s of e.addedItems)t&&!t.matches(s)||r.set(s,!0);if(e.changedItems)for(const s of e.changedItems){const e=!t||t.matches(s);r.set(s,e)}if(e.discardedItems)for(const t of e.discardedItems)r.set(t,!1)}}}var ni,ai;function ci(e,t){return e.filterRelation!==t.filterRelation?"subset"===e.filterRelation?-1:1:e.generation!==t.generation?t.generation-e.generation:t.length-e.length}h([O(ei)],oi.prototype,"status",null),h([O(ei)],oi.prototype,"errors",null),h([O(ti)],oi.prototype,"items",null),h([O(ti)],oi.prototype,"total",null),function(e){e[e.Ascending=0]="Ascending",e[e.Descending=1]="Descending"}(ni||(ni={})),function(e){e[e.Name=0]="Name",e[e.Modified=1]="Modified",e[e.Created=2]="Created",e[e.Shared=3]="Shared"}(ai||(ai={}));class li{constructor(e,t,s){this._itemPool=e,this._loaders=t,this._implicitFilter=s,this._lists=new Map}getList(e,t,s){if("number"==typeof e||"number"==typeof t)throw new o("NOT_IMPLEMENTED","Using OrderDirection and OrderField is not implemented in SAM.js, and will be deprecated in SAM.cpp");let i;i=this._implicitFilter&&t?new vs(this._implicitFilter,t):this._implicitFilter?this._implicitFilter:t;let r=this._getExistingList(e,i);if(r)r._updateLoadOptions(Object.assign({refreshTimeout:-1},s));else{const t=this._getMostCompleteCompatibleList(i);r=new oi(this._itemPool,this._loaders,e,i,t,s),this._lists.set(this._getListHash(e,i),new re(r))}return r.status===Hs.NotStarted&&r.refresh(),r}getListWithTypes(e,t,s){throw new o("NOT_IMPLEMENTED","getListWithTypes is not implemented in SAM.js and will be deprecated in SAM.cpp")}_getListHash(e,t){return e.hash+":"+(t?t.hash:"no-filter")}_getExistingList(e,t){const s=this._lists.get(this._getListHash(e,t));if(s)return s.deref()}setNeedsRefresh(){for(const e of this._getLists())e.setNeedsRefresh()}_getMostCompleteCompatibleList(e){var t;const s=[];for(const t of this._getLists())if(t.status===Hs.ReadyFullyLoaded){let i=ys(e,t.filter);"disjoint"!==i&&s.push({list:t,filterRelation:i,generation:t.generation,length:t.items.length})}return s.sort(ci),null===(t=s[0])||void 0===t?void 0:t.list}*_getLists(){const e=this._lists;for(const[t,s]of e.entries()){const i=s.deref();i?yield i:e.delete(t)}}}class di extends Nt{constructor(e,t){super(e,t),this._core=e,this._assetId="",this._createdAt=new Date,this._createdBy="",this._id=t}async getAssetInterface(){this._assetInterface=await this._core.hostAssetContext.repoInterface.resolveById(this._assetId)}get versionId(){return this._id}get created(){return this._createdAt}get createdBy(){return this._createdBy}get assetId(){return this._assetId}get milestone(){return this._label?{label:this._label,description:this._description}:void 0}get links(){return Object.assign({},this.__links)}getRenditionURL(e,t="image/png"){const s=this._core.environment.getValue("ACCESS_TOKEN"),i=this._core.environment.getValue("CLIENT_ID");return F(this.__links,j.RENDITION,{size:String(e),type:t})+`?api_key=${i}&user_token=${s}`}async restore(){const e=await this._core.hostAssetContext.getAssetWithCloudID(this._assetId);if(e.isComposite){const t=F(this.__links,j.MANIFEST);this._assetInterface||await this.getAssetInterface(),await this._assetInterface.restoreVersionManifest(t),await e._load()}else{const t=F(e.links,j.PRIMARY);await this.copy(t)}}async copy(e){const t=await this._core.hostAssetContext.repoInterface.resolveById(this._assetId),s=(await this._core.hostAssetContext.getAssetWithCloudID(this._assetId)).isComposite,i=F(this.__links,j.PRIMARY);if(s)throw new o("NOT_IMPLEMENTED","AssetVersion.copy not implemented for composite assets");return await t.runOperation({op:"copy",id:this._assetId,source:{href:i,"if-match":"*"},target:{href:e,"if-match":"*"}})}async setMilestone(e){var t,s,{label:i=(null===(t=this.milestone)||void 0===t?void 0:t.label)||"",description:r=(null===(s=this.milestone)||void 0===s?void 0:s.description)||""}=e;const o=await this._core.hostAssetContext.repoInterface.resolveById(this._assetId),n=[{op:this.milestone?He.replace:He.add,path:`/children/version=${this.versionId}/milestone`,value:{label:i,description:r}}];await o.patchVersion(n);const a=(await this._core.hostAssetContext.getAssetWithCloudID(this._assetId))._versionPool.createUpdateSession();hi.updateLocalItem(a,this,{milestone:{label:i,description:r}}),a.commit()}async removeMilestone(){if(!this.milestone)return;const e=await this._core.hostAssetContext.repoInterface.resolveById(this._assetId),t=[{op:He.remove,path:`/children/version=${this.versionId}/milestone`}];await e.patchVersion(t);const s=(await this._core.hostAssetContext.getAssetWithCloudID(this._assetId))._versionPool.createUpdateSession();hi.updateLocalItem(s,this,{milestone:{label:""}}),s.commit()}}h([O],di.prototype,"versionId",null),h([O],di.prototype,"created",null),h([O],di.prototype,"createdBy",null),h([O],di.prototype,"assetId",null),h([O],di.prototype,"milestone",null),h([O],di.prototype,"links",null),h([O],di.prototype,"getRenditionURL",null);const hi=new os({localItemType:di,remoteIdProperty:"version",propertyUpdater:new hs({_createdAt:{name:"created",format:"date"},_createdBy:"created_by",_label:"milestone.label",_description:"milestone.description",_assetId:"assetId",__links:{name:"_links",format:"object"}})});class ui{constructor(e,t){this._versionPool=e,this._assetInterfacePromise=t}async loadPage(e,t){return await this._loadPage(e,t)}async _loadPage(e,t){var s;const{updateContext:i,limit:r}=e,o=this._versionPool._core.environment.getValue("VERSIONS_LIST_UPDATE_LATENCY"),n=Date.now()-o,a=await this._assetInterfacePromise,c=await a.getVersions({start:t,limit:r}),l=this._versionPool.createUpdateSession(i,n),d=c.children.map((e=>Object.assign(Object.assign({},e),{assetId:c["repo:assetId"]}))),h=hi.updateRemoteItems(l,d);let u;l.commit();const p=c.children.length,_=null===(s=c.children[p-1])||void 0===s?void 0:s.created;return _&&r&&p===r&&(u=e=>this._loadPage(e,_)),{items:h,total:c.total_children,loadNextPage:u,mostRecentValidMutation:n}}}class pi extends Vt{constructor(){super(...arguments),this._etag=""}get etag(){return this._etag}_setContent(e,t){this._etag=t||"",this._setData(e)}async _loadData(){const e=await this._asset._getAssetInterface(),{content:t,etag:s}=await e.getContent();this._data=t,this._etag=s||""}}var _i,mi,fi,gi;h([O],pi.prototype,"etag",null),function(e){e[e.Folder=256]="Folder",e[e.File=512]="File",e[e.Composite=1024]="Composite"}(_i||(_i={})),function(e){e[e.InSync=0]="InSync",e[e.OutOfSync=1]="OutOfSync",e[e.SyncConflict=2]="SyncConflict",e[e.SyncError=3]="SyncError",e[e.Syncing=4]="Syncing"}(mi||(mi={})),function(e){e[e.None=0]="None",e[e.CloudContentCorrupted=1]="CloudContentCorrupted",e[e.LocalContentCorrupted=2]="LocalContentCorrupted",e[e.HasTooManyComponents=3]="HasTooManyComponents",e[e.HasTooManyChildren=4]="HasTooManyChildren",e[e.MaximumSizeExceeded=5]="MaximumSizeExceeded",e[e.Unknown=6]="Unknown"}(fi||(fi={})),function(e){e[e.NoErr=0]="NoErr",e[e.Conflict=1]="Conflict",e[e.DeleteConflict=2]="DeleteConflict",e[e.ParentDeletedConflict=3]="ParentDeletedConflict"}(gi||(gi={}));const yi=new Map([["file",_i.File],["composite",_i.Composite],["directory",_i.Folder]]);class vi extends $t{constructor(e,t,s){super(e,t),this._core=e,this._name="",this._etag="",this._repositoryID="",this._path="",this._type="",this._size=0,this._version="",this._assetClass="file",this._assetState="ACTIVE",this._created=new Date,this._modified=new Date,this._createdBy="",this._modifiedBy="",this._permissions=Ve.All,this._storageAssignee={id:"",type:"user"},this._versionPool=new pe(this._core,"version"),this.isAvailableOffline=!1,this.isUserPinned=!1,this.isNameDCTitle=!1,this._embeddedMetadata=new Ht(e,this),this._appMetadata=new Wt(e,this),this._manifest=new Gt(e,this),this._fileContent=new pi(e,this),this.__links=null==s?void 0:s.links,this._etag=(null==s?void 0:s.etag)||""}_loadWithRetry(){return this._load()}async _getAssetInterface(){return new ze(this._core.hostAssetContext.repoInterface,this.id,this.links,this.etag)}async _load(){await this._ensureLink(j.REPO_METADATA);const e=await this._getAssetInterface(),t=await Promise.allSettled([e.getRepoMetadata(),e.getEffectivePermissions()]),[s,i]=t.map((e=>"fulfilled"===e.status&&e.value)),r=t.map((e=>"rejected"===e.status&&e.reason)).find((e=>e)),o=s||{};if(i&&(o.effectivePermission=i),r){if(!["NOT_FOUND","ACCESS_DENIED"].includes(r.code))throw r;o.effectivePermission="ACCESS_DENIED"===r.code?Ve.Ack:Ve.None}else{const e=[this._embeddedMetadata,this._appMetadata,this._manifest,this._fileContent].filter((e=>e.isLoaded));e.length&&await Promise.all(e.map((e=>e.load())))}const n=[Ve.Ack,Ve.None].includes(o.effectivePermission);if(n&&this._core.hostAssetContext.assetPool.isItemDiscarded(this))return;const a=this._core.hostAssetContext.assetPool.createUpdateSession();this.isFolder&&o["repo:path"]&&o["repo:path"]!==this.repoPath&&ss({assetPool:this._core.hostAssetContext.assetPool,asset:this,session:a,newPath:o["repo:path"]}),bi.updateLocalItem(a,this,o),n&&a.queueDiscardedItem(this),a.commit()}get versions(){const e=new ui(this._versionPool,this._getAssetInterface());return new li(this._versionPool,[e])}get assetType(){return Zs("AdobeAsset.assetType","AdobeAsset.assetType will be deprecated. Please use isFolder, isFile, isComposite, etc. instead"),yi.get(this._assetClass)}get isFolder(){return"directory"===this._assetClass}get isFile(){return"file"===this._assetClass}get isComposite(){return"composite"===this._assetClass}get isArtifact(){if(this.appMetadata.data)return!!this.appMetadata.data["review:sourceAsset"]}get name(){return this._name}get shellVisibility(){return this._shellVisibility}get ancestorIDs(){return this._ancestorIDs}get storageAssignee(){return this._storageAssignee}get extension(){return this.name.lastIndexOf(".")>0?this.name.substring(this.name.lastIndexOf(".")+1):""}get mediaType(){return this._type}get cloudID(){return this.id}get repositoryID(){return this._repositoryID}get repoPath(){return this._path}get created(){return this._created}get modified(){return this._modified}get shared(){return this._shared}get sizeInBytes(){return this._size}get isDiscarded(){return void 0!==es(this.repoPath)||["DISCARDED","DISCARDED_PARENT"].includes(this._assetState)}get assetRefString(){return JSON.stringify({cloud_id:this.cloudID,path:this.repoPath,display_name:this.name,repository_id:this.repositoryID})}get isShared(){return this.isSharedWithYouAsset||this.isSharedByMe}get isSharedByMe(){return this._isSharedByMe}get isSharedWithYouAsset(){return this._isSharedWithYouAsset}get isSharedWithMe(){return Zs("isSharedWithMe","isSharedWithMe will be deprecated. Please use isSharedWithYouAsset"),this.isSharedWithYouAsset}get children(){if(!this.isFolder)throw new o("INVALID_ASSET_TYPE","Children list can be fetched only for folder");const e=new Is(this._core.hostAssetContext.assetPool,this),t=new ps({asset:this});return new li(this._core.hostAssetContext.assetPool,[e],t)}searchChildren(e=!1){if(!this.isFolder)throw new o("INVALID_ASSET_TYPE","Children can be searched only in the folder");const t=new Ss(this._core.hostAssetContext.assetPool,this._core,this._core.hostAssetContext._assetSearchInterface,this),s=new _s({asset:this,deepSearch:e});return new li(this._core.hostAssetContext.assetPool,[t],s)}async discard(){if(this.isDiscarded)throw new o("INVALID_OPERATION","Asset is already discarded");const e=await this._getAssetInterface();await e.discard(),await this._loadWithRetry()}async createFolder(e,t=!1,s=0){if(!this.isFolder)throw new o("INVALID_OPERATION","Asset is not Folder");if(!Jt(e))throw new o("INVALID_PARAMETER","Invalid name provided for asset create folder operation.");try{const t=e,s=await this._getAssetInterface(),i=await s.createFolder(t);return i?this._core.hostAssetContext.getAssetWithMetaData(i):await this._core.hostAssetContext.getAssetWithRepoPath(`${this.repoPath}/${t}`,this.repositoryID)}catch(i){if("CONFLICT"===i.code&&t){const i=Kt(e,this._core.environment.getValue("ASSET_CONFLICT_NAME_FORMAT"),s+1);return this.createFolder(i.newName,t,i.countUsed)}throw i}}async importFile(e,t,s,i=!1,r=0){if(!this.isFolder)throw new o("INVALID_OPERATION","Asset is not Folder");if("string"==typeof e)throw new o("INVALID_PARAMETER","Unsupported string for file to import");if(e.size>5242880)throw new o("NOT_IMPLEMENTED","Upload for large files not implemented.");if(!Jt(t))throw new o("INVALID_PARAMETER","Invalid name provided for file import operation.");try{const i=t,r=await this._getAssetInterface(),o=await r.importFile(e,i,s);return o?this._core.hostAssetContext.getAssetWithMetaData(o):await this._core.hostAssetContext.getAssetWithRepoPath(`${this.repoPath}/${i}`,this.repositoryID)}catch(o){if("CONFLICT"===o.code&&i){const o=Kt(t,this._core.environment.getValue("ASSET_CONFLICT_NAME_FORMAT"),r+1);return this.importFile(e,o.newName,s,i,r+1)}throw o}}get fileContent(){if(!this.isFile)throw new o("INVALID_ASSET_TYPE","Cannot get content of an asset that is not a file");return this._fileContent}async commitFileChanges(e,t){if(!this.isFile)throw new o("INVALID_OPERATION","Asset is not File");try{const s=await this._getAssetInterface();let i=await s.commitFileChanges(e,t);return this._fileContent.isLoaded&&this._fileContent._setContent(e,i.eTag),{status:gi.NoErr,committedEtag:i.eTag}}catch(t){if(t instanceof a){if(412===t.response.status)return{status:gi.Conflict};if(404===t.response.status){const t=this.repoPath.substring(0,this.repoPath.lastIndexOf("/"));let s=!1;const i=await this._core.hostAssetContext.getAssetWithRepoPath(t,this.repositoryID).catch((e=>{if("NOT_FOUND"!==e.code)throw e;s=!0}));if(s)return{status:gi.ParentDeletedConflict};const r=await(null==i?void 0:i.importFile(e,this.name));return{status:gi.DeleteConflict,newAsset:r}}}throw t}}async restore(e){if(!this.isDiscarded)throw new o("INVALID_OPERATION","Cannot restore an asset that is not discarded");const t=es(this.repoPath,e);if(t)await this._move(t,!0);else{const t=await this._getAssetInterface();await t.restore(e)}await this._loadWithRetry()}async permanentlyDelete(){const e=await this._core.hostAssetContext.permanentlyDeleteAssets([this]);if(e.failedResults.length)throw e.failedResults[0].error}get etag(){return this._etag}get version(){return this._version}get createdBy(){return this._createdBy}get modifiedBy(){return this._modifiedBy}get discarded(){return this._discarded}get discardedBy(){return this._discardedBy}hasPermission(...e){return e.every((e=>(this._permissions&e)===e))}get embeddedMetadata(){return this._embeddedMetadata}get appMetadata(){return this._appMetadataFromListing&&!this._appMetadata.data&&this._appMetadata._setData(this._appMetadataFromListing),this._appMetadata}get manifest(){if(!this.isComposite)throw new o("INVALID_ASSET_TYPE","Cannot get manifest of an asset that is not a composite");return this._manifest}getRenditionURL(e,t="image/png"){if(this.isFolder)return"";const s=this._core.environment.getValue("ACCESS_TOKEN"),i=this._core.environment.getValue("CLIENT_ID");try{const r=new URL(F(this.__links,j.RENDITION,{size:String(e),type:t}));return r.searchParams.append("api_key",i),r.searchParams.append("user_token",s),r.toString()}catch(e){return""}}get isSpaceAsset(){return Zs("AdobeAsset.isSpaceAsset","AdobeAsset.isSpaceAsset is not implemented for web yet"),!1}async getSpace(){const e=await this._core.spaceContext.getEnclosingSpace(this.cloudID);if(!e)throw new o("NOT_FOUND","Asset does not belong to a Space");return e}get thumbnailURL(){return this.getRenditionURL(512,"image/png")}get links(){return Object.assign({},this.__links)}async _ensureLink(e){var t;if(null===(t=this.__links)||void 0===t?void 0:t[e])return;const{links:s,etag:i}=await this._core.hostAssetContext.repoInterface.resolveById(this.cloudID),r=this._core.hostAssetContext.assetPool.createUpdateSession();bi.updateLocalItem(r,this,{"repo:etag":i,_links:s}),r.commit()}async _move(e,t=!1,s=0){var i;try{this._repositoryID||await this._load();const t={op:"move",source:{"repo:assetId":this.id,"repo:repositoryId":this._repositoryID},target:{"repo:path":e,"repo:repositoryId":this._repositoryID}},s=await this._getAssetInterface(),r=await s.runOperation(t);let{asset:n,error:a,op:c}=null!==(i=r[0])&&void 0!==i?i:{};if("move"!==c||!n&&!a)throw new o("UNEXPECTED_RESPONSE","Unexpected response from move operation");if(a)throw a;return n}catch(i){if("CONFLICT"===i.code&&t){const t=Kt(e,this._core.environment.getValue("ASSET_CONFLICT_NAME_FORMAT"),s+1);return this._move(t.newName,!0,t.countUsed)}throw i}}async _copy(e,t,s=!0,i=0){let r={failedResults:[],newModels:[]};if(await Nt.runExclusiveTask("copy",[this],(async()=>{let s=this.name;if(void 0!==t){if(!Jt(t))throw new o("INVALID_PARAMETER","Invalid name provided for asset copy operation.");if(s=t,i){const e=Kt(s,this._core.environment.getValue("ASSET_CONFLICT_NAME_FORMAT"),i);s=e.newName,i=e.countUsed}}else{const t=e.repoPath===this.repoPath.substring(0,this.repoPath.lastIndexOf("/"))?Kt(s,this._core.environment.getValue("ASSET_COPY_NAME_FORMAT"),i):i>0?Kt(s,this._core.environment.getValue("ASSET_CONFLICT_NAME_FORMAT"),i):{newName:s,countUsed:i};s=t.newName,i=t.countUsed}const n=`${e.repoPath}/${s}`,a=new Map;a.set(this.id,this),e.repositoryID||await e._load();const c={op:"copy",id:this.id,source:{"repo:assetId":this.id},target:{"repo:path":n,"repo:repositoryId":e.repositoryID}};this.repositoryID&&(c.source["repo:repositoryId"]=this.repositoryID),r=await this._core.hostAssetContext._runOperations([c],a,((e,t,s)=>{if(!s)throw new o("UNEXPECTED_RESPONSE","Missing metadata from asset copy operation.");return bi.updateRemoteItem(e,s)}))})),r.failedResults.length){if("CONFLICT"===r.failedResults[0].error.code&&!0===s)return await this._copy(e,t,s,i+1);throw r.failedResults[0].error}return r.newModels[0]}async copy(e,t){return await this._copy(e,t)}async duplicate(e){const t=this.repoPath.substring(0,this.repoPath.lastIndexOf("/")),s=await this._core.hostAssetContext.getAssetWithRepoPath(t,this.repositoryID);return await this._copy(s,e)}async rename(e){if(!Jt(e))throw new o("INVALID_PARAMETER","Invalid name provided for asset rename operation.");const t=ts(e,this),s=await this._move(t);if(s){const e=this._core.hostAssetContext.assetPool,i=e.createUpdateSession();ss({assetPool:e,asset:this,session:i,newPath:t}),bi.updateLocalItem(i,this,s),i.commit()}}async move(e){const t=await this._core.hostAssetContext.moveAssets([this],e);if(t.failedResults.length)throw t.failedResults[0].error}transferToSpace(e){return this._core.hostAssetContext.transfer(this,e)}}function Ii(e){const{_embedded:t}=e;if(!t)return ns;return t[j.APP_METADATA]||ns}function wi(e){var t;return void 0!==e.effectivePermission?e.effectivePermission:(null===(t=e._embedded)||void 0===t?void 0:t[j.AC_EFFECTIVE])?We(e._embedded[j.AC_EFFECTIVE]):Ve.All}h([$],vi.prototype,"_loadWithRetry",null),h([R],vi.prototype,"versions",null),h([O],vi.prototype,"assetType",null),h([O],vi.prototype,"isFolder",null),h([O],vi.prototype,"isFile",null),h([O],vi.prototype,"isComposite",null),h([O],vi.prototype,"isArtifact",null),h([O],vi.prototype,"name",null),h([O],vi.prototype,"shellVisibility",null),h([O],vi.prototype,"ancestorIDs",null),h([O],vi.prototype,"storageAssignee",null),h([O],vi.prototype,"extension",null),h([O],vi.prototype,"mediaType",null),h([O],vi.prototype,"cloudID",null),h([O],vi.prototype,"repositoryID",null),h([O],vi.prototype,"repoPath",null),h([O],vi.prototype,"created",null),h([O],vi.prototype,"modified",null),h([O],vi.prototype,"shared",null),h([O],vi.prototype,"sizeInBytes",null),h([O],vi.prototype,"isDiscarded",null),h([O],vi.prototype,"assetRefString",null),h([O],vi.prototype,"isShared",null),h([O],vi.prototype,"isSharedByMe",null),h([O],vi.prototype,"isSharedWithYouAsset",null),h([O],vi.prototype,"isSharedWithMe",null),h([R],vi.prototype,"children",null),h([O],vi.prototype,"etag",null),h([O],vi.prototype,"version",null),h([O],vi.prototype,"createdBy",null),h([O],vi.prototype,"modifiedBy",null),h([O],vi.prototype,"discarded",null),h([O],vi.prototype,"discardedBy",null),h([O],vi.prototype,"hasPermission",null),h([O],vi.prototype,"appMetadata",null),h([O],vi.prototype,"getRenditionURL",null),h([O],vi.prototype,"thumbnailURL",null),h([O],vi.prototype,"links",null);const Ai={parse:e=>e,isEqual:(e,t)=>(null==e?void 0:e.id)===(null==t?void 0:t.id)&&(null==e?void 0:e.type)===(null==t?void 0:t.type)},bi=new os({localItemType:vi,remoteIdProperty:"repo:assetId",propertyUpdater:new hs({_name:"repo:name",_etag:"repo:etag",_repositoryID:"repo:repositoryId",_path:"repo:path",_type:"dc:format",_size:{name:"repo:size",format:"number"},_version:"repo:version",_assetClass:{name:"repo:assetClass",choices:is},_assetState:{name:"repo:state",choices:["ACTIVE","DISCARDED","DISCARDED_PARENT"]},_created:{name:"storage:deviceCreateDate",format:"date"},_modified:{name:"storage:deviceModifyDate",format:"date"},_storageAssignee:{name:"storage:assignee",format:Ai},_discarded:{name:"repo:discardDate",format:"date"},_createdBy:"repo:createdBy",_modifiedBy:"repo:modifiedBy",_discardedBy:"repo:discardedBy",_permissions:{get:wi,format:"number"},_isSharedByMe:{name:"isSharedByMe",format:"boolean"},_shellVisibility:{get:function(e){const t=Ii(e);return t===ns?"":t["shell:visibility"]?t["shell:visibility"]:""},choices:rs,format:"string"},_appMetadataFromListing:{get:Ii,format:"object"},_ancestorIDs:{name:"repo:ancestors",isArray:!0,format:"string"},__links:{name:"_links",format:"object"}})}),Si=new os({localItemType:vi,remoteIdProperty:"asset_id",propertyUpdater:new hs({_name:"asset_name",_etag:"composite_manifest_etag",_repositoryID:"repo:repositoryId",_path:{get:function(e){return e.asset_name_path&&e.asset_name?w(e.asset_name_path,e.asset_name):e.asset_name_path||e.asset_name||""},format:"string"},_type:{get:function(e){return"application/x-sharedcloud-collection+json"===e.type?"application/vnd.adobecloud.directory+json":e.type},format:"string"},_size:{name:"size",format:"number"},_version:"repo:version",_assetClass:{get:function(e){return"application/x-sharedcloud-collection+json"===e.type||"application/vnd.adobecloud.directory+json"===e.type?"directory":e.asset_sub_type},choices:is,format:"string"},_permissions:{get:wi,format:"number"},_appMetadataFromListing:{name:"app_metadata",format:"object"},_created:{name:"create_date",format:"date"},_modified:{name:"modify_date",format:"date"},_storageAssignee:{name:"storage:assignee",format:Ai},_createdBy:"creative_cloud_creator_id",_isSharedWithYouAsset:{name:"sharedViaInvite",format:"boolean"},_shellVisibility:{name:"app_metadata.shell:visibility",choices:rs,format:"string"},_ancestorIDs:{name:"path",isArray:!0,format:"string"},__links:{name:"_links",format:"object"}})}),Ei=50;class Ti{constructor(e,t,s){this._assetPool=e,this._core=t,this._loader=s}async loadPage(e,t){var s,i;const{updateContext:r,order:o,limit:n=Ei,filter:a}=e,c=this._core.environment.getValue("ASSETS_LIST_UPDATE_LATENCY"),l=Date.now()-c;t=t||0;const{mediaTypes:d,excludeMediaTypes:h}=this.getMediaTypesFromFilter(a),u=(await this._loader._getUSSResults({updateContext:r,order:o,limit:n,filter:a,start:t,mediaTypes:d,excludeMediaTypes:h})).result_sets[0],p=this._assetPool.createUpdateSession(r,l),_=Si.updateRemoteItems(p,u.items.map((e=>{var t,s;return(null===(s=(t=this._loader)._getItemData)||void 0===s?void 0:s.call(t,e))||e})));let m;p.commit();const f=u.total_items||0,g=u.items.length,y=0===g?t+n:t+g;y<f&&(m=e=>this.loadPage(e,y));const v={items:_,total:f,loadNextPage:m,mostRecentValidMutation:l};return null===(i=(s=this._loader)._postProcessPage)||void 0===i||i.call(s,e,v),v}getMediaTypesFromFilter(e){var t,s,i,r,o,n;if(!e)return{mediaTypes:[],excludeMediaTypes:[]};const a=new Set,c=new Set;return e instanceof vs?((null!==(t=e.filterA.mediaTypes)&&void 0!==t?t:[]).forEach((e=>a.add(e))),(null!==(s=e.filterA.excludeMediaTypes)&&void 0!==s?s:[]).forEach((e=>c.add(e))),(null!==(i=e.filterB.mediaTypes)&&void 0!==i?i:[]).forEach((e=>a.add(e))),(null!==(r=e.filterB.excludeMediaTypes)&&void 0!==r?r:[]).forEach((e=>c.add(e)))):((null!==(o=e.mediaTypes)&&void 0!==o?o:[]).forEach((e=>a.add(e))),(null!==(n=e.excludeMediaTypes)&&void 0!==n?n:[]).forEach((e=>c.add(e)))),{mediaTypes:Array.from(a),excludeMediaTypes:Array.from(c)}}}class Ci{constructor(e,t,s){this._swyInterface=s,this._ussLoaderHelper=new Ti(e,t,this)}supportsFilter(e){return void 0!==e}async loadPage(e){return this._ussLoaderHelper.loadPage(e)}async _getUSSResults({start:e,limit:t,mediaTypes:s,excludeMediaTypes:i,order:r}){return this._swyInterface.getSWYAssets({orderBy:Ut[r.field],orderDirection:r.direction,start:e,limit:t,mediaTypes:s,excludeMediaTypes:i,embedPermissions:!0})}_getItemData(e){return Object.assign(Object.assign({},e),{sharedViaInvite:!0})}}function Ri(e){(null==e?void 0:e.find((e=>"application/vnd.adobecloud.directory+json"===e)))&&e.push("application/x-sharedcloud-collection+json")}const Pi={orderDirection:"descending",orderBy:"shared_date",start:0,limit:0};class Oi extends xe{async getSharedByMeAssets(e,t){Ri((t=Object.assign(Object.assign({},Pi),t)).type);let s={hints:{acp_platform_v2:!0},fetch_fields:{includes:["collab_metadata$$collaborators"]},"storage:assignee$$type":["user"],op_none_of:[{"app_metadata$$shell:visibility":"hiddenSelf"}],parent_id:[e],[Ne.TYPE]:t.type||[],asset_id_opacity:!0,sort_orderby:t.orderBy,sort_order:(i=t,"ascending"===i.orderDirection?"asc":"desc"),limit:t.limit,start_index:t.start};var i;return await this._core.hostAssetContext.ussInterface.getQueryResponse(s)}}const Di={orderDirection:"descending",orderBy:"shared_date",start:0,limit:0,mediaTypes:[],excludeMediaTypes:[]};class Li extends xe{async getSWYAssets(e){Ri((e=Object.assign(Object.assign({},Di),e)).mediaTypes),Ri(e.excludeMediaTypes);let t={shared_via_invite:!0,hints:{acp_platform_v2:!0},fetch_fields:{includes:$e()},[Ne.STORAGE_ASSIGNEE_TYPE]:["user"],asset_id_opacity:!0,op_none_of:[{op_field_exists:["app_metadata$$cc:inheritable$$cc:team$$repo:assetId","app_metadata$$cc:inherited$$cc:team$$repo:assetId"]},{[Ne.VISIBLITY]:["hiddenSelf","hiddenRecursive"]},{[Ne.CREATIVE_CLOUD_TOPLEVEL_COLLECTION_NAME]:"appdata"},{[Ne.TYPE]:e.excludeMediaTypes||[]}],[Ne.TYPE]:e.mediaTypes||[],sort_orderby:e.orderBy,sort_order:(s=e,"ascending"===s.orderDirection?"asc":"desc"),limit:e.limit,start_index:e.start};var s;return e.embedPermissions&&t.fetch_fields.includes.push("_embedded"),await this._core.hostAssetContext.ussInterface.getQueryResponse(t)}}const xi={orderDirection:"descending",orderBy:"modify_date",start:0,limit:0};class Ni extends xe{async getFilteredAssets(e){Ri((e=Object.assign(Object.assign({},xi),e)).mediaTypes),Ri(e.excludeMediaTypes);let t=Object.assign(Object.assign(Object.assign({hints:{acp_platform_v2:!0},fetch_fields:{includes:$e()},[Ne.STORAGE_ASSIGNEE_TYPE]:["user"],asset_id_opacity:!0,op_none_of:[{op_field_exists:["app_metadata$$cc:inheritable$$cc:team$$repo:assetId","app_metadata$$cc:inherited$$cc:team$$repo:assetId"]},{[Ne.VISIBLITY]:["hiddenSelf","hiddenRecursive"]},{[Ne.CREATIVE_CLOUD_TOPLEVEL_COLLECTION_NAME]:"appdata"},{[Ne.TYPE]:e.excludeMediaTypes||[]}]},e.assetId?Object.assign({},e.deepSearch?{container:{asset_id:[e.assetId]}}:{parent_id:[e.assetId]}):{}),{[Ne.TYPE]:e.mediaTypes||[],sort_orderby:e.orderBy,sort_order:(s=e,"ascending"===s.orderDirection?"asc":"desc"),limit:e.limit,start_index:e.start}),e.query?{q:e.query}:{});var s;return await this._core.hostAssetContext.ussInterface.getQueryResponse(t)}}class ki{constructor(e,t,s){this._core=t,this._adobeAssetGlobalSearchInterface=s,this._ussLoaderHelper=new Ti(e,this._core,this)}supportsFilter(e){return void 0!==e}async loadPage(e){return this._ussLoaderHelper.loadPage(e)}_getItemData(e){return Object.assign(Object.assign({},e),{sharedViaInvite:Boolean(e.collaboration_metadata)})}_getUSSResults({start:e,limit:t,order:s,filter:i,mediaTypes:r,excludeMediaTypes:o}){let n=null==i?void 0:i.query;return this._adobeAssetGlobalSearchInterface.getFilteredAssets({orderBy:ws[s.field],orderDirection:s.direction,start:e,limit:t,mediaTypes:r,excludeMediaTypes:o,query:n,embedPermissions:!0})}}const Mi={orderDirection:"descending",orderBy:"modify_date",start:0,limit:0};class ji extends xe{async getFilteredAssets(e){Ri((e=Object.assign(Object.assign({},Mi),e)).mediaTypes),Ri(e.excludeMediaTypes);let t=Object.assign({hints:{acp_platform_v2:!0},fetch_fields:{includes:$e()},[Ne.STORAGE_ASSIGNEE_TYPE]:["user"],asset_id_opacity:!0,op_none_of:[{op_field_exists:["app_metadata$$cc:inheritable$$cc:team$$repo:assetId","app_metadata$$cc:inherited$$cc:team$$repo:assetId"]},{[Ne.VISIBLITY]:["hiddenSelf","hiddenRecursive"]},{[Ne.CREATIVE_CLOUD_TOPLEVEL_COLLECTION_NAME]:"appdata"},{[Ne.TYPE]:e.excludeMediaTypes||[]}],op_or:[{[Ne.STORAGE_ASSIGNEE_ID]:this._core.environment.getValue("USER_ID")},{[Ne.SHARED_VIA_INVITE]:!0}],[Ne.TYPE]:e.mediaTypes||[],sort_orderby:e.orderBy,sort_order:(s=e,"ascending"===s.orderDirection?"asc":"desc"),limit:e.limit,start_index:e.start},e.query?{q:e.query}:{});var s;return e.embedPermissions&&t.fetch_fields.includes.push("_embedded"),await this._core.hostAssetContext.ussInterface.getQueryResponse(t)}}const Ui={start:0,limit:0,mediaTypes:[],excludeMediaTypes:[]};class Fi extends xe{async getRecentAssets(e){Ri((e=Object.assign(Object.assign({},Ui),e)).mediaTypes),Ri(e.excludeMediaTypes);let t={scope:["creative_cloud"],hints:{acp_platform_v2:!0},fetch_fields:{includes:$e()},asset_id_opacity:!0,sort_orderby:"modify_date",sort_order:"desc",limit:e.limit,start_index:e.start,[Ne.TYPE]:e.mediaTypes||[],op_none_of:[{[Ne.FIELD_EXISTS]:["app_metadata$$cc:inheritable$$cc:team$$repo:assetId","app_metadata$$cc:inherited$$cc:team$$repo:assetId"]},{[Ne.VISIBLITY]:["hiddenSelf","hiddenRecursive"]},{[Ne.CREATIVE_CLOUD_TOPLEVEL_COLLECTION_NAME]:"appdata"},{[Ne.TYPE]:e.excludeMediaTypes||[]}],op_or:[{[Ne.STORAGE_ASSIGNEE_ID]:this._core.environment.getValue("USER_ID")},{[Ne.SHARED_VIA_INVITE]:!0}]};return e.embedPermissions&&t.fetch_fields.includes.push("_embedded"),await this._core.hostAssetContext.ussInterface.getQueryResponse(t)}}class Bi extends xe{async transfer(e){const t=await this.discoverLinks(),s=await this._doPost(F(t,j.ATS_MOVE),{"Content-Type":"application/json"},JSON.stringify(e),[200]),i=await s.json();if(i.status&&200!==i.status)throw new a("UNEXPECTED_RESPONSE","",s);return i.assetId}async discoverLinks(){return(await this._getResponse(this.getUrl("/")))._links}getUrl(e){return`https://${this._core.environment.endpoints.TRANSFER_SERVICE_HOST}${e}`}}const $i=Symbol("reloadSpace"),Vi=Symbol("clearLastReloadError");class Hi{constructor(e,t,s,i,r,o=!1){this._asset=s,this._ussInterface=i,this._artifactFilter=r,this._embedPermissions=o,this._ussLoaderHelper=new Ti(e,t,this)}supportsFilter(e){const t=[];if(e instanceof vs?(t.push(e.filterA),t.push(e.filterB)):t.push(e),!t.every((e=>e.artifactFilter===this._artifactFilter||void 0===e.artifactFilter)))throw new o("INVALID_PARAMETER","SpaceSearchAssetFilter.artifactFilter does not match SpaceSearchAssetLoader.artifactFilter");return!0}loadPage(e){return this._ussLoaderHelper.loadPage(e)}async _getUSSResults({start:e,limit:t,order:s,mediaTypes:i}){return this._ussInterface.searchSpace(this._asset.id,"onlyArtifacts"===this._artifactFilter,this._embedPermissions,{type:i,sort_orderby:ke[s.field],sort_order:"descending"===s.direction?"desc":"asc",limit:t,start_index:e})}_getItemData(e){return Object.assign(Object.assign({},e),{"repo:repositoryId":this._asset.repositoryID})}}class Wi extends us{constructor(e){super({mediaTypes:null==e?void 0:e.mediaTypes,_includeHiddenRecursive:null==e?void 0:e._includeHiddenRecursive}),this._asset=null==e?void 0:e.asset,this.artifactFilter=null==e?void 0:e.artifactFilter}get hash(){var e;return["spaceSearch",null===(e=this._asset)||void 0===e?void 0:e.id,this.artifactFilter,super.hash].filter((e=>e)).join(":")}matches(e){var t;return!((null===(t=this._asset)||void 0===t?void 0:t.repoPath)&&!e.repoPath.startsWith(`${this._asset.repoPath}/`))&&(!e.isArtifact||"excludeArtifacts"!==this.artifactFilter)&&!(!e.isArtifact&&"onlyArtifacts"===this.artifactFilter)&&super.matches(e)}getRelationToFilter(e){var t,s;const i=null===(t=this._asset)||void 0===t?void 0:t.repoPath,r=null===(s=e._asset)||void 0===s?void 0:s.repoPath;if(i&&r&&!i.startsWith(`${r}/`)&&!r.startsWith(`${i}/`))return"disjoint";if(this.artifactFilter&&e.artifactFilter&&this.artifactFilter!==e.artifactFilter)return"disjoint";const o=super.getRelationToFilter(e);return"disjoint"===o?"disjoint":"unknown"===o||!i&&r||i&&r&&i.startsWith(`${r}/`)||!this.artifactFilter&&e.artifactFilter?"unknown":"subset"}}Wi.default=new Wi({mediaTypes:[]});class Gi extends $t{constructor(){super(...arguments),this._name="",this._repositoryID="",this._repositoryName="",this._pathName="",this._created=new Date,this._modified=new Date,this._contributorCount=0,this._role="NONE",this._color="",this._isBookmarked=!1,this._teamID="",this._teamName="",this._thumbnail="",this._access="private",this._etag="",this._version=0,this._state="active",this._loadedGeneration=0,this._teamRole="UNKNOWN"}get spaceID(){return this.id}get name(){return this._name}get access(){return this._access}get etag(){return this._etag}get state(){return this._state}get repositoryID(){return this._repositoryID}get repositoryName(){return this._repositoryName}get pathName(){return this._pathName}get created(){return this._created}get modified(){return this._modified}get contributorCount(){return this._contributorCount}get role(){return this._role}get color(){return this._color}get isBookmarked(){return this._isBookmarked}get teamID(){return this._teamID}get teamName(){return this._teamName}get description(){return this._description}get thumbnail(){return this._thumbnail}get version(){return this._version}get teamRole(){return this._teamRole}get _links(){return this.__links}async ensureDescription(){var e;return void 0===this._description&&await this.load({refreshTimeout:-1}),null!==(e=this.description)&&void 0!==e?e:""}async getChild(e){var t;return this._children||await this.load({refreshTimeout:-1}),null===(t=this._children)||void 0===t?void 0:t.get(e)}async searchWorkingFiles(){const{assetPool:e,ussInterface:t}=this._core.hostAssetContext,s=await this._core.hostAssetContext.getAssetWithRepoPath(`${this.pathName}/working_files`,this.repositoryID),i=new Hi(e,this._core,s,t,"excludeArtifacts",!0),r=new Wi({asset:s,artifactFilter:"excludeArtifacts"});return new li(e,[i],r)}async searchArtifacts(e=!1){const{assetPool:t,ussInterface:s}=this._core.hostAssetContext,i=await this._core.hostAssetContext.getAssetWithCloudID(this.id),r=new Hi(t,this._core,i,s,"onlyArtifacts",e),o=new Wi({asset:i,artifactFilter:"onlyArtifacts",_includeHiddenRecursive:!0});return new li(t,[r],o)}async getWorkingFiles(){return(await this._core.hostAssetContext.getAssetWithRepoPath(`${this.pathName}/working_files`,this.repositoryID)).children}async load(e){var t;const s=null==e?void 0:e.refreshTimeout;let i=this._lastReload;i&&(i.pending||-1===s||s&&i.requestTime+s>Date.now())||(i=this._lastReload={pending:!0,inProgress:!0,generation:(null!==(t=null==i?void 0:i.generation)&&void 0!==t?t:this._loadedGeneration)+1,requestTime:Date.now(),promise:new Promise(((e,t)=>{setTimeout((()=>this._executeReload(i).finally((()=>i.error?t(i.error):e()))),0)}))},this.dispatch(ne)),await i.promise}async _executeReload(e){if(e===this._lastReload){e.pending=!1;try{await this._core.spaceContext[$i](this)}catch(t){e.error=t}if(e.inProgress=!1,!(this._lastReload!==e&&e.generation<=this._loadedGeneration)){if(e.error instanceof o&&"NOT_FOUND"===e.error.code){const e=this._core.spaceContext.spacePool.createUpdateSession();e.queueDiscardedItem(this),e.commit()}this.dispatch(ne)}}else!function(e,t){if(!e)throw new d("The pending flag must be false after the reload was cleared out.")}(!e.pending)}[Vi](){const e=this._lastReload;(null==e?void 0:e.error)&&(e.error=void 0,e.pending=!1,this.dispatch(ne))}get isReloading(){var e,t;return null!==(t=null===(e=this._lastReload)||void 0===e?void 0:e.inProgress)&&void 0!==t&&t}get lastReloadError(){var e;return null===(e=this._lastReload)||void 0===e?void 0:e.error}async update(e){await this._core.spaceContext.updateSpace(this,e)}async rename(e){await this._core.spaceContext.updateSpace(this,{name:e})}async archive(){const e=await this._core.spaceContext.archiveSpaces([this]);if(e.failedResults.length)throw e.failedResults[0].error}async restore(e){let t;void 0!==e&&(t=new Map,t.set(this,e));const s=await this._core.spaceContext.restoreSpaces([this],t);if(s.failedResults.length)throw s.failedResults[0].error}}h([O],Gi.prototype,"name",null),h([O],Gi.prototype,"access",null),h([O],Gi.prototype,"etag",null),h([O],Gi.prototype,"state",null),h([O],Gi.prototype,"repositoryID",null),h([O],Gi.prototype,"repositoryName",null),h([O],Gi.prototype,"pathName",null),h([O],Gi.prototype,"created",null),h([O],Gi.prototype,"modified",null),h([O],Gi.prototype,"contributorCount",null),h([O],Gi.prototype,"role",null),h([O],Gi.prototype,"color",null),h([O],Gi.prototype,"isBookmarked",null),h([O],Gi.prototype,"teamID",null),h([O],Gi.prototype,"teamName",null),h([O],Gi.prototype,"description",null),h([O],Gi.prototype,"thumbnail",null),h([O],Gi.prototype,"version",null),h([O],Gi.prototype,"teamRole",null),h([O],Gi.prototype,"_links",null),h([R],Gi.prototype,"searchWorkingFiles",null),h([R],Gi.prototype,"searchArtifacts",null),h([R],Gi.prototype,"getWorkingFiles",null),h([O],Gi.prototype,"isReloading",null),h([O],Gi.prototype,"lastReloadError",null);const Yi=new os({localItemType:Gi,remoteIdProperty:"id",propertyUpdater:new hs({_name:"name",_access:{name:"access",choices:["private","team"]},_etag:"etag",_repositoryID:"repositoryId",_repositoryName:"repositoryName",_pathName:"pathName",_created:{name:"createdDate",format:"date"},_modified:{name:"modifiedDate",format:"date"},_contributorCount:{name:"contributorCount",format:"number"},_role:{name:"role",choices:["NONE","CONTRIBUTOR","REVIEWER"]},_color:{name:"color"},_isBookmarked:{name:"bookmarked",format:"boolean"},_teamID:"teamId",_teamName:"teamName",_description:"description",_thumbnail:"thumbnail",_children:{name:"children",mapByKey:"name",format:{parse:e=>({id:e.id,_links:e._links}),isEqual:(e,t)=>e.id===t.id&&It(e._links,t._links)}},_version:{name:"version",format:"number"},_teamRole:{name:"teamRole",choices:["UNKNOWN","NONE","MEMBER"]},_state:{name:"state",choices:["active","archived","in_progress"]},__links:{name:"_links",format:"object"}})});class qi{constructor(e,t,s){this._core=t,this._recentInterface=s,this._ussLoaderHelper=new Ti(e,t,this)}supportsFilter(e){return void 0!==e}async loadPage(e){return this._ussLoaderHelper.loadPage(e)}async _getUSSResults({start:e,limit:t,mediaTypes:s,excludeMediaTypes:i}){return this._recentInterface.getRecentAssets({start:e,limit:t,mediaTypes:s,excludeMediaTypes:i,embedPermissions:!0})}_getItemData(e){var t;return Object.assign(Object.assign({},e),{sharedViaInvite:(null===(t=e["storage:assignee"])||void 0===t?void 0:t.id)!==this._core.environment.getValue("USER_ID")})}_postProcessPage(e,t){const{filter:s}=e,{items:i}=t,r=s instanceof vs?s.filterA:s;i.length&&(r._lastModificationDate=i[i.length-1].modified)}}class Ji extends us{constructor(e){super({mediaTypes:null==e?void 0:e.mediaTypes,excludeMediaTypes:null==e?void 0:e.excludeMediaTypes})}get hash(){return super.hash}matches(e){return!(this._lastModificationDate&&e.modified<this._lastModificationDate)&&super.matches(e)}getRelationToFilter(e){var t,s;const i=e;return(null===(t=this._lastModificationDate)||void 0===t?void 0:t.valueOf())!==(null===(s=i._lastModificationDate)||void 0===s?void 0:s.valueOf())?"disjoint":super.getRelationToFilter(e)}}async function zi(e,t,s,i){const r=[],o=[];if(e.failedResults.forEach((e=>{"CONFLICT"===e.error.code?r.push(e.model):o.push(e)})),r.length){for(const[e,t]of s)s.set(e,{newName:t.newName,countUsed:t.countUsed+1});const n=await i(r,t,!0,s);return n.failedResults=[...n.failedResults,...o],n.newModels=[...n.newModels,...e.newModels],n}return e}var Ki,Xi;!function(e){e[e.Initializing=0]="Initializing",e[e.Offline=1]="Offline",e[e.NotStarted=2]="NotStarted",e[e.Disabled=3]="Disabled",e[e.Synchronized=4]="Synchronized",e[e.InProgress=5]="InProgress",e[e.ErrorQuotaExceeded=6]="ErrorQuotaExceeded",e[e.ErrorSyncDown=7]="ErrorSyncDown",e[e.ErrorOther=8]="ErrorOther"}(Ki||(Ki={})),function(e){e[e.Offline=0]="Offline",e[e.Wan=1]="Wan",e[e.Cellular=2]="Cellular",e[e.OnlineUnknown=3]="OnlineUnknown"}(Xi||(Xi={}));class Qi extends te{constructor(e){super(),this._core=e,this._rapi=new Ke(this._core),this._ons=new Lt(this._core),this._invitationService=new Ue(this._core),this._USSInterface=new je(this._core),this._SBMInterface=new Oi(this._core),this._SWYInterface=new Li(this._core),this._RecentInterface=new Fi(this._core),this._adobeAssetSearchInterface=new Ni(this._core),this._adobeAssetGlobalSearchInterface=new ji(this._core),this._assetPool=new pe(this._core,"asset"),this._assetTransferService=new Bi(this._core),this._onONSNotification=e=>{e.forEach((e=>{const t=this._assetPool.getLocalItemById(e);t&&t._loadWithRetry()}));const t=new Set(e);this._core.assetLinkManager.lists.forEach((e=>e._onONSNotification(t)))},this._onAssetsChanged=()=>{const e=new Set;this._assetPool.forEach((t=>e.add(t.id))),this._core.assetLinkManager.lists.forEach((t=>t.monitoredAssetIDs.forEach((t=>e.add(t))))),e.size>0&&!this._core.environment.getValue("DISABLE_ONS")?(this._ons.watch(e),this._ons.start()):this._ons.stop()},this._assetPool.on(de,this._onAssetsChanged),this._ons.on("change",this._onONSNotification)}get repoInterface(){return this._rapi}get onsInterface(){return this._ons}get ussInterface(){return this._USSInterface}get sbmInterface(){return this._SBMInterface}get swyInterface(){return this._SWYInterface}get recentInterface(){return this._RecentInterface}get invitationInterface(){return this._invitationService}get _assetSearchInterface(){return this._adobeAssetSearchInterface}get _globalSearchInterface(){return this._adobeAssetGlobalSearchInterface}get assetPool(){return this._assetPool}get sharedSource(){const{hostAssetContext:e}=this._core,t=new Ci(e.assetPool,this._core,e.swyInterface);return new li(this.assetPool,[t])}get recentAssetsSource(){const{hostAssetContext:e}=this._core,t=new qi(e.assetPool,this._core,e.recentInterface);return new li(this.assetPool,[t],new Ji)}get globalSearchAssetsSource(){const e=new ki(this._core.hostAssetContext.assetPool,this._core,this._core.hostAssetContext._adobeAssetGlobalSearchInterface);return new li(this.assetPool,[e])}get isOnline(){return Zs("AssetContext.isOnline","AssetContext.isOnline() is not fully implemented for web"),this.networkStatus!==Xi.Offline}get networkStatus(){return Zs("AssetContext.networkStatus","AssetContext.networkStatus is not fully implemented for web"),Xi.OnlineUnknown}async _getAssetById(e,t){let s=this._assetPool.getLocalItemById(e);if(s)return t&&t.etag===s.etag||await s._loadWithRetry(),s;t||(t=await this._rapi.resolveById(e)),s=new vi(this._core,e,{links:t.links,etag:t.etag}),await s._load();const i=this._assetPool.createUpdateSession();return i.queueAddedItem(s),i.commit(),s}async getRootFolder(){const e=await this._rapi.getHomeDirectoryMetadata(),t=e["repo:repositoryId"];let s=e["repo:path"];const i=await this._rapi.resolveByPath(t,s);return this._getAssetById(i.assetID,i)}async getUserRepoID(){return this.getRootFolder().then((e=>e.repositoryID))}async getAssetWithCloudID(e,t=!1){return t&&await this._invitationService.confirmAccess(e),this._getAssetById(e)}async getAssetWithRepoPath(e,t){if(!t){const s=await this._rapi.getHomeDirectoryMetadata();t=s["repo:repositoryId"];const i=s["repo:path"];e=w(i,e)}const s=await this._rapi.resolveByPath(t,e);return this._getAssetById(s.assetID,s)}async getAssetWithAssetRefString(e,t=!1){let s;try{s=JSON.parse(e)}catch(e){throw new o("INVALID_PARAMETER","Incorrectly formatted AssetRefString")}if(s.cloud_id)return this.getAssetWithCloudID(s.cloud_id,t);if(s.path)return this.getAssetWithRepoPath(s.path,s.repository_id);throw new o("INVALID_DATA","Invalid AssetRefString")}getAssetWithMetaData(e){const t=this._assetPool.createUpdateSession(),s=bi.updateRemoteItem(t,e);return t.commit(),s}async getXDCEData(e){return this._core.environment.fetch(`https://${this._core.environment.endpoints.XDCE_HOST}/v2/document/${e}`).then((e=>e.json()))}removeAssetsFromAssetsPool(e){this._assetPool.removeLocalItems(e)}async permanentlyDeleteAssets(e){let t;const s=t=>{if(t.discardedItems){const s=t.discardedItems.filter((t=>e.includes(t))).map((e=>e.id));s.length&&this.removeAssetsFromAssetsPool(s)}};this._assetPool.on(de,s);try{await Nt.runExclusiveTask("delete",e,(async()=>{const s=new Map,i=e.map((e=>{s.set(e.id,e);let t={op:"delete",id:e.id,target:{"repo:assetId":e.id}};return e.repositoryID&&(t.target["repo:repositoryId"]=e.repositoryID),t.recursive=e.isFolder,t}));t=await this._runOperations(i,s,((e,t)=>{bi.updateLocalItem(e,t,{effectivePermission:Ve.None}),e.queueDiscardedItem(t)}))}))}finally{this._assetPool.off(de,s)}return t}get discardedSource(){return this._core.environment.warn("discardedSource is not fully implemented and only returns an empty ItemList"),new li(this._assetPool,[])}getCloudQuotaUsedAndMax(){return Promise.reject(new o("NOT_IMPLEMENTED","getCloudQuotaUsedAndMax() is not implemented for web yet"))}async transfer(e,t){let s;if(t instanceof Gi){const e=await t.getChild("working_files");if(!e)throw new o("NOT_FOUND","unable to find working_files for provided space");s=e.id}else s=t.cloudID;const i={source:{assetId:e.cloudID,repositoryId:e.repositoryID},target:{assetId:s,repositoryId:t.repositoryID}},r=await this._assetTransferService.transfer(i),n=this.assetPool.createUpdateSession();return n.queueDiscardedItem(e),n.commit(),r}async _moveAssets(e,t,s=!0,i){let r={failedResults:[],newModels:[]};return await Nt.runExclusiveTask("move",e,(async()=>{t.repositoryID||await t._load(),void 0===i&&(i=new Map);const s=new Map,o=e.map((e=>{s.set(e.id,e);let r=`${t.repoPath}/${e.name}`;r=Xt(this._core,e.id,r,!1,i);let o={op:"move",id:e.id,source:{"repo:assetId":e.id},target:{"repo:path":r,"repo:repositoryId":t.repositoryID}};return e.repositoryID&&(o.source["repo:repositoryId"]=e.repositoryID),o}));r=await this._runOperations(o,s)})),s?await zi(r,t,i,this._moveAssets.bind(this)):r}async moveAssets(e,t){return this._moveAssets(e,t)}async _copyAssets(e,t,s=!0,i){let r={failedResults:[],newModels:[]};return await Nt.runExclusiveTask("copy",e,(async()=>{t.repositoryID||await t._load(),void 0===i&&(i=new Map);const s=new Map,n=e.map((e=>{s.set(e.id,e);let r=`${t.repoPath}/${e.name}`;const o=t.repoPath===e.repoPath.substring(0,e.repoPath.lastIndexOf("/"));r=Xt(this._core,e.id,r,o,i);const n={op:"copy",id:e.id,source:{"repo:assetId":e.id},target:{"repo:path":r,"repo:repositoryId":t.repositoryID}};return e.repositoryID&&(n.source["repo:repositoryId"]=e.repositoryID),n}));r=await this._runOperations(n,s,((e,t,s)=>{if(!s)throw new o("UNEXPECTED_RESPONSE","Missing metadata from asset bulk operation.");return bi.updateRemoteItem(e,s)}))})),s?await zi(r,t,i,this._copyAssets.bind(this)):r}async copyAssets(e,t){return await this._copyAssets(e,t)}async duplicateAssets(e){const t=e[0].repoPath.substring(0,e[0].repoPath.lastIndexOf("/")),s=await this._core.hostAssetContext.getAssetWithRepoPath(t,e[0].repositoryID);return await this._copyAssets(e,s)}async _runOperations(e,t,s){return await this._rapi.runOperationsForContext(e,t,this._assetPool,s||((e,t,s)=>{if(!s)throw new o("UNEXPECTED_RESPONSE","Missing metadata from asset bulk operation.");bi.updateLocalItem(e,t,s)}),[{match:e=>"ACCESS_DENIED"===e.code||"NOT_FOUND"===e.code,action:async(e,t)=>(await e._load(),{model:e,error:t})}])}}h([O],Qi.prototype,"isOnline",null),h([O],Qi.prototype,"networkStatus",null),h([V,u(0,E)],Qi.prototype,"_getAssetById",null),h([R],Qi.prototype,"getUserRepoID",null);const Zi=["repo:repositoryId","repo:name","repo:etag","stRef:relativePath","stRef:documentID"];function er(e){const t=e._permissions;return t===Ve.Ack||t===Ve.None}const tr=["application/illustrator"];class sr extends W{constructor(e,t){super(),this._assetLinkList=e,this._data=t,this._resolutionErrors=[],this._onChange=()=>{var e,t;const s=null===(e=this._resolvedAssets)||void 0===e?void 0:e.filter(er);(null==s?void 0:s.length)&&(this._resolutionErrors=s.map((e=>new o(e._permissions===Ve.Ack?"ACCESS_DENIED":"NOT_FOUND","lost access"))),this._resolvedAssets=null===(t=this._resolvedAssets)||void 0===t?void 0:t.filter((e=>!s.includes(e)))),this.emit("change"),this._assetLinkList._onChange()}}async _setLinkData(e,t){return this._data=e,t&&(this._resolvedAssets=[t]),this._onChange(),this.adobeAsset&&this.assetID===this.adobeAsset.cloudID||await this._resolveWithRetry(),this}async _setLinkedAsset(e){const t=this._getLinkDataForAsset(e);return this._setLinkData(t,e)}_getLinkDataForAsset(e){var t,s;const i={"repo:assetId":e.cloudID,"repo:repositoryId":e.repositoryID,"repo:etag":e.etag,"dc:format":e.mediaType,"repo:name":e.name,"stRef:documentID":null===(t=e.embeddedMetadata.data)||void 0===t?void 0:t["xmpMM:DocumentID"],"stRef:instanceID":null===(s=e.embeddedMetadata.data)||void 0===s?void 0:s["xmpMM:InstanceID"],"stRef:manager":"Adobe Cloud"},r=this._assetLinkList.containerAsset;return r&&r.repositoryID===e.repositoryID&&(i["stRef:relativePath"]=I(v(r.repoPath),e.repoPath)),i}_serializeLinkData(e){return JSON.stringify(e,Object.keys(e).sort())}_resolveWithRetry(){return this._resolve()}async _resolve(){var e;const t=[],s=[],i=e=>{if(!["NOT_FOUND","ACCESS_DENIED"].includes(e.code))throw e;s.push(e)};try{const e=await this._context.getAssetWithCloudID(this.assetID);e.embeddedMetadata.isLoaded||await e.embeddedMetadata.load(),t.push(e)}catch(e){this._core.environment.error(`Failed to resolve link by id (${this.assetID}): ${e}`),i(e)}const r=this._assetLinkList.containerAsset;if(this.relativePath&&r&&r.repositoryID===this.repositoryID){const s=w(v(r.repoPath),this.relativePath);try{const i=await this._context.getAssetWithRepoPath(s,this.repositoryID);i.embeddedMetadata.isLoaded||await i.embeddedMetadata.load(),t[0]&&t[0].cloudID===i.cloudID||((null===(e=t[0])||void 0===e?void 0:e.isDiscarded)?t.unshift(i):t.push(i))}catch(e){this._core.environment.error(`Failed to resolve link by path: ${this.repositoryID}, ${s}`),i(e)}}this._resolvedAssets&&this._resolvedAssets.forEach((e=>e.off("change",this._onChange))),t.forEach((e=>e.on("change",this._onChange))),this._resolvedAssets=t,this._resolutionErrors=s,this._onChange()}get _core(){return this._assetLinkList._core}get _context(){return this._assetLinkList._manager._context}get adobeAsset(){var e;return null===(e=this._resolvedAssets)||void 0===e?void 0:e[0]}get alternativeAdobeAsset(){var e;return null===(e=this._resolvedAssets)||void 0===e?void 0:e[1]}get linkStatus(){if(!this._resolvedAssets)return"UpToDate";if(!this.adobeAsset)return this._resolutionErrors.some((e=>"ACCESS_DENIED"===e.code))?"Restricted":"Broken";if(this.adobeAsset.isDiscarded)return"Discarded";const e=this.adobeAsset.embeddedMetadata.data["xmpMM:InstanceID"]||"",t=!e&&!this.instanceID||tr.includes(this.type),s=e!==this.instanceID||t&&this.etag!==this.adobeAsset.etag;if(this.alternativeAdobeAsset||s)return"OutOfDate";const i=this._getLinkDataForAsset(this.adobeAsset),r=Zi.some((e=>i[e]!==this._data[e]));return r?"MetadataOutOfDate":"UpToDate"}get fragmentIdentifier(){return this._data["stRef:fromPart"]||""}get version(){return this._data["repo:version"]||""}get assetID(){return this._data["repo:assetId"]}get repositoryID(){return this._data["repo:repositoryId"]||""}get name(){return this._data["repo:name"]||""}get type(){return this._data["dc:format"]||""}get etag(){return this._data["repo:etag"]||""}get relativePath(){return this._data["stRef:relativePath"]||""}get documentID(){return this._data["stRef:documentID"]||""}get instanceID(){return this._data["stRef:instanceID"]||""}getAssetLinkRef(){return Object.assign({},this._data)}getAssetLinkRefString(){return this._serializeLinkData(this._data)}getNewAssetLinkRef(e){return this._getLinkDataForAsset(e)}getNewAssetLinkRefString(e){return this._serializeLinkData(this.getNewAssetLinkRef(e))}async updateWithAsset(e){return await this._setLinkedAsset(e),this.getAssetLinkRefString()}async updateWithLinkRef(e){return await this._setLinkData(e),e}async updateWithLinkRefString(e){return await this._setLinkData(JSON.parse(e)),e}acceptMetadataChanges(){if(this.adobeAsset&&"MetadataOutOfDate"===this.linkStatus){const e=this._getLinkDataForAsset(this.adobeAsset);this._data=Object.assign(Object.assign({},this._data),e),this._onChange()}return this.getAssetLinkRefString()}}h([V],sr.prototype,"_setLinkData",null),h([$],sr.prototype,"_resolveWithRetry",null),h([O],sr.prototype,"adobeAsset",null),h([O],sr.prototype,"alternativeAdobeAsset",null),h([O],sr.prototype,"linkStatus",null),h([O],sr.prototype,"fragmentIdentifier",null),h([O],sr.prototype,"version",null),h([O],sr.prototype,"assetID",null),h([O],sr.prototype,"repositoryID",null),h([O],sr.prototype,"name",null),h([O],sr.prototype,"type",null),h([O],sr.prototype,"etag",null),h([O],sr.prototype,"relativePath",null),h([O],sr.prototype,"documentID",null),h([O],sr.prototype,"instanceID",null),h([O],sr.prototype,"getAssetLinkRef",null),h([O],sr.prototype,"getAssetLinkRefString",null),h([O],sr.prototype,"getNewAssetLinkRef",null),h([O],sr.prototype,"getNewAssetLinkRefString",null);class ir extends W{constructor(e,t){super(),this._manager=e,this._containerAsset=t,this._links=new Set,this._directlyMonitoredAssetIDs=new Map,this._onChange=()=>{this.emit("change")},this._refreshLinks=(e=new Set(this.monitoredAssetIDs))=>{this.forEach((t=>{!t.adobeAsset&&e.has(t.assetID)&&t._resolveWithRetry()}))},this._onONSNotification=e=>{this._refreshLinks(e);const t=this._monitoredAssetIDs,s=new Set;e.forEach((e=>{t.has(e)&&s.add(e);const i=this._directlyMonitoredAssetIDs.get(e.toLowerCase());i&&s.add(i)})),this.emit("notified",[...s])}}get _core(){return this._manager._core}addAssetID(e){this._directlyMonitoredAssetIDs.set(e.toLowerCase(),e),this._onChange()}removeAssetID(e){this._directlyMonitoredAssetIDs.delete(e.toLowerCase()),this._onChange()}add(e){return Promise.all(e.map((async e=>{const t="string"==typeof e?JSON.parse(e):e,s=new sr(this,t);return this._links.add(s),this._onChange(),await s._resolveWithRetry(),s})))}async create(e,t,s){const i="string"==typeof e?e:e.cloudID,r=new sr(this,{"repo:assetId":i,"stRef:fromPart":t,"repo:version":s,"stRef:manager":"Adobe Cloud"});return this._links.add(r),this._onChange(),await r._resolve(),r.adobeAsset&&r._setLinkedAsset(r.adobeAsset),r}remove(e){this._links.delete(e),this._onChange()}clear(){this._links.clear(),this._onChange()}get count(){return this._links.size}get links(){return[...this._links]}get _monitoredAssetIDs(){const e=new Set(this._directlyMonitoredAssetIDs.values());return this.forEach((t=>{e.add(t.assetID),t.alternativeAdobeAsset&&e.add(t.alternativeAdobeAsset.cloudID)})),e}get monitoredAssetIDs(){return[...this._monitoredAssetIDs]}forEach(e){this._links.forEach(e)}get containerAsset(){return this._containerAsset}activate(e=0){Zs("AssetLinkList.activate",`AssetLinkList.activate(${e}) is deprecated - lists are always monitored for notifications`)}deactivate(){Zs("AssetLinkList.deactivate","AssetLinkList.deactivate() is deprecated - lists are always monitored for notifications")}get isActive(){return Zs("AssetLinkList.isActive","AssetLinkList.isActive is deprecated - lists are always monitored for notifications"),!0}async updateContainerAsset(e){this._containerAsset=e,this._onChange(),await Promise.all(Array.from(this._links).map((e=>e._resolveWithRetry())))}clone(e){e.links.forEach((e=>this._links.add(e)))}}h([O],ir.prototype,"count",null),h([O],ir.prototype,"links",null),h([O],ir.prototype,"monitoredAssetIDs",null),h([O],ir.prototype,"forEach",null),h([O],ir.prototype,"containerAsset",null),h([O],ir.prototype,"isActive",null);class rr extends W{constructor(e){super(),this._context=e,this._lists=new Set,this._onListChange=()=>{this._context._onAssetsChanged()}}get _core(){return this._context._core}createList(e){const t=new ir(this,e);return t.on("change",this._onListChange),this._lists.add(t),this.emit("change"),t}removeList(e){this._lists.delete(e),e.off("change",this._onListChange),this.emit("change")}get lists(){return[...this._lists]}}h([O],rr.prototype,"lists",null);const or={[j.PROJECTS_CONTEXT]:[],[j.TEAMS_PAGE]:["start","limit"],[j.PROJECTS_PRIMARY]:["id","selector"],[j.PROJECTS_PAGE]:["orderBy","start","limit","teamId","bookmarkFilter","teamAccess"],[j.REPOSITORIES_PAGE]:[],[j.TEAMS_CREATE]:[],[j.TEAM_PROVISION]:[],[j.PROJECTS_BOOKMARKS_BATCH]:[]},nr=[200,201],ar=["FULL"],cr={start:0,limit:0,orderDirection:"ascending",orderBy:"name"},lr={orderDirection:"ascending",orderBy:"name",bookmarked:!1,teamID:void 0,start:0,limit:0};function dr(e,t){return Object.assign({},e,t)}function hr(e){return("ascending"===e.orderDirection?"+":"-")+e.orderBy}function ur(e){const t={};return e.start&&(t.start=e.start),e.limit&&(t.limit=e.limit),t}class pr extends xe{_getHeaders(e){const t={"x-service-features":"CanvasMigration","Cache-Control":"no-cache"};return e&&(t["Content-Type"]=e),t}async _discoverLinks(e){return(await this._getResponse(e,this._getHeaders()))._links}_getEndpointHref(e){return`https://${this._core.environment.endpoints.PROJECTS_HOST}${e}`}async discoverLinks(){return this._discoverLinks(this._getEndpointHref("/api/v2/index"))}async getTeams(e){const t=function(e,t){const s=dr(cr,t),i=ur(s);return i.orderBy=hr(s),i.nameContains=s.nameContains,i.state=s.state,F(e,j.TEAMS_PAGE,i)}(await this.discoverLinks(),e);return await this._getResponse(t,this._getHeaders())}async getOrgRepositories(){const e=F(await this.discoverLinks(),j.REPOSITORIES_PAGE,{});return await this._getResponse(e,this._getHeaders())}async createTeam(e){const t=F(await this.discoverLinks(),j.TEAMS_CREATE,{});return(await this._doPost(t,this._getHeaders(k),JSON.stringify(e))).json()}async permanentlyDeleteTeam(e){const t=F(e,j.TEAMS_PRIMARY);await this._doDelete(t,this._getHeaders(),[204])}async archiveTeam(e){const t=F(e,j.TEAMS_DISCARD);await this._doPost(t,this._getHeaders(),void 0,[204])}async restoreTeam(e){const t=F(e,j.TEAMS_RESTORE);await this._doPost(t,this._getHeaders(),void 0,[204])}async renameTeam(e,t){const s=F(e,j.TEAMS_RENAME);await this._doPost(s,this._getHeaders(k),JSON.stringify({name:t}),[204])}async patchTeam(e,t){const s=F(e,j.TEAMS_PROPERTIES);await this._doPatch(s,Object.assign(Object.assign({},this._getHeaders(M)),{"If-Match":"*"}),JSON.stringify(t),[204])}async getTeamProperties(e){const t=F(e,j.TEAMS_PROPERTIES);return await this._getResponse(t,this._getHeaders())}async provisionTeam(){const e=F(await this.discoverLinks(),j.TEAM_PROVISION,{});return(await this._doPost(e,this._getHeaders(),void 0,nr)).json()}async getSpaces(e){const t=function(e,t){const s=dr(lr,t),i=ur(s);i.orderBy=hr(s),s.bookmarked||(i.bookmarkFilter=!1),!1===s.teamAccess&&(i.teamAccess=!1);const{teamID:r}=s;return r&&(i.teamId=r),F(e,j.PROJECTS_PAGE,i)}(await this.discoverLinks(),e);return await this._getResponse(t,this._getHeaders())}async getSpace(e,t=ar){const s=F(await this.discoverLinks(),j.PROJECTS_PRIMARY,{id:e,selector:t});return await this._getResponse(s,this._getHeaders())}async reloadSpace(e,t=ar){const s=F(e,j.PROJECTS_PRIMARY,{selector:t});return await this._getResponse(s,this._getHeaders())}async bookmarkOp(e){const t=F(await this.discoverLinks(),j.PROJECTS_BOOKMARKS_BATCH);return(await this._doPost(t,this._getHeaders(k),JSON.stringify(e),[200])).json()}async createSpace(e,t){const s=F(e,j.PROJECTS_CREATE);return(await this._doPost(s,this._getHeaders(k),JSON.stringify(t))).json()}async patchSpace(e,t){const s=F(e,j.PROJECTS_PRIMARY);await this._doPatch(s,this._getHeaders(M),JSON.stringify(t),[200,204])}async getEnclosingSpaces(e){const t=F(await this.discoverLinks(),j.PROJECTS_CONTEXT);return(await this._doPost(t,this._getHeaders(k),JSON.stringify(e),[200])).json()}}h([C((function(e){return function(e,t){if(void 0===e)return!0;if(Object(e)!==e)return!1;const s=Object.keys(e).some((t=>{const s=e[t];return Array.isArray(s)?s.some((({href:e})=>"string"!=typeof e)):"string"!=typeof s.href}));if(s)return!1;if(t){const s=Object.keys(t).every((s=>function(e,t,s){try{const i=U(e,t),r=N(i);return s.every((e=>-1!==r.varNames.indexOf(e)))}catch(e){return!1}}(e,s,t[s])));if(!s)return!1}return!0}(e,or)})),u(0,E)],pr.prototype,"_discoverLinks",null);const _r={name:"name",created:"createdDate"},mr={name:(e,t)=>kt(e.name,t.name),created:(e,t)=>Mt(e.created,t.created)};class fr extends(jt(mr)){}fr.default=new fr("ascending","name");class gr{constructor(e,t,s){this._spacePool=e,this._projectInterface=t,this._teamRoleGetterFactory=s}supportsFilter(e){if(!e)return!1;const{teamRole:t,state:s}=e;return"MEMBER"!==t&&"active"===s}async loadPage(e){return await this._loadPage(e)}async _loadPage(e,t){const{updateContext:s,order:i,filter:r,limit:n}=e,a=null==r?void 0:r.teamRole;if("MEMBER"===a)throw new o("INVALID_PARAMETER","Filtering only for spaces with reamRole MEMBER is not supported.");const c=this._spacePool._core.environment.getValue("PROJECTS_LIST_UPDATE_LATENCY"),l=Date.now()-c,d=this._projectInterface.getSpaces({orderBy:_r[i.field],orderDirection:i.direction,teamID:null==r?void 0:r.teamID,bookmarked:null==r?void 0:r.bookmarked,teamAccess:"NONE"!==a&&void 0,start:t,limit:n}),h=a?()=>a:await this._teamRoleGetterFactory(),u=await d,p=this._spacePool.createUpdateSession(s,l),_=Yi.updateRemoteItems(p,u.projects.map((e=>Object.assign(Object.assign({},e),{teamRole:h(e.teamId),state:"active"}))));for(const e of _)e[Vi]();let m;p.commit();const f=u.pageSpec.start+u.pageSpec.limit;return f<u.pageSpec.totalLimit&&(m=e=>this._loadPage(e,f)),{items:_,total:u.pageSpec.totalLimit,loadNextPage:m,mostRecentValidMutation:l}}}const yr=["owner","viewer","editor","none"],vr=["editor","owner"],Ir=["self","deep","deep_override"],wr=new os({localItemType:class extends Nt{constructor(){super(...arguments),this._role="viewer",this._type="imsUser",this._isDirect=!1}get collaboratorID(){return this.id}get imsUserId(){var e;return"imsUser"===this._type?this.id:null===(e=this._additionalData)||void 0===e?void 0:e.linkedIdentity}get email(){var e;return null===(e=this._additionalData)||void 0===e?void 0:e.email}get name(){var e,t;const s=this._additionalData;return null!==(t=null!==(e=null==s?void 0:s.displayName)&&void 0!==e?e:null==s?void 0:s.groupName)&&void 0!==t?t:null==s?void 0:s.organizationName}get role(){return this._role}get type(){return this._type}get inheritances(){return this._inheritances}get isDirect(){return this._isDirect}get hasContributorRole(){return vr.includes(this._role)}get hasName(){return!!this.name}get invited(){var e;return null===(e=this._inheritances)||void 0===e?void 0:e.includes("deep")}get isAdmin(){var e;return null===(e=this._inheritances)||void 0===e?void 0:e.includes("deep_override")}},remoteIdProperty:"id",propertyUpdater:new hs({_type:{name:"type",choices:["imsUser","addressBookGroup","addressBookContact","predefinedPrincipal","imsGroup"]},_role:{name:"role",choices:yr},_inheritances:{name:"inheritances",isArray:!0,choices:Ir},_additionalData:{name:"additionalData",format:"object"},_isDirect:{name:"isDirect",format:"boolean"}})});class Ar extends $t{constructor(){super(...arguments),this._created=new Date,this._createdBy="",this._name="",this._repositoryID="",this._repositoryName="",this._state="active",this._role="none"}get teamID(){return this.id}get created(){return this._created}get createdBy(){return this._createdBy}get name(){return this._name}get description(){return this._description}get repositoryID(){return this._repositoryID}get repositoryName(){return this._repositoryName}get repositoryOwnerID(){return this._repositoryOwnerID}get repositoryOwnerEmail(){return this._repositoryOwnerEmail}get repositoryOwnerType(){return this._repositoryOwnerType}get collaboratorRole(){return Zs("collaboratorRoleDeprecated","The property collaboratorRole has been depecrated in favor of role."),"owner"===this._role?"editor":this._role}get role(){return this._role}get state(){return this._state}get _links(){return this.__links}async archive(){await this._core.spaceContext.archiveTeam(this)}async createSpace(e){return await this._core.spaceContext.createSpace(this,e)}async permanentlyDelete(){await this._core.spaceContext.permanentlyDeleteTeam(this)}async rename(e){await this._core.spaceContext.renameTeam(this,e)}async restore(){await this._core.spaceContext.restoreTeam(this)}async update(e){await this._core.spaceContext.updateTeam(this,e)}async ensureDescription(){await this._core.spaceContext.loadTeamProperties(this)}}h([O],Ar.prototype,"created",null),h([O],Ar.prototype,"createdBy",null),h([O],Ar.prototype,"name",null),h([O],Ar.prototype,"description",null),h([O],Ar.prototype,"repositoryID",null),h([O],Ar.prototype,"repositoryName",null),h([O],Ar.prototype,"repositoryOwnerID",null),h([O],Ar.prototype,"repositoryOwnerEmail",null),h([O],Ar.prototype,"repositoryOwnerType",null),h([O],Ar.prototype,"collaboratorRole",null),h([O],Ar.prototype,"role",null),h([O],Ar.prototype,"state",null),h([O],Ar.prototype,"_links",null);const br=new os({localItemType:Ar,remoteIdProperty:"id",propertyUpdater:new hs({_created:{name:"createDate",format:"date"},_createdBy:"createdBy",_description:"description",_name:"name",_repositoryID:"repositoryId",_repositoryName:"repositoryName",_repositoryOwnerID:"repositoryOwner.id",_repositoryOwnerEmail:"repositoryOwner.email",_repositoryOwnerType:{name:"repositoryOwner.type",choices:["org","user"]},_role:{name:"role",choices:yr},_state:{name:"state",choices:["active","discarded"]},__links:{name:"_links",format:"object"}})}),Sr={name:"name",created:"createDate"},Er={name:(e,t)=>kt(e.name,t.name),created:(e,t)=>Mt(e.created,t.created)};class Tr extends(jt(Er)){}Tr.default=new Tr("ascending","name");class Cr{constructor(e,t){this._teamPool=e,this._projectInterface=t}async loadPage(e){return await this._loadPage(e)}async _loadPage(e,t){const{updateContext:s,limit:i,filter:r,order:o}=e,n=this._teamPool._core.environment.getValue("PROJECTS_LIST_UPDATE_LATENCY"),a=Date.now()-n,c=await this._projectInterface.getTeams({orderBy:Sr[o.field],orderDirection:o.direction,start:t,limit:i,nameContains:null==r?void 0:r.nameContains,state:null==r?void 0:r.state}),l=this._teamPool.createUpdateSession(s,a),d=br.updateRemoteItems(l,c.teams);let h;l.commit();const u=c.pageSpec.start+c.pageSpec.limit;return u<c.pageSpec.totalLimit&&(h=e=>this._loadPage(e,u)),{items:d,total:c.pageSpec.totalLimit,loadNextPage:h,mostRecentValidMutation:a}}}class Rr extends Nt{constructor(){super(...arguments),this._repositoryID=""}get repositoryID(){return this._repositoryID}async createTeam(e){return await this._core.spaceContext.createTeam(this,e)}}h([O],Rr.prototype,"repositoryID",null);const Pr=new os({localItemType:Rr,remoteIdProperty:"repositoryId",propertyUpdater:new hs({_repositoryID:"repositoryId"})});class Or{constructor(e,t){this._orgRepositoryPool=e,this._projectInterface=t}async loadPage({updateContext:e}){const t=await this._projectInterface.getOrgRepositories(),s=this._orgRepositoryPool.createUpdateSession(e),i=Pr.updateRemoteItems(s,t.repositories);return s.commit(),{items:i}}}function Dr(e){const t=new Set(e.items.map((e=>e.id)));return e=>t.has(e)?"MEMBER":"NONE"}function Lr(e){const t=e._links;if(!t)throw new o("INVALID_DATA",'Object has not been loaded correctly, missing "_links" property.');return t}class xr{constructor(e){this._core=e,this._orgRepositoryPool=new pe(this._core,"orgRepository"),this._teamPool=new pe(this._core,"team"),this._spacePool=new pe(this._core,"space"),this._projectInterface=new pr(this._core),this._rapi=new Ke(this._core),this._teamRoleGetterFactory=async()=>Dr(await this._fetchTeams()),this._teamPoolDelegate={onItemsUpdated:()=>{const e=this.getTeams()._getExistingList(Tr.default);if(!e||!e.items.length)return void this._core.environment.debug("[SpaceContext._teamPoolDelegate] skipping update of Space.teamRole -- no teams");const t=this._spacePool,s=Dr(e),i=t.createUpdateSession("Updating teamRole across all spaces");this._spacePool.forEach((e=>{const t=s(e.teamID);e.teamRole!==t&&Yi.updateLocalItem(i,e,{teamRole:t})})),i.commit()}},this._teamPool.addDelegate(this._teamPoolDelegate,"context")}get projectInterface(){return this._projectInterface}get orgRepositoryPool(){return this._orgRepositoryPool}get teamPool(){return this._teamPool}get spacePool(){return this._spacePool}async discoverLinks(){return await this._projectInterface.discoverLinks()}getOrgRepositories(){const e=new Or(this._orgRepositoryPool,this._projectInterface);return new li(this._orgRepositoryPool,[e])}getTeams(){const e=new Cr(this._teamPool,this._projectInterface);return new li(this._teamPool,[e])}getSpaces(){const e=new gr(this._spacePool,this._projectInterface,this._teamRoleGetterFactory);return new li(this._spacePool,[e])}async _fetchTeams(){const e=this.getTeams().getList(Tr.default,void 0,{refreshTimeout:3e5});return await function(e){const t=e;return new Promise((s=>{function i(){e.status!==Hs.Loading&&(t.off(ei,i),s())}t.on(ei,i),i()}))}(e),e}async provisionType1Team(){if("type1"!==this._core.environment.getValue("ACCOUNT_TYPE"))return;const e=await this._fetchTeams(),t=this._core.environment.getValue("USER_ID");let s=e.items.find((e=>e.repositoryOwnerID===t&&"user"===e.repositoryOwnerType));if(!s){const e=await this._projectInterface.provisionTeam(),t=this._teamPool.createMutationSession();s=br.updateRemoteItem(t,e),t.commit()}return s}async createTeam(e,t){const s=await this._projectInterface.createTeam(Object.assign(Object.assign({},t),{repositoryId:e.repositoryID})),i=this._teamPool.createMutationSession(),r=br.updateRemoteItem(i,s);return i.commit(),r}async _renameAsset(e,t){if(!Jt(t))throw new o("INVALID_PARAMETER","Invalid name provided for the rename operation.");const s=await this._core.hostAssetContext.getAssetWithCloudID(e);return await s.rename(t),s}async _renameTeam(e,t){const s=t.name;if(!s)return;if(!Jt(s))throw new o("INVALID_PARAMETER","Invalid name provided for the rename operation.");const i=Lr(e);await this._projectInterface.renameTeam(i,s);const r=this._core.hostAssetContext.assetPool,n=r.getLocalItemById(e.id);if(n){const e=ts(s,n),t=r.createUpdateSession();ss({assetPool:this._core.hostAssetContext.assetPool,asset:n,session:t,newPath:e}),bi.updateLocalItem(t,n,{"repo:path":e,"repo:name":s}),t.commit()}const a=this.teamPool.createMutationSession();br.updateLocalItem(a,e,{name:s}),a.commit()}async renameTeam(e,t){await this.updateTeam(e,{name:t})}async restoreTeam(e){await Nt.runExclusiveTask("restore",[e],(async()=>{try{const t=Lr(e),s=this.teamPool.createUpdateSession();await this._projectInterface.restoreTeam(t),br.updateLocalItem(s,e,{state:"active"}),s.commit()}catch(e){throw new o("UNEXPECTED_RESPONSE","An error occured restoring team")}}))}async archiveTeam(e){await Nt.runExclusiveTask("archive",[e],(async()=>{const t=this.teamPool.createUpdateSession();try{const t=Lr(e);await this._projectInterface.archiveTeam(t)}catch(t){const s=t;if("INVALID_DATA"!==s.code)throw s;{const t=await this._core.hostAssetContext.getAssetWithCloudID(e.id);await t.discard()}}br.updateLocalItem(t,e,{state:"discarded"}),t.commit()}))}_validateDescription(e){return e.length<=1e3}_validateColor(e){return/^#[A-Fa-f0-9]{6}$/.test(e)}_getPatchOP(e,t,s,i){if(i&&!i(e))throw new o("INVALID_DATA",`Property ${t} has invalid value`);return 0===e.length&&s&&s.length>0?{op:"remove",path:t}:{op:s?"replace":"add",value:e,path:t}}async _patchTeam(e,t){const{description:s}=t,i=[],r={};if(void 0!==s&&(i.push(this._getPatchOP(s,"/description",e.description,this._validateDescription)),r.description=s),!i.length)return;const o=Lr(e);await this._projectInterface.patchTeam(o,i);const n=this.teamPool.createMutationSession();br.updateLocalItem(n,e,r),n.commit()}async updateTeam(e,t){await Nt.runExclusiveTask("update",[e],(async()=>{const s=await Promise.allSettled([this._patchTeam(e,t),this._renameTeam(e,t)]);this._checkForRejection(s,(()=>{const t=this.teamPool.createUpdateSession();t.queueDiscardedItem(e),t.commit()}))}))}async loadTeamProperties(e){const t=Lr(e),s=await this._projectInterface.getTeamProperties(t);if(!s||0===Object.keys(s).length)return;const i=this.teamPool.createMutationSession();br.updateLocalItem(i,e,Object.assign({},s)),i.commit()}async permanentlyDeleteTeam(e){if("active"===e.state)throw new o("FORBIDDEN","Teams that are not 'discarded' cannot be permanently deleted.");const t=t=>{if(t.discardedItems){const s=t.discardedItems.filter((t=>t.id===e.id)).map((e=>e.id));s.length&&this._teamPool.removeLocalItems(s)}};this._teamPool.on(de,t);try{await Nt.runExclusiveTask("delete",[e],(async()=>{const t=Lr(e);await this._projectInterface.permanentlyDeleteTeam(t);const s=this.teamPool.createUpdateSession();s.queueDiscardedItem(e),s.commit()}))}finally{this.teamPool.off(de,t)}}async[$i](e){const t=this._core.environment.getValue("PROJECTS_ITEM_UPDATE_LATENCY");await e.waitForMutationPropagationIfNeeded(t);const s=Lr(e),i=await this._projectInterface.reloadSpace(s,ar),r=this._spacePool.createUpdateSession();Yi.updateLocalItem(r,e,i),r.commit()}async _moveSpaces(e,t,s=!0,i){let r={failedResults:[],newModels:[]};return await Nt.runExclusiveTask("move",e,(async()=>{const s=await this._core.hostAssetContext.getAssetWithCloudID(t.id);void 0===i&&(i=new Map);const o=new Map,n=e.map((e=>{o.set(e.id,e);let t=`${s.repoPath}/${e.name}`;return t=Xt(this._core,e.id,t,!1,i),{op:"move",id:e.id,source:{"repo:assetId":e.id,"repo:repositoryId":e.repositoryID},target:{"repo:path":t,"repo:repositoryId":s.repositoryID}}}));r=await this._runOperations(n,o,{teamId:t.id,teamName:t.name})})),s?await zi(r,t,i,this._moveSpaces.bind(this)):r}async moveSpaces(e,t){return this._moveSpaces(e,t)}async archiveSpaces(e){return await Nt.runExclusiveTask("archive",e,(async()=>{const t=new Map,s=e.map((e=>(t.set(e.id,e),{op:"discard",id:e.id,target:{"repo:assetId":e.id,"repo:repositoryId":e.repositoryID}})));return await this._runOperations(s,t)}))}async restoreSpaces(e,t){return await Nt.runExclusiveTask("restore",e,(async()=>{const s=new Map,i=e.map((e=>(s.set(e.id,e),{op:"restore",id:e.id,target:{"repo:assetId":e.id,"repo:repositoryId":e.repositoryID},name:null==t?void 0:t.get(e)})));return await this._runOperations(i,s)}))}async _runOperations(e,t,s={}){return await this._rapi.runOperationsForContext(e,t,this._spacePool,((e,t,i)=>{if(!i)throw new o("UNEXPECTED_RESPONSE","Missing metadata from asset bulk operation.");const r=i["repo:path"];if(t.pathName!==r){const e=this._core.hostAssetContext.assetPool,s=e.getLocalItemById(t.id),i=e.createUpdateSession();s&&(ss({assetPool:this._core.hostAssetContext.assetPool,asset:s,session:i,newPath:r}),bi.updateLocalItem(i,s,{"repo:path":r}),i.commit())}Yi.updateLocalItem(e,t,Object.assign({state:"ACTIVE"===i["repo:state"]?"active":"archived",name:i["repo:name"],pathName:i["repo:path"]},s))}),[{match:e=>"ACCESS_DENIED"===e.code||"NOT_FOUND"===e.code,action:async e=>await e.load().catch((t=>({model:e,error:t})))}])}async createSpaceBookmarks(e){return this._bookmarkSpaces("ADD",e)}async removeSpaceBookmarks(e){return this._bookmarkSpaces("REMOVE",e)}async _bookmarkSpaces(e,t){await Nt.runExclusiveTask("bookmark",t,(async()=>{var s;const i=this._core.environment.getValue("USER_ID"),r={bookmarked:"ADD"===e},o=this.spacePool.createUpdateSession(),n=new Map,a=t.map((e=>(n.set(e.id,{space:e,wasBookmarked:e.isBookmarked}),Yi.updateLocalItem(o,e,r),{projectUrn:e.id,userId:i})));let c;o.commit();try{c=await this._projectInterface.bookmarkOp({op:e,items:a})}finally{if(c)for(const e of c.responses){const t=n.get(null===(s=e.request)||void 0===s?void 0:s.projectUrn);t&&(t.status=e.status)}const e=this.spacePool.createUpdateSession(),t=this.spacePool.createMutationSession();for(const{space:s,wasBookmarked:i,status:o}of n.values())201===o?Yi.updateLocalItem(t,s,r):(Yi.updateLocalItem(e,s,{bookmarked:i}),404===o&&e.queueDiscardedItem(s));e.commit(),t.commit()}}))}_checkForRejection(e,t){for(const s of e)if("rejected"===s.status){const e=s.reason;throw e instanceof o&&"NOT_FOUND"===e.code&&t(),e}}async updateSpace(e,t){await Nt.runExclusiveTask("update",[e],(async()=>{const s=await Promise.allSettled([this._renameSpace(e,t),this._patchSpace(e,t)]);this._checkForRejection(s,(()=>{const t=this.spacePool.createUpdateSession();t.queueDiscardedItem(e),t.commit()}))}))}async _renameSpace(e,t){const{name:s}=t;if(void 0===s)return;const i=await this._renameAsset(e.id,s),r=this.spacePool.createMutationSession();Yi.updateLocalItem(r,e,{name:i.name,pathName:i.repoPath}),r.commit()}async _patchSpace(e,t){const{description:s,color:i}=t,r=[],o={};if(void 0!==s&&(r.push(this._getPatchOP(s,"/description",e.description,this._validateDescription)),o.description=s),void 0!==i&&(r.push(this._getPatchOP(i,"/color",e.color,this._validateColor)),o.color=i),!r.length)return;const n=Lr(e);await this._projectInterface.patchSpace(n,r);const a=this.spacePool.createMutationSession();Yi.updateLocalItem(a,e,o),a.commit()}async createSpace(e,t){const s=Lr(e);this._validateColor(t.color),this._validateDescription(t.description),Jt(t.name);const i=await this._projectInterface.createSpace(s,Object.assign(Object.assign({},t),{parentId:e.id})),r=this.spacePool.createMutationSession(),o=Yi.updateRemoteItem(r,Object.assign(Object.assign({},i),{teamId:e.id}));return r.commit(),o}async getEnclosingSpace(e){return(await this.getEnclosingSpaces([e])).get(e)}async getEnclosingSpaces(e){const t=this._core.environment.getValue("PROJECTS_LIST_UPDATE_LATENCY"),s=Date.now()-t,i=await this._projectInterface.getEnclosingSpaces(e.map((e=>({"repo:assetId":e})))),r=new Map,o=this.spacePool.createUpdateSession("get enclosing spaces",s);for(const e of i.responses){if(200!==e.status)continue;const t=e.request["repo:assetId"],s=Yi.updateRemoteItem(o,e.body);r.set(t,s)}return o.commit(),r}async lookupSpaceById(e){let t=this._spacePool.getLocalItemById(e);if(!t){const s=await this._projectInterface.getSpace(e,ar),i=this._spacePool.createUpdateSession();t=Yi.updateRemoteItem(i,s),i.commit()}return t}onUserLeftTeam(e){const t=this._teamPool.getLocalItemById(e);if(t){const e=this._teamPool.createUpdateSession();e.queueDiscardedItem(t),e.commit()}}}h([R],xr.prototype,"getOrgRepositories",null),h([R],xr.prototype,"getTeams",null),h([R],xr.prototype,"getSpaces",null);class Nr{constructor(e,t,s){this._collaboratorPool=e,this._invitationInterface=t,this._urn=s}async loadPage({updateContext:e}){const t=await this._invitationInterface.getCollaborators(this._urn),s=this._collaboratorPool.createUpdateSession(e),i=new Set(t.directCollaborators.map((({id:e})=>e)));t.collaborators.forEach((e=>e.isDirect=i.has(e.id)));const r=wr.updateRemoteItems(s,t.collaborators);return s.commit(),{items:r}}}const kr=new os({localItemType:class extends Nt{constructor(){super(...arguments),this._email="",this._role="viewer",this._canComment=!1,this._canShare=!1,this._acceptanceRequired=!1,this._created=new Date}get invitationID(){return this.id}get email(){return this._email}get role(){return this._role}get canComment(){return this._canComment}get canShare(){return this._canShare}get acceptanceRequired(){return this._acceptanceRequired}get inheritance(){return this._inheritance}get created(){return this._created}},remoteIdProperty:"id",propertyUpdater:new hs({_email:"email",_role:{name:"role",choices:yr},_canComment:{name:"canComment",format:"boolean"},_canShare:{name:"canShare",format:"boolean"},_acceptanceRequired:{name:"acceptanceRequired",format:"boolean"},_inheritance:{name:"inheritance",choices:Ir},_created:{name:"created",format:"date_as_number"}})});class Mr{constructor(e,t,s){this._invitedCollaboratorPool=e,this._invitationInterface=t,this._urn=s}async loadPage({updateContext:e}){const t=await this._invitationInterface.getCollaborators(this._urn),s=this._invitedCollaboratorPool.createUpdateSession(e),i=kr.updateRemoteItems(s,t.invitations);return s.commit(),{items:i}}}const jr={parse:e=>e,isEqual:(e,t)=>It(e,t)},Ur={parse:e=>e,isEqual:(e,t)=>It(e,t)},Fr=new os({localItemType:class extends Nt{constructor(){super(...arguments),this._collaborators=[],this._error=void 0}get getAssetID(){return this.id}get collaborators(){return this._collaborators}get error(){return this._error}},remoteIdProperty:"urn",propertyUpdater:new hs({_collaborators:{get:function(e,t){const s=new pe(t._core,"collaborator").createUpdateSession();if(200!==e.statusCode)return[];const i=JSON.parse(e.response),r=wr.updateRemoteItems(s,i.collaborators);return s.commit(),r},format:jr},_error:{get:function(e){if(200===e.statusCode)return;const t=JSON.parse(e.response);return new o(t.statusCode,t.error)},format:Ur}})});class Br{constructor(e,t,s){this._collaboratorsByAssetIDPool=e,this._invitationInterface=t,this._assetIDs=s}async loadPage(e){return await this._loadPage(e)}async _loadPage(e,t=0){let{updateContext:s,limit:i}=e;i=void 0===i?this._invitationInterface.batchRequestLimit:i,i=Math.min(i,this._invitationInterface.batchRequestLimit);let r=this._assetIDs.slice(t,t+i);const o=await this._invitationInterface.getCollaboratorListForUrns(r),n=this._collaboratorsByAssetIDPool.createUpdateSession(s),a=Fr.updateRemoteItems(n,o.result);let c;return n.commit(),t+a.length<this._assetIDs.length&&(c=e=>this._loadPage(e,t+a.length)),{items:a,loadNextPage:c}}}class $r{constructor(e){this._core=e,this._collaboratorSourceMap=new Map,this._invitationInterface=new Ue(this._core),this._collaboratorsByAssetIDPool=new pe(this._core,"collaboratorsByAssetID")}getCollaboratorsForAssets(e){const t=new Br(this._collaboratorsByAssetIDPool,this._invitationInterface,e);return new li(this._collaboratorsByAssetIDPool,[t])}_getCollaboratorSources(e){const t=this._collaboratorSourceMap.get(e);if(t){const e=t.deref();if(e)return e}const s=new pe(this._core,"collaborator"),i=new Nr(s,this._invitationInterface,e),r=new li(s,[i]),o=new pe(this._core,"invitedCollaborator"),n=new Mr(o,this._invitationInterface,e),a={collaboratorPool:s,collaboratorSource:r,invitedCollaboratorPool:o,invitedCollaboratorSource:new li(o,[n])};return this._collaboratorSourceMap.set(e,new re(a)),a}getCollaborators(e){return this._getCollaboratorSources(e).collaboratorSource}removeCollaborator(e,t){return this._invitationInterface.modifyCollaborators(e,{collaborators:[{id:t.id,action:"remove"}]}).then((()=>{const{collaboratorPool:s}=this._getCollaboratorSources(e),i=s.createUpdateSession();i.queueDiscardedItem(t),i.commit()}))}getInvitedCollaborators(e){return this._getCollaboratorSources(e).invitedCollaboratorSource}removeInvitedCollaborator(e,t){return this._invitationInterface.modifyCollaborators(e,{invitations:[{id:t.id,action:"remove"}]}).then((()=>{const{invitedCollaboratorPool:s}=this._getCollaboratorSources(e),i=s.createUpdateSession();i.queueDiscardedItem(t),i.commit()}))}}class Vr{constructor(){this._contexts=new Map}register(e){let t=this._contexts.get(e);t||(t={id:Gs(),references:new Set},this._contexts.set(e,t));const s=Gs();return t.references.add(s),()=>{const t=this._contexts.get(e);t&&(t.references.delete(s),0===t.references.size&&this._contexts.delete(e))}}reportObserved(e,t="change"){for(const[s,{id:i}]of this._contexts){const r=`_atom_${i}_${t}`;let o=e[r];if(!o){const i=()=>o.reportChanged();o=s(`${e.constructor.name}_${t}`,(()=>e.on(t,i)),(()=>e.off(t,i))),e[r]=o}o.reportObserved()}}}var Hr;!function(e){e[e.Stage=0]="Stage",e[e.Production=1]="Production"}(Hr||(Hr={}));const Wr={USER_ID:"",CLIENT_ID:"",ACCESS_TOKEN:"",ENVIRONMENT:Hr.Production,HOST_PRODUCT_DATA:{PRODUCT_ID:"",PRODUCT_LOCATION:""},FETCH_REQUEST_TIMEOUT:6e4,ASYNC_DEFAULT_DELAY:1e3,CACHE_DEFAULT_TTL:2592e6,MIN_RETRY_INTERVAL:1e3,MAX_RETRY_INTERVAL:12e4,ONS_DOCUMENT_VISIBILITY_TIMEOUT:1e4,ONS_DEFAULT_MAX_SUBSCRIPTIONS:5,ONS_DEFAULT_MAX_ASSETS_PER_SUBSCRIPTION:100,INDEXED_DB_VERSION:1,PROJECTS_LIST_UPDATE_LATENCY:3e3,PROJECTS_ITEM_UPDATE_LATENCY:1e3,ASSETS_LIST_UPDATE_LATENCY:100,VERSIONS_LIST_UPDATE_LATENCY:100,ASSET_COPY_NAME_FORMAT:"%@ copy (%d)",ASSET_CONFLICT_NAME_FORMAT:"%@ (%d)",USE_USS_TO_UPDATE_SBM:!1,DISABLE_ONS:!1},Gr={[Hr.Stage]:{LABEL:"Staging",ACP_CS_HOST:"platform-cs-stage.adobe.io",SYNC_SERVICE_HOST:"acp-ss-stage.adobe.io",PROJECTS_HOST:"ccprojects-stage.adobe.io",INVITATIONS_HOST:"invitations-stage.adobe.io",TRANSFER_SERVICE_HOST:"ats-stage.adobe.io",USS_HOST:"adobesearch-stage.adobe.io",XDCE_HOST:"xdce-stage.adobe.io"},[Hr.Production]:{LABEL:"Production",ACP_CS_HOST:"platform-cs.adobe.io",SYNC_SERVICE_HOST:"acp-ss.adobe.io",PROJECTS_HOST:"ccprojects.adobe.io",INVITATIONS_HOST:"invitations.adobe.io",TRANSFER_SERVICE_HOST:"ats.adobe.io",USS_HOST:"adobesearch.adobe.io",XDCE_HOST:"xdce.adobe.io"}},Yr=e=>"string"==typeof e&&Boolean(e),qr=[{key:"CLIENT_ID",validator:Yr},{key:"USER_ID",validator:Yr},{key:"ENVIRONMENT",validator:e=>(e=>"number"==typeof e)(e)&&e in Hr},{key:"HOST_PRODUCT_DATA",validator(e){if(!e)return!1;const{PRODUCT_ID:t,PRODUCT_LOCATION:s}=e;return Yr(t)&&Yr(s)}}];class Jr{constructor(e,t,s){this._core=e,this._hooks=s,this._isTokenInvalid=!0,this.mobx=new Vr;const i=Object.assign({},Wr,t),r=qr.filter((({key:e,validator:t})=>!t(i[e])));if(r.length){const e=r.map((({key:e})=>e)).join(", ");throw new o("INVALID_PARAMETER",`Invalid required options: ${e}`)}if(i.ACCESS_TOKEN)this._isTokenInvalid=!1;else if(!s.refreshAccessToken)throw new o("INVALID_PARAMETER","refreshAccessToken hook must be provided if ACCESS_TOKEN is not set");this._config=i,this._cache=new Rt(i.USER_ID,e,s.persistentCache)}get cache(){return this._cache}getValue(e){return this._config[e]}setValue(e,t){this._config[e]=t}get endpoints(){const e=this._config.ENVIRONMENT;return Gr[e]}async getDeviceId(){return this._config.DEVICE_ID||await this.cache.getItem("DEVICE_ID",(async()=>Gs()),(e=>"string"==typeof e))}_loggerEvent(e,t){this._core.listenerCount(oo)>0&&this._core.emit(oo,new co(e,t))}log(e){this._loggerEvent(e,ao.Info)}debug(e){this._loggerEvent(e,ao.Debug)}error(e){this._loggerEvent(e,ao.Err)}warn(e){this._loggerEvent(e,ao.Warn)}async _refreshAccessToken(){if(this._isTokenInvalid){if(!this._hooks.refreshAccessToken)return"";this.log("Refreshing access token from host...");try{this._config.ACCESS_TOKEN=await this._hooks.refreshAccessToken(this._config.ACCESS_TOKEN)}catch(e){throw n.wrapErrorIfNeeded("NO_ACCESS_TOKEN","Failed to refresh access token",e)}this._isTokenInvalid=!1,this.log("Refreshing access token "+(this._config.ACCESS_TOKEN?"successful":"unsuccessful"))}return this._config.ACCESS_TOKEN}async fetch(e,t={},s=0){if(this._hooks.fetch)return this._hooks.fetch(e,t);let i=this._isTokenInvalid?await this._refreshAccessToken():this._config.ACCESS_TOKEN;if(!i)throw new o("NO_ACCESS_TOKEN","Unable to obtain access token - did you provide a refreshAccessToken hook?");const r=t.authHeader||"Authorization";delete t.authHeader;const a=Gs(),c=Object.assign(Object.assign({},t.headers),{[r]:`Bearer ${i}`,"X-Api-Key":this._config.CLIENT_ID,"X-Request-Id":a}),l=new AbortController;let d=()=>{};t.signal?d=((e,...t)=>{const s=new AbortController,i=()=>{t.forEach((e=>e.removeEventListener("abort",r)))},r=()=>{s.abort(),i()};return t.some((e=>e.aborted))?r():t.forEach((e=>e.addEventListener("abort",r))),e.signal=s.signal,i})(t,t.signal,l.signal):t.signal=l.signal;const h=setTimeout((()=>l.abort()),this.getValue("FETCH_REQUEST_TIMEOUT")),u=Date.now();this.debug(`[${a}] ${t.method||"GET"} ${e}`);try{const r=await fetch(e,Object.assign(Object.assign({},t),{headers:c}));if(this.debug(`[${a}] ${r.status} (${Date.now()-u}ms)`),clearTimeout(h),401===r.status){if(i!==this._config.ACCESS_TOKEN)return this.fetch(e,t,s+1);if(this._isTokenInvalid=!0,s<1)return this.fetch(e,t,s+1)}return r}catch(t){throw this.debug(`[${a}] Error - ${t} (${Date.now()-u}ms)`),n.wrapErrorIfNeeded("NETWORK_ERROR",`Failed network request when fetching: ${e}`,t)}finally{d()}}getRetryInterval(e){return this.getValue(e<3?"MIN_RETRY_INTERVAL":"MAX_RETRY_INTERVAL")}}h([R],Jr.prototype,"getDeviceId",null),h([V],Jr.prototype,"_refreshAccessToken",null);const zr=Symbol.for("com.adobe.ccac.samjs.extendclass.override_map"),Kr=Symbol.for("com.adobe.ccac.samjs.extendclass.emitter");function Xr({klass:e,core:t,extensions:s={},overrides:i={},eventMap:r={},defaultObservableEvent:o,observableMap:n={}}){const a=Object.getOwnPropertyDescriptors(e.prototype);let c=a;function l(e,t){let s=e[t];if("function"==typeof e[t])return{value:s};if(["string","boolean","number"].includes(typeof e[t]))throw new Error("Cannot use primitives for PropertyDescriptor");return s}void 0===c.on&&(c=Object.getOwnPropertyDescriptors(Object.getPrototypeOf(e.prototype))),a._core||Object.defineProperty(e.prototype,"_core",{value:t}),Object.getOwnPropertyDescriptor(e.prototype,Kr)||Object.defineProperties(e.prototype,{[Kr]:{get(){var e;let t;return t="function"==typeof(null===(e=c.on)||void 0===e?void 0:e.value)?{on:c.on.value.bind(this),off:c.off.value.bind(this),emit:c.trigger.value.bind(this),addListener:c.on.value.bind(this),removeListener:c.off.value.bind(this)}:new W,Object.defineProperty(this,Kr,{value:t}),this[Kr]}},on:{value(e,...t){var s;return(null!==(s=r[e])&&void 0!==s?s:[e]).forEach((e=>this[Kr].on(e,...t))),this}},addListener:{value(...e){return this.on(...e)}},off:{value(e,...t){var s;return(null!==(s=r[e])&&void 0!==s?s:[e]).forEach((e=>this[Kr].off(e,...t))),this}},removeListener:{value(...e){return this.off(...e)}},emit:{value(...e){return this[Kr].emit(...e)}},dispatch:{value(e){return this.emit(e.type,e,this)}}});const d=new Set;Object.keys(s).forEach((t=>{if(a[t])return;const i=l(s,t);Object.defineProperty(e.prototype,t,i),d.add(t)}));const h=e.prototype[zr]||new Set;Object.keys(i).forEach((t=>{if(h.has(t))return;if(d.has(t))throw new Error(`[ExtendClass] cannot override property '${t}' because it is an extension.`);if(!a[t])throw new Error(`[ExtendClass] target class does not have property '${t}' so it cannot be overridden.`);const s=l(i,t),r=a[t].value;"function"==typeof r?Object.defineProperty(e.prototype,t,{get(){return s.value.original=r.bind(this),s.value}}):Object.defineProperty(e.prototype,t,s),h.add(t),d.add(t)})),e.prototype[zr]=h;const u={};Object.keys(n).reduce(((e,t)=>(n[t].forEach((s=>{if(e.has(s))throw new Error(`[ExtendClass] cannot have the same property (${s}) appear multiple times in observableMap`);if(d.has(s))throw new Error(`[ExtendClass] cannot make property (${s}) observable as it was defined in extensions/overrides`);e.add(s),d.add(s),u[s]=t})),e)),new Set),o&&Object.keys(a).filter((e=>!!a[e].get)).filter((e=>!d.has(e))).forEach((e=>u[e]=o)),Object.entries(u).forEach((([t,s])=>{var i;(null===(i=a[t])||void 0===i?void 0:i.get)&&Object.defineProperty(e.prototype,t,{get(){return this._core.environment.mobx.reportObserved(this,s),a[t].get.call(this)}})}))}function Qr(){return"undefined"!=typeof window?null===window||void 0===window?void 0:window.acplModel:void 0}function Zr(e=""){const t=e.split(".");"0-main"===t[2]&&t.splice(2,1);const[s="0",i="0",r="0"]=t;return[s,i,r].map((e=>e.padStart(4,"0"))).join("")}function eo(e,t){var s;const i=Zr(null===(s=Qr())||void 0===s?void 0:s.version),r=Zr(t);switch(e){case"lt":return i<r;case"gte":return i>=r;default:return!1}}const to=new class extends se{constructor(){super("thumbnailChange")}},so=new class extends se{constructor(){super("permissionsChange")}},io=Symbol.for("com.adobe.ccac-sam-js.instances"),ro="itemListStateChanged",oo="messageLogged";class no extends se{constructor(e){super(ro),this.list=e}}var ao;!function(e){e[e.Off=0]="Off",e[e.Err=1]="Err",e[e.Warn=2]="Warn",e[e.Info=3]="Info",e[e.Debug=4]="Debug"}(ao||(ao={}));class co extends se{constructor(e,t){super(oo),this.message=e,this.logLevel=t}}class lo extends te{constructor(e={},t={}){super(),this._environment=new Jr(this,e,t)}_setAssetContext(e){this._AssetContext?console.error("[SAMCore] AssetContext already initialized"):(this._AssetContext=e,this._AssetContextJS=new Qi(this))}_setSpaceContext(e){this._SpaceContext?console.error("[SAMCore] SpaceContext already initialized"):this._SpaceContext=e}get hostAssetContext(){return this._AssetContext||(this._AssetContext=new Qi(this)),this._AssetContext}get assetLinkManager(){return new rr(this.hostAssetContext)}get spaceContext(){return this._SpaceContext||(this._SpaceContext=new xr(this)),this._SpaceContext}get collaborationContext(){return new $r(this)}makeObservable(e){return this._environment.mobx.register(e)}get environment(){return this._environment}}async function ho(e={},t={}){let s={};"undefined"!=typeof window&&(window[io]?s=window[io]:window[io]=s);const i="3.0.0",[r,n,a]=i.split(".").map(Number),c=Object.keys(s),l=c.find((e=>{if(e===i)return!0;const[t,s,o]=e.split(".").map(Number);return 0!==r&&t===r&&(s>n||s===n&&o>=a)}));if(l)return s[l];c.length>0&&console.warn(`An instance of SAM.js already exists, but is not compatible with the requested version: ${i}. Because of this, a new instance of SAM.js will be created. Loaded versions: ${c.join(", ")}.`);const d="undefined"!=typeof window&&window.acplModel;s[i]=new Promise(((s,i)=>{var r;d&&!e._DISABLE_SAM_CPP?Promise.race([null!==(r=d.applicationAssetContext)&&void 0!==r?r:d.waitForApplicationContextReady()]).then((()=>{try{if(!(()=>{var e,t;const s=null===(e=d.applicationAssetContext)||void 0===e?void 0:e.rootFolder.constructor.prototype;return Boolean(s)&&!0===(null===(t=Object.getOwnPropertyDescriptor(s,"name"))||void 0===t?void 0:t.configurable)})())return void s(new lo(e,t));const i=new lo(e,t);!function(e){const t=Qr().applicationAssetContext.rootFolder.constructor;eo("lt","9999.9999.9999")&&Xr({klass:t,core:e,extensions:{id:{get(){return this.cloudID||this.localID}},discard(){return this.routesToAcplV2||Zs("discardAsArchive",`Asset.discard(): '${this.repoPath}' will be archived rather than discarded because it routes to ACPL v1 rather than V2.`),this.archive()},links:{get:()=>({})},hasPermission(...e){this._core.environment.mobx.reportObserved(this,so.type);const t=!!this._permissions&&vi.prototype.hasPermission.apply(this,e);return this._hasLoadedPermissions||(this._hasLoadedPermissions=!0,this._core._AssetContextJS.repoInterface.resolveById(this.cloudID).then((e=>e.getEffectivePermissions())).then((e=>{this._permissions=e,this.dispatch(so)}))),t},thumbnailURL:{get(){var e;return this._core.environment.mobx.reportObserved(this,to.type),this.isFolder?"":(!this._refreshThumbnail&&this._thumbnailInfo||(this._refreshThumbnail=!1,this.getThumbnailRendition().then((({file:e,hash:t})=>{var s,i;if((null===(s=this._thumbnailInfo)||void 0===s?void 0:s.file)===e&&(null===(i=this._thumbnailInfo)||void 0===i?void 0:i.hash)===t)return;e=e.replace("#","%23").replace("^","%5E");const r=new URL(`file://${e}`);r.searchParams.append("force",t),this._thumbnailInfo={file:e,hash:t,url:r.href},this.dispatch(to)}))),(null===(e=this._thumbnailInfo)||void 0===e?void 0:e.url)||"")}},getRenditionURL(){return Zs("getRenditionURL","SAM.cpp does not support all options of getRenditionURL. Clients that run on web and desktop should use AdobeAsset.thumbnailURL instead."),this.thumbnailURL},_onAssetChanged(){this.dispatch(ne)},_onRenditionChanged(){this._refreshThumbnail=!0,this.dispatch(to)},transferToSpace(e){return this._core.hostAssetContext.transfer(this,e)},versions:{get(){if(this._assetVersionSource)return this._assetVersionSource;const e=new pe(this._core,"version"),t=this._core._AssetContextJS.repoInterface.resolveById(this.id),s=new ui(e,t);return this._assetVersionSource=new li(e,[s]),this._assetVersionSource}}},defaultObservableEvent:ne.type})}(i),function(){const e=Qr().applicationAssetContext;eo("gte","2.0.0-main.1524")&&eo("lt","9999.9999.9999")?Object.defineProperties(Gi.prototype,{searchWorkingFiles:{value(){return this._searchWorkingFilesSource?Promise.resolve(this._searchWorkingFilesSource):(this._searchWorkingFilesSource=new Promise(((t,s)=>{e.spaceContext.lookupSpaceById(this.id).then((e=>{e||s(new o("NOT_FOUND",`searchWorkingFiles could not find Space ${this.id}`)),t(e.searchWorkingFiles())}))})),this._searchWorkingFilesSource)}},searchArtifacts:{value(t=!1){return this._searchArtifactsSource?Promise.resolve(this._searchArtifactsSource):(this._searchArtifactsSource=new Promise(((s,i)=>{e.spaceContext.lookupSpaceById(this.id).then((e=>{e||i(new o("NOT_FOUND",`searchArtifacts could not find Space ${this.id}`)),s(e.searchArtifacts(t))}))})),this._searchArtifactsSource)}}}):eo("lt","2.0.0-main.1524")&&Object.defineProperties(Gi.prototype,{searchWorkingFiles:{async value(){const e=this._core._AssetContextJS,{assetPool:t,ussInterface:s}=e,i=await this._core.hostAssetContext.getAssetWithRepoPath(`${this.pathName}/working_files`,this.repositoryID),r=new Hi(t,this._core,i,s,"excludeArtifacts",!0),o=new Wi({asset:i,artifactFilter:"excludeArtifacts"});return new li(t,[r],o)}},searchArtifacts:{async value(e=!1){const t=this._core._AssetContextJS,{assetPool:s,ussInterface:i}=t,r=await this._core.hostAssetContext.getAssetWithCloudID(this.id),o=new Hi(s,this._core,r,i,"onlyArtifacts",e),n=new Wi({asset:r,artifactFilter:"onlyArtifacts",_includeHiddenRecursive:!0});return new li(s,[o],n)}}})}(),function(e){const t=Qr().applicationAssetContext.rootFolder.children.getList(ni.Descending,ai.Modified).constructor;eo("lt","9999.9999.9999")&&Xr({klass:t,core:e,extensions:{loadNextPage(){return this.loadMoreItems()},refresh(){return this.load()},_subscribeToErrorEvent(){this._onError||(this._onError=e=>{this._errors=this._errors||[],this._errors.push(e),this.dispatch(ii)},this.on("error",this._onError))},errors:{get(){return this._core.environment.mobx.reportObserved(this,ii.type),this._errors}}},overrides:{load(){this._errors=void 0,this.dispatch(ii),this.load.original()},loadMoreItems(){this._errors=void 0,this.dispatch(ii),this.loadMoreItems.original()}},eventMap:{[si.type]:["refreshed","movedAsset","addedAsset","removedAsset"]},observableMap:{[si.type]:["items"],[ii.type]:["status"]}})}(i),function(e){const t=Qr(),s={ascending:ni.Ascending,descending:ni.Descending},i={name:ai.Name,modified:ai.Modified,created:ai.Created,shared:ai.Shared},r=t.applicationAssetContext.rootFolder.children.constructor;eo("lt","9999.9999.9999")&&Xr({klass:r,core:e,overrides:{getList(e,t){var r,o;let n,a,c=e;null===(o=null!==(r=c.direction)&&void 0!==r?r:c.field)||void 0===o||o?(a=s[c.direction],n=i[c.field]):(a=e,n=t,t=void 0),a=a in ni?a:ni.Descending,n=n in ai?n:ai.Modified;let l,d=t;return l=(null==d?void 0:d.mediaTypes)?this.getListWithTypes(a,n,[...d.mediaTypes]):this.getList.original(a,n),l._subscribeToErrorEvent(),l}}})}(i),function(e){const t=Qr(),s=t.applicationAssetContext.constructor;if(eo("lt","9999.9999.9999")){Xr({klass:s,core:e,overrides:{getAssetWithCloudID(e,t=!1){return this.getAssetWithCloudID.original(e,t)},getAssetWithAssetRefString(e,t=!1){return this.getAssetWithAssetRefString.original(e,t)}},extensions:{getUserRepoID(){return this._userRepoID?Promise.resolve(this._userRepoID):this._core._AssetContextJS.repoInterface.getHomeDirectoryMetadata().then((e=>(this._userRepoID=e["repo:repositoryId"],this._userRepoID)))},transfer(e,t){return(async()=>{let s;if(t instanceof Gi){const e=await t.getChild("working_files");if(!e)throw new o("NOT_FOUND","unable to find working_files for provided space");s=e.id}else s=t.cloudID;let i=e.repositoryID,r=t.repositoryID;"~"===i&&(i=await this.getUserRepoID()),"~"===r&&(r=await this.getUserRepoID());const n={source:{assetId:e.cloudID,repositoryId:i},target:{assetId:s,repositoryId:r}};return this._core._AssetContextJS._assetTransferService.transfer(n)})()},assetPool:{get(){return this._core._AssetContextJS.assetPool}},isOnline:{get(){return void 0!==this.networkStatus?this.networkStatus!==Xi.Offline:void 0}}},observableMap:{networkChanged:["networkStatus"],stateChanged:["cloudSyncStatus"]}});const i=({properties:e,status:t,previews:s})=>{var i,r;for(const s of[...e,...t])null===(i=s._onAssetChanged)||void 0===i||i.call(s);for(const e of s)null===(r=null==e?void 0:e._onRenditionChanged)||void 0===r||r.call(e)};t.applicationAssetContext._isForwardingAssetChangeEvents||(t.applicationAssetContext.on("changedAssets",i),t.applicationAssetContext._isForwardingAssetChangeEvents=!0)}}(i),i._setAssetContext(d.applicationAssetContext),s(i)}catch(e){console.error("[initializeSharedAssetModel] failed to patch SAM.cpp",e),i(e)}})):s(new lo(e,t))}));try{await s[i]}catch(e){throw delete s[i],e}return s[i]}function uo(e={},t={}){return console.warn("createSharedAssetModel() is deprecated - call the asynchronous initializeSharedAssetModel() instead."),new lo(e,t)}h([R],lo.prototype,"assetLinkManager",null),h([R],lo.prototype,"collaborationContext",null);const po={created:(e,t)=>Mt(e.created,t.created)};class _o extends(jt(po)){}_o.default=new _o("descending","created");const mo={id:(e,t)=>kt(e.id,t.id)};class fo extends(jt(mo)){}fo.default=new fo("ascending","id");const go={name(e,t){var s,i;return kt(null!==(s=e.name)&&void 0!==s?s:e.id,null!==(i=t.name)&&void 0!==i?i:e.id)}};class yo extends(jt(go)){}yo.default=new yo("ascending","name");const vo={email(e,t){var s,i;return kt(null!==(s=e.email)&&void 0!==s?s:e.id,null!==(i=t.email)&&void 0!==i?i:e.id)}};class Io extends(jt(vo)){}Io.default=new Io("ascending","email");const wo={noop:(e,t)=>0};class Ao extends(jt(wo)){}Ao.default=new Ao("ascending","noop");class bo extends us{constructor(e){super({mediaTypes:null==e?void 0:e.mediaTypes,excludeMediaTypes:null==e?void 0:e.excludeMediaTypes}),this._query=null==e?void 0:e.query}get hash(){return[super.hash,this.query?`query=${this._query}`:void 0].filter((e=>e)).join(":")}get query(){return this._query}matches(e){return super.matches(e)}getRelationToFilter(e){var t,s;return(null===(t=this.query)||void 0===t?void 0:t.toLowerCase())!==(null===(s=e.query)||void 0===s?void 0:s.toLowerCase())?"disjoint":super.getRelationToFilter(e)}}class So extends us{constructor(e){super({mediaTypes:null==e?void 0:e.mediaTypes,excludeMediaTypes:null==e?void 0:e.excludeMediaTypes})}get hash(){return super.hash}matches(e){return!!e.isSharedWithYouAsset&&super.matches(e)}getRelationToFilter(e){const t=e;return super.getRelationToFilter(t)}}class Eo{constructor(e){this._bookmarked=!1,this._bookmarked=Boolean(null==e?void 0:e.bookmarked),this._teamID=null==e?void 0:e.teamID,this._teamRole=null==e?void 0:e.teamRole,this._state=null==e?void 0:e.state,this._teamRole=null==e?void 0:e.teamRole}static ActiveSpacesFromTeam(e){return new Eo({state:"active",teamID:e})}get bookmarked(){return this._bookmarked}get teamID(){return this._teamID}get teamRole(){return this._teamRole}get state(){return this._state}get hash(){var e,t;return String(this.bookmarked)+":"+(this.teamID||"all-teams")+":"+(null!==(e=this._teamRole)&&void 0!==e?e:"all-roles")+":"+(null!==(t=this._state)&&void 0!==t?t:"any-state")}matches(e){if(this._bookmarked&&!e.isBookmarked)return!1;const t=this._teamID;if(t&&e.teamID!==t)return!1;const s=this._teamRole;if(s&&e.teamRole!==s)return!1;const i=this._state;return!i||i===e.state}getRelationToFilter(e){const t=e;return this._teamRole!==t._teamRole?this._teamRole&&t._teamRole?"disjoint":"unknown":this.teamID&&t.teamID&&this.teamID!==t.teamID?"disjoint":!this.teamID&&t.teamID||!this.bookmarked&&e.bookmarked?"unknown":this._state!==e._state?this._state&&e._state?"disjoint":"unknown":"subset"}}var To;Eo.ActiveSpaces=new Eo({state:"active"}),Eo.ArchivedSpaces=new Eo({state:"archived"}),Eo.ActiveBookmarkedSpaces=new Eo({state:"active",bookmarked:!0}),Eo.ActiveSpacesFromOtherTeams=new Eo({state:"active",teamRole:"NONE"}),function(e){e[e.DISJOINTED=0]="DISJOINTED",e[e.SUPERSET=1]="SUPERSET",e[e.SUBSET=2]="SUBSET",e[e.UNKNOWN=3]="UNKNOWN",e[e.IDENTICAL=4]="IDENTICAL"}(To||(To={}));const Co=e=>/\S/.test(e);class Ro{constructor(e){this._nameContains=null==e?void 0:e.nameContains,this._state=null==e?void 0:e.state}static TeamsContainingName(e){return new Ro({nameContains:e})}get nameContains(){return this._nameContains}get state(){return this._state}get hash(){var e,t;return(null!==(e=this._nameContains)&&void 0!==e?e:"any-name")+":"+(null!==(t=this._state)&&void 0!==t?t:"any-state")}_getRelationToNameContains(e,t){if(e===t)return To.IDENTICAL;const s=e.toLowerCase().split(" ").filter(Co).sort(),i=t.toLowerCase().split(" ").filter(Co).sort();if(0===s.length&&0===i.length)return To.IDENTICAL;if(0===s.length||0===i.length)return To.DISJOINTED;if(s.length===i.length&&s.every(((e,t)=>e===i[t])))return To.IDENTICAL;let r=0,o=0;return s.forEach((e=>{const t=i.find((t=>{const s=t.startsWith(e),i=e.startsWith(t);return s||i}));t&&(e.length<=t.length&&o++,e.length>t.length&&r++)})),s.length===r?To.SUBSET:s.length===o?To.SUPERSET:0===r&&0===o?To.DISJOINTED:To.UNKNOWN}_searchTarget(e,t){const s=e.toLowerCase().split(" ").filter(Co),i=t.toLowerCase().split(" ").filter(Co);return 0!==s.length&&0!==i.length&&s.every((e=>i.find((t=>t.startsWith(e)))))}matches(e){const t=this._state;if(t&&t!==e.state)return!1;const s=this._nameContains;return!(s&&!this._searchTarget(s,e.name))}getRelationToFilter(e){let t;return this.nameContains&&e.nameContains&&(t=this._getRelationToNameContains(this.nameContains,e.nameContains),t===To.DISJOINTED)||this.state&&e.state&&this.state!==e.state?"disjoint":!this.state&&e.state||!this.nameContains&&e.nameContains||t&&t===To.SUPERSET||t===To.UNKNOWN?"unknown":"subset"}}Ro.ActiveTeams=new Ro({state:"active"}),Ro.DiscardedTeams=new Ro({state:"discarded"});class Po{constructor(e){this._isMilestone=null==e?void 0:e.isMilestone,this._createdAfter=null==e?void 0:e.createdAfter,this._createdBefore=null==e?void 0:e.createdBefore,this._createdBy=null==e?void 0:e.createdBy}static AssetVersionFilter(e,t,s,i){return new Po({createdBy:i,createdAfter:t,createdBefore:s,isMilestone:e})}get isMilestone(){return this._isMilestone}get createdBy(){return this._createdBy}get createdAfter(){return this._createdAfter}get createdBefore(){return this._createdBefore}get hash(){var e,t,s;const i=null===(e=this.createdBy)||void 0===e?void 0:e.join(","),r=(null===(t=this.createdAfter)||void 0===t?void 0:t.getTime())||0,o=(null===(s=this.createdBefore)||void 0===s?void 0:s.getTime())||0;return String(this.isMilestone)+":"+i+":"+r+":"+o}matches(e){const t=void 0===this.isMilestone||this.isMilestone===Boolean(e.milestone),s=void 0===this.createdBy||this.createdBy.includes(e.createdBy),i=(!this.createdAfter||e.created>=this.createdAfter)&&(!this.createdBefore||e.created<=this.createdBefore);return t&&s&&i}_getRelationWrtMilestone(e){return this.isMilestone===e.isMilestone?"subset":void 0===this.isMilestone||void 0===e.isMilestone?"unknown":"disjoint"}_getRelationWrtCreatedBy(e){if(!this.createdBy&&!e.createdBy)return"subset";if(this.createdBy&&e.createdBy){const t=new Set(this.createdBy);return e.createdBy.every((e=>t.has(e)))?"subset":e.createdBy.some((e=>t.has(e)))?"unknown":"disjoint"}return this.createdBy?"subset":"unknown"}_getRelationWrtDateRange(e){var t,s,i,r;const o=(null===(t=this.createdAfter)||void 0===t?void 0:t.getTime())||-1/0,n=(null===(s=this.createdBefore)||void 0===s?void 0:s.getTime())||1/0,a=(null===(i=e.createdAfter)||void 0===i?void 0:i.getTime())||-1/0,c=(null===(r=e.createdBefore)||void 0===r?void 0:r.getTime())||1/0;return a<=o&&c>=n?"subset":a>n||c<o?"disjoint":"unknown"}getRelationToFilter(e){let t=[this._getRelationWrtMilestone(e),this._getRelationWrtCreatedBy(e),this._getRelationWrtDateRange(e)];return t.includes("disjoint")?"disjoint":t.every((e=>"subset"===e))?"subset":"unknown"}}Po.BookmarkedVersions=new Po({isMilestone:!0})}}]);